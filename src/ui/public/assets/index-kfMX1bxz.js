import{d as ce,r as l,o as ue,c as g,a as d,b as a,e as q,f as t,E as xe,w as r,u as S,g as ge,t as w,h as se,i as B,j as Ae,F as K,k as Y,l as he,m as je,n as Be,p as _e,q as ye,s as Ne,v as $e,x as Z,y as Me,z as De,A as Ee,B as Re,C as c,D as Ue,G as Oe,H as ze,I as Ie,J as Ve,K as Fe,L as Ge,M as Pe,N as Le,O as Se,P as Je,Q as He,R as We,S as ne,T as Ze,U as qe,V as Ke,W as Qe,X as Xe}from"./vendor-DxvF30ca.js";(function(){const G=document.createElement("link").relList;if(G&&G.supports&&G.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))y(n);new MutationObserver(n=>{for(const h of n)if(h.type==="childList")for(const z of h.addedNodes)z.tagName==="LINK"&&z.rel==="modulepreload"&&y(z)}).observe(document,{childList:!0,subtree:!0});function p(n){const h={};return n.integrity&&(h.integrity=n.integrity),n.referrerPolicy&&(h.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?h.credentials="include":n.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function y(n){if(n.ep)return;n.ep=!0;const h=p(n);fetch(n.href,h)}})();const Ye={class:"card"},et={class:"current-directory"},tt={class:"status-header"},st={class:"status-box"},at={key:0,class:"file-list"},lt=["onClick"],ot={class:"file-type"},nt={class:"file-path"},it={class:"file-actions"},rt={class:"directory-buttons"},ct={class:"browser-current-path"},ut={key:0,class:"browser-error"},dt={class:"directory-browser"},pt={class:"browser-nav"},ft={class:"directory-items"},vt=["onClick"],mt={class:"diff-content"},gt=["innerHTML"],yt={key:1,class:"no-diff"},ht={class:"file-navigation"},_t={class:"file-counter"},wt=ce({__name:"GitStatus",setup(O,{expose:G}){const p=l("加载中..."),y=l(!1),n=l([]),h=l(""),z=l(""),P=l(!1),E=l(!1),L=l(-1),I=l(!1),F=l(""),A=l(!1),J=l(!1),k=l(""),C=l([]),$=l(!1),f=l("");function j(u){if(u===void 0)return;const o=u.split(`
`),V=[];for(const m of o){const s=m.match(/^([ MADRCU\?]{2})\s+(.+)$/);if(s){let e="";const x=s[1].trim();x==="M"||x==="MM"||x==="AM"||x==="RM"?e="modified":x==="A"||x==="AA"?e="added":x==="D"||x==="AD"||x==="DA"?e="deleted":x==="??"?e="untracked":e="other",V.push({path:s[2],type:e})}}n.value=V}const T=l("");async function N(){try{y.value=!0;const o=await(await fetch("/api/current_directory")).json();if(T.value=o.directory||"未知目录",o.isGitRepo===!1){p.value="当前目录不是一个Git仓库",n.value=[],c.warning("当前目录不是一个Git仓库");return}const m=await(await fetch("/api/status")).json();p.value=m.status;const e=await(await fetch("/api/status_porcelain")).json();j(e.status),c({message:"Git 状态已刷新",type:"success"})}catch(u){p.value="加载状态失败: "+u.message,n.value=[],c({message:"刷新失败: "+u.message,type:"error"})}finally{y.value=!1}}function R(u){if(!u)return"";const o=u.split(`
`);function V(m){return m.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}return o.map(m=>{const s=V(m);return m.startsWith("diff --git")?`<div class="diff-header">${s}</div>`:m.startsWith("---")?`<div class="diff-old-file">${s}</div>`:m.startsWith("+++")?`<div class="diff-new-file">${s}</div>`:m.startsWith("@@")?`<div class="diff-hunk-header">${s}</div>`:m.startsWith("+")?`<div class="diff-added">${s}</div>`:m.startsWith("-")?`<div class="diff-removed">${s}</div>`:`<div class="diff-context">${s}</div>`}).join("")}async function _(u){try{E.value=!0,h.value=u,L.value=n.value.findIndex(m=>m.path===u);const V=await(await fetch(`/api/diff?file=${encodeURIComponent(u)}`)).json();z.value=V.diff||"没有变更",P.value=!0}catch(o){c({message:"获取文件差异失败: "+o.message,type:"error"}),z.value="获取差异失败: "+o.message}finally{E.value=!1}}async function i(){if(n.value.length===0||L.value<=0)return;const u=L.value-1,o=n.value[u];await _(o.path)}async function H(){if(n.value.length===0||L.value>=n.value.length-1)return;const u=L.value+1,o=n.value[u];await _(o.path)}function te(){F.value=T.value,I.value=!0}function Q(){f.value="",k.value=F.value||T.value,J.value=!0,X(k.value)}async function X(u){try{$.value=!0,f.value="";let o=u;/^[A-Za-z]:$/.test(o)&&(o+="/");const V=await fetch(`/api/browse_directory?path=${encodeURIComponent(o)}`);if(V.status===403){const s=await V.json();f.value=s.error||"目录浏览功能未启用";return}if(!V.ok){const s=await V.json();f.value=s.error||"获取目录内容失败";return}const m=await V.json();m.success?(C.value=m.items,k.value=m.currentPath):f.value=m.error||"获取目录内容失败"}catch(o){f.value=`获取目录内容失败: ${o.message}`}finally{$.value=!1}}function ae(){if(/^[A-Za-z]:$/.test(k.value)||/^[A-Za-z]:[\\/]$/.test(k.value)||k.value==="/")return;let u=k.value.split(/[/\\]/);u.pop();let o=u.join("/");u.length===1&&/^[A-Za-z]:$/.test(u[0])&&(o=u[0]+"/"),o&&X(o)}function ee(u){u.type==="directory"&&X(u.path)}function le(){F.value=k.value,J.value=!1}async function oe(){if(!F.value){c.warning("目录路径不能为空");return}try{A.value=!0;const o=await(await fetch("/api/change_directory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:F.value})})).json();o.success?(c.success("已切换工作目录"),T.value=o.directory,I.value=!1,o.isGitRepo||c.warning("当前目录不是一个Git仓库"),N()):c.error(o.error||"切换目录失败")}catch(u){c.error(`切换目录失败: ${u.message}`)}finally{A.value=!1}}function D(u){_(u.path)}function pe(u){switch(u){case"added":return"新增";case"modified":return"修改";case"deleted":return"删除";case"untracked":return"未跟踪";default:return"其他"}}async function ie(){await N()}async function fe(u){try{await Ie.confirm(`确定要撤回文件 "${u}" 的所有修改吗？此操作无法撤销。`,"撤回修改",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const V=await(await fetch("/api/revert_file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:u})})).json();V.success?(c.success("已撤回文件修改"),await N()):c.error(V.error||"撤回文件修改失败")}catch(o){o.message!=="cancel"&&c.error(`撤回文件修改失败: ${o.message}`)}}return ue(()=>{N()}),G({refreshStatus:ie}),(u,o)=>{const V=xe,m=se,s=ze,e=_e,x=Be,W=je,M=he,U=De;return d(),g("div",Ye,[a("div",et,[t(V,null,{default:r(()=>[t(S(ge))]),_:1}),a("span",null,w(T.value),1),t(m,{type:"primary",size:"small",onClick:te,plain:""},{default:r(()=>o[4]||(o[4]=[B(" 切换目录 ")])),_:1})]),a("div",tt,[o[5]||(o[5]=a("h2",null,"Git 状态",-1)),t(m,{type:"primary",icon:S(Ae),circle:"",size:"small",onClick:ie,loading:y.value},null,8,["icon","loading"])]),a("div",st,w(p.value),1),n.value.length?(d(),g("div",at,[(d(!0),g(K,null,Y(n.value,b=>(d(),g("div",{key:b.path,class:$e(["file-item",b.type])},[a("div",{class:"file-info",onClick:re=>D(b)},[a("span",ot,w(pe(b.type)),1),a("span",nt,w(b.path),1)],8,lt),a("div",it,[t(s,{content:"撤回修改",placement:"top","hide-after":1e3},{default:r(()=>[t(m,{type:"danger",size:"small",icon:S(Oe),circle:"",onClick:Ue(re=>fe(b.path),["stop"])},null,8,["icon","onClick"])]),_:2},1024)])],2))),128))])):q("",!0),t(M,{modelValue:I.value,"onUpdate:modelValue":o[1]||(o[1]=b=>I.value=b),title:"切换工作目录",width:"500px"},{default:r(()=>[t(W,null,{default:r(()=>[t(x,{label:"目录路径"},{default:r(()=>[t(e,{modelValue:F.value,"onUpdate:modelValue":o[0]||(o[0]=b=>F.value=b),placeholder:"请输入目录路径",clearable:""},null,8,["modelValue"]),a("div",rt,[t(m,{onClick:Q,type:"primary",plain:"",class:"no-padding-left"},{default:r(()=>[t(V,null,{default:r(()=>[t(S(ge))]),_:1}),o[6]||(o[6]=B(" 浏览 "))]),_:1}),t(m,{onClick:oe,loading:A.value,type:"primary"},{default:r(()=>o[7]||(o[7]=[B(" 切换 ")])),_:1},8,["loading"])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(M,{modelValue:J.value,"onUpdate:modelValue":o[2]||(o[2]=b=>J.value=b),title:"浏览目录",width:"600px"},{default:r(()=>[a("div",ct,[a("span",null,"当前路径: "+w(k.value),1)]),f.value?(d(),g("div",ut,w(f.value),1)):q("",!0),ye((d(),g("div",dt,[a("div",pt,[t(m,{onClick:ae,disabled:!k.value||$.value,size:"small",class:"no-padding-left"},{default:r(()=>[t(V,null,{default:r(()=>[t(S(Ne))]),_:1}),o[8]||(o[8]=B(" 上级目录 "))]),_:1},8,["disabled"]),t(m,{onClick:le,type:"primary",size:"small",class:"no-padding-left"},{default:r(()=>o[9]||(o[9]=[B(" 选择当前目录 ")])),_:1})]),a("ul",ft,[(d(!0),g(K,null,Y(C.value,b=>(d(),g("li",{key:b.path,class:$e(["directory-item",b.type]),onClick:re=>ee(b)},[b.type==="directory"?(d(),Z(V,{key:0},{default:r(()=>[t(S(ge))]),_:1})):(d(),Z(V,{key:1},{default:r(()=>[t(S(Me))]),_:1})),a("span",null,w(b.name),1)],10,vt))),128))])])),[[U,$.value]])]),_:1},8,["modelValue"]),t(M,{modelValue:P.value,"onUpdate:modelValue":o[3]||(o[3]=b=>P.value=b),title:`文件差异: ${h.value}`,width:"80%","destroy-on-close":""},{default:r(()=>[ye((d(),g("div",mt,[z.value?(d(),g("div",{key:0,innerHTML:R(z.value),class:"diff-formatted"},null,8,gt)):(d(),g("div",yt,"该文件没有差异或是新文件"))])),[[U,E.value]]),a("div",ht,[t(m,{icon:S(Ee),onClick:i,disabled:L.value<=0||n.value.length===0,circle:""},null,8,["icon","disabled"]),a("span",_t,w(L.value+1)+" / "+w(n.value.length),1),t(m,{icon:S(Re),onClick:H,disabled:L.value>=n.value.length-1||n.value.length===0,circle:""},null,8,["icon","disabled"])])]),_:1},8,["modelValue","title"])])}}}),de=(O,G)=>{const p=O.__vccOpts||O;for(const[y,n]of G)p[y]=n;return p},bt=de(wt,[["__scopeId","data-v-61ea34c7"]]),kt={class:"card"},Ct={class:"commit-options"},$t={class:"commit-mode-toggle"},Vt={class:"no-verify-toggle"},St={key:0,class:"commit-form"},Tt={key:1,class:"standard-commit-form"},xt={class:"standard-commit-header"},jt={class:"scope-container"},Bt={class:"description-container"},Dt={class:"preview-section"},Ot={class:"preview-content"},zt={class:"button-group"},Pt={class:"template-container"},Lt={class:"template-form"},At={class:"template-list"},Nt={class:"template-content"},Mt={class:"template-actions"},Et={class:"template-container"},Rt={class:"template-form"},Ut={class:"template-list"},It={class:"template-content"},Ft={class:"template-actions"},Gt=ce({__name:"CommitForm",emits:["commit-success","push-success"],setup(O,{emit:G}){const p=G,y=l(""),n=l("提交"),h=l("推送到远程"),z=l(!1),P=l(!1),E=l(!1),L=l("提交并推送"),I=l("输入提交信息..."),F=l(""),A=l(!1),J=l("feat"),k=l(""),C=l(""),$=l(""),f=l(""),j=l([]),T=l(!1),N=l(""),R=l([]),_=l(!1),i=l(""),H=l(!1),te=[{value:"feat",label:"feat: 新功能"},{value:"fix",label:"fix: 修复bug"},{value:"docs",label:"docs: 文档修改"},{value:"style",label:"style: 样式修改"},{value:"refactor",label:"refactor: 代码重构"},{value:"test",label:"test: 测试代码"},{value:"chore",label:"chore: 构建/工具修改"}];Ve(A,s=>{localStorage.setItem("zen-gitsync-standard-commit",s.toString())}),Ve(H,s=>{localStorage.setItem("zen-gitsync-skip-hooks",s.toString())});const Q=Fe(()=>{if(!A.value)return y.value||F.value;let s=`${J.value||""}`;return k.value&&(s+=`(${k.value})`),s+=`: ${C.value}`,$.value&&(s+=`

${$.value}`),f.value&&(s+=`

${f.value}`),s});async function X(){try{const e=await(await fetch("/api/config/getConfig")).json();I.value=`输入提交信息 (默认: ${e.defaultCommitMessage})`,F.value=e.defaultCommitMessage||"",e.descriptionTemplates&&Array.isArray(e.descriptionTemplates)&&(j.value=e.descriptionTemplates),e.scopeTemplates&&Array.isArray(e.scopeTemplates)&&(R.value=e.scopeTemplates)}catch(s){console.error("加载配置失败:",s)}}async function ae(){if(!N.value.trim()){c({message:"请输入模板内容",type:"warning"});return}try{if(j.value.includes(N.value)){c({message:"该模板已存在",type:"warning"});return}j.value.push(N.value);const e=await(await fetch("/api/config/save-template",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({template:N.value,type:"description"})})).json();e.success?(c({message:"模板保存成功!",type:"success"}),N.value=""):c({message:"模板保存失败: "+e.error,type:"error"})}catch(s){c({message:"模板保存失败: "+s.message,type:"error"})}}async function ee(){if(!i.value.trim()){c({message:"请输入模板内容",type:"warning"});return}try{if(R.value.includes(i.value)){c({message:"该模板已存在",type:"warning"});return}R.value.push(i.value);const e=await(await fetch("/api/config/save-template",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({template:i.value,type:"scope"})})).json();e.success?(c({message:"作用域模板保存成功!",type:"success"}),i.value=""):c({message:"作用域模板保存失败: "+e.error,type:"error"})}catch(s){c({message:"作用域模板保存失败: "+s.message,type:"error"})}}async function le(s){try{const e=j.value.indexOf(s);e!==-1&&j.value.splice(e,1);const W=await(await fetch("/api/config/delete-template",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({template:s,type:"description"})})).json();W.success?c({message:"模板删除成功!",type:"success"}):c({message:"模板删除失败: "+W.error,type:"error"})}catch(e){c({message:"模板删除失败: "+e.message,type:"error"})}}async function oe(s){try{const e=R.value.indexOf(s);e!==-1&&R.value.splice(e,1);const W=await(await fetch("/api/config/delete-template",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({template:s,type:"scope"})})).json();W.success?c({message:"作用域模板删除成功!",type:"success"}):c({message:"作用域模板删除失败: "+W.error,type:"error"})}catch(e){c({message:"作用域模板删除失败: "+e.message,type:"error"})}}function D(s){C.value=s,T.value=!1}function pe(s){k.value=s,_.value=!1}function ie(){T.value=!0}function fe(){_.value=!0}function u(){const s=localStorage.getItem("zen-gitsync-standard-commit");s!==null&&(A.value=s==="true");const e=localStorage.getItem("zen-gitsync-skip-hooks");e!==null&&(H.value=e==="true")}async function o(){const s=Q.value;if(!s&&A.value&&!C.value){c({message:"请输入提交描述",type:"warning"});return}try{z.value=!0,n.value="提交中...";const x=await(await fetch("/api/add",{method:"POST"})).json();if(!x.success){c({message:"添加文件失败: "+x.error,type:"error"});return}const M=await(await fetch("/api/commit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:s,hasNewlines:s.includes(`
`),noVerify:H.value})})).json();M.success?(A.value?(C.value="",$.value="",f.value=""):y.value="",c({message:"提交成功!",type:"success"}),p("commit-success")):c({message:"提交失败: "+M.error,type:"error"})}catch(e){c({message:"提交失败: "+e.message,type:"error"})}finally{z.value=!1,n.value="提交"}}async function V(){try{P.value=!0,h.value="推送中...";const e=await(await fetch("/api/push",{method:"POST"})).json();e.success?(c({message:"推送成功!",type:"success"}),p("push-success")):c({message:"推送失败: "+e.error,type:"error"})}catch(s){c({message:"推送失败: "+s.message,type:"error"})}finally{P.value=!1,h.value="推送到远程"}}async function m(){const s=Q.value;if(!s&&A.value&&!C.value){c({message:"请输入提交描述",type:"warning"});return}try{E.value=!0,L.value="处理中...";const x=await(await fetch("/api/add",{method:"POST"})).json();if(!x.success){c({message:"添加文件失败: "+x.error,type:"error"});return}const M=await(await fetch("/api/commit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:s,hasNewlines:s.includes(`
`),noVerify:H.value})})).json();if(!M.success){c({message:"提交失败: "+M.error,type:"error"});return}A.value?(C.value="",$.value="",f.value=""):y.value="";const b=await(await fetch("/api/push",{method:"POST"})).json();b.success?(y.value="",c({message:"提交并推送成功!",type:"success"}),p("commit-success"),p("push-success")):c({message:"推送失败: "+b.error,type:"error"})}catch(e){c({message:"操作失败: "+e.message,type:"error"})}finally{E.value=!1,L.value="提交并推送"}}return ue(()=>{X(),u()}),(s,e)=>{const x=Ge,W=ze,M=_e,U=se,b=Le,re=Pe,we=Je,be=We,ke=He,Ce=he;return d(),g("div",kt,[e[21]||(e[21]=a("h2",null,"提交更改",-1)),a("div",Ct,[a("div",$t,[t(x,{modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=v=>A.value=v),"active-text":"标准化提交","inactive-text":"普通提交"},null,8,["modelValue"])]),a("div",Vt,[t(W,{content:"跳过 Git 钩子检查 (--no-verify)",placement:"top"},{default:r(()=>[t(x,{modelValue:H.value,"onUpdate:modelValue":e[1]||(e[1]=v=>H.value=v),"active-text":"跳过钩子 (--no-verify)"},null,8,["modelValue"])]),_:1})])]),A.value?(d(),g("div",Tt,[a("div",xt,[t(re,{modelValue:J.value,"onUpdate:modelValue":e[3]||(e[3]=v=>J.value=v),placeholder:"提交类型",class:"type-select",clearable:""},{default:r(()=>[(d(),g(K,null,Y(te,v=>t(b,{key:v.value,label:v.label,value:v.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),a("div",jt,[t(M,{modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=v=>k.value=v),placeholder:"作用域（可选）",class:"scope-input",clearable:""},null,8,["modelValue"]),t(U,{type:"primary",icon:S(Se),circle:"",size:"small",class:"settings-button",onClick:fe},null,8,["icon"])]),a("div",Bt,[t(M,{modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=v=>C.value=v),placeholder:"简短描述（必填）",class:"description-input",clearable:""},null,8,["modelValue"]),t(U,{type:"primary",icon:S(Se),circle:"",size:"small",class:"settings-button",onClick:ie},null,8,["icon"])])]),t(M,{modelValue:$.value,"onUpdate:modelValue":e[6]||(e[6]=v=>$.value=v),type:"textarea",rows:4,placeholder:"正文（可选）：详细描述本次提交的内容和原因",class:"body-input",clearable:""},null,8,["modelValue"]),t(M,{modelValue:f.value,"onUpdate:modelValue":e[7]||(e[7]=v=>f.value=v),placeholder:"页脚（可选）：如 Closes #123",class:"footer-input",clearable:""},null,8,["modelValue"]),a("div",Dt,[e[12]||(e[12]=a("div",{class:"preview-title"},"预览：",-1)),a("pre",Ot,w(Q.value),1)]),t(U,{type:"primary",onClick:o,loading:z.value},{default:r(()=>[B(w(n.value),1)]),_:1},8,["loading"])])):(d(),g("div",St,[t(M,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=v=>y.value=v),placeholder:I.value,clearable:""},null,8,["modelValue","placeholder"]),t(U,{type:"primary",onClick:o,loading:z.value},{default:r(()=>[B(w(n.value),1)]),_:1},8,["loading"])])),a("div",zt,[t(U,{type:"success",onClick:V,loading:P.value},{default:r(()=>[B(w(h.value),1)]),_:1},8,["loading"]),t(U,{type:"warning",onClick:m,loading:E.value},{default:r(()=>[B(w(L.value),1)]),_:1},8,["loading"])]),t(Ce,{title:"简短描述模板设置",modelValue:T.value,"onUpdate:modelValue":e[9]||(e[9]=v=>T.value=v),width:"80vw",style:{height:"80vh"}},{default:r(()=>[a("div",Pt,[a("div",Lt,[t(M,{modelValue:N.value,"onUpdate:modelValue":e[8]||(e[8]=v=>N.value=v),placeholder:"输入新模板内容",class:"template-input",clearable:""},null,8,["modelValue"]),t(U,{type:"primary",onClick:ae,disabled:!N.value.trim()},{default:r(()=>e[13]||(e[13]=[B("添加模板")])),_:1},8,["disabled"])]),a("div",At,[e[16]||(e[16]=a("h3",null,"已保存模板",-1)),j.value.length===0?(d(),Z(we,{key:0,description:"暂无保存的模板"})):q("",!0),(d(!0),g(K,null,Y(j.value,(v,ve)=>(d(),Z(ke,{key:ve,class:"template-item"},{default:r(()=>[t(be,{justify:"space-between",align:"middle",style:{width:"100%"}},{default:r(()=>[a("div",Nt,w(v),1),a("div",Mt,[t(U,{type:"primary",size:"small",onClick:me=>D(v)},{default:r(()=>e[14]||(e[14]=[B("使用")])),_:2},1032,["onClick"]),t(U,{type:"danger",size:"small",onClick:me=>le(v)},{default:r(()=>e[15]||(e[15]=[B("删除")])),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))])])]),_:1},8,["modelValue"]),t(Ce,{title:"作用域模板设置",modelValue:_.value,"onUpdate:modelValue":e[11]||(e[11]=v=>_.value=v),width:"80%",style:{height:"80vh"}},{default:r(()=>[a("div",Et,[a("div",Rt,[t(M,{modelValue:i.value,"onUpdate:modelValue":e[10]||(e[10]=v=>i.value=v),placeholder:"输入新作用域模板",class:"template-input",clearable:""},null,8,["modelValue"]),t(U,{type:"primary",onClick:ee,disabled:!i.value.trim()},{default:r(()=>e[17]||(e[17]=[B("添加模板")])),_:1},8,["disabled"])]),a("div",Ut,[e[20]||(e[20]=a("h3",null,"已保存作用域",-1)),R.value.length===0?(d(),Z(we,{key:0,description:"暂无保存的作用域"})):q("",!0),(d(!0),g(K,null,Y(R.value,(v,ve)=>(d(),Z(ke,{key:ve,class:"template-item"},{default:r(()=>[t(be,{justify:"space-between",align:"middle",style:{width:"100%"}},{default:r(()=>[a("div",It,w(v),1),a("div",Ft,[t(U,{type:"primary",size:"small",onClick:me=>pe(v)},{default:r(()=>e[18]||(e[18]=[B("使用")])),_:2},1032,["onClick"]),t(U,{type:"danger",size:"small",onClick:me=>oe(v)},{default:r(()=>e[19]||(e[19]=[B("删除")])),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))])])]),_:1},8,["modelValue"])])}}}),Jt=de(Gt,[["__scopeId","data-v-00e49634"]]),Ht={class:"card"},Wt={class:"log-header"},Zt={class:"log-actions"},qt={key:0},Kt={key:1},Qt={key:0,class:"graph-view"},Xt={key:0,class:"commit-count"},Yt={key:1},es={key:0,class:"commit-count"},ts={key:0,class:"branch-container"};function Te(O){return O=O.trim().replace(/^HEAD\s*->\s*/,""),O=O.replace(/^origin\//,""),O=O.replace(/^tag:\s*/,""),O.trim()}function ss(O){return O.includes("HEAD")?"success":O.includes("tag:")?"warning":O.includes("origin/")?"info":"primary"}const as=ce({__name:"LogList",setup(O,{expose:G}){const p=l([]),y=l(""),n=l(!1),h=l(!1),z=l(0),P=l(!0),E=l(null);async function L(k=!1){try{n.value=!0,h.value=k;const $=await fetch(k?"/api/log?all=true&graph=true":"/api/log?graph=true");p.value=await $.json(),z.value=p.value.length,y.value="",P.value&&setTimeout(I,0)}catch(C){y.value="加载提交历史失败: "+C.message}finally{n.value=!1}}async function I(){if(!E.value||p.value.length===0)return;E.value.innerHTML="";const k=await fetch("/api/branch"),{branch:C}=await k.json(),$=Ke(E.value,{orientation:"vertical-reverse",template:"metro",author:"提交者 <committer@example.com>"}),f={},j=$.branch(C||"main");f[C||"main"]=j,p.value.forEach(T=>{let N=j;if(T.branch){const R=Te(T.branch.split(",")[0]);f[R]||(f[R]=$.branch(R)),N=f[R]}N.commit({hash:T.hash,subject:T.message,author:`${T.author} <${T.email}>`})})}function F(){P.value=!P.value,P.value&&p.value.length>0&&setTimeout(I,0)}function A(){L(!h.value)}ue(()=>{L()});const J=()=>L(h.value);return G({refreshLog:J}),(k,C)=>{const $=De;return d(),g("div",Ht,[a("div",Wt,[C[1]||(C[1]=a("h2",null,"提交历史",-1)),a("div",Zt,[t(S(se),{type:"primary",size:"small",onClick:F},{default:r(()=>[B(w(P.value?"表格视图":"图表视图"),1)]),_:1}),t(S(se),{type:"primary",size:"small",onClick:A,loading:n.value},{default:r(()=>[B(w(h.value?"显示最近100条":"显示所有提交"),1)]),_:1},8,["loading"]),t(S(se),{icon:S(Oe),circle:"",size:"small",onClick:C[0]||(C[0]=f=>J()),loading:n.value},null,8,["icon","loading"])])]),y.value?(d(),g("div",qt,w(y.value),1)):(d(),g("div",Kt,[P.value?(d(),g("div",Qt,[p.value.length>0?(d(),g("div",Xt," 显示 "+w(p.value.length)+" 条提交记录 "+w(h.value?"(全部)":"(最近100条)"),1)):q("",!0),a("div",{ref_key:"graphContainer",ref:E,class:"graph-container"},null,512)])):(d(),g("div",Yt,[p.value.length>0?(d(),g("div",es," 显示 "+w(p.value.length)+" 条提交记录 "+w(h.value?"(全部)":"(最近100条)"),1)):q("",!0),ye((d(),Z(S(qe),{data:p.value,style:{width:"100%"},stripe:"",border:""},{default:r(()=>[t(S(ne),{prop:"hash",label:"提交哈希",width:"100",resizable:""}),t(S(ne),{prop:"date",label:"日期",width:"180",resizable:""}),t(S(ne),{label:"作者",width:"200",resizable:""},{default:r(f=>[B(w(f.row.author)+" <"+w(f.row.email)+"> ",1)]),_:1}),t(S(ne),{label:"分支",width:"180",resizable:""},{default:r(f=>[f.row.branch?(d(),g("div",ts,[(d(!0),g(K,null,Y(f.row.branch.split(","),(j,T)=>(d(),Z(S(Ze),{key:T,size:"small",type:ss(j),class:"branch-tag"},{default:r(()=>[B(w(Te(j)),1)]),_:2},1032,["type"]))),128))])):q("",!0)]),_:1}),t(S(ne),{prop:"message",label:"提交信息","min-width":"250"})]),_:1},8,["data"])),[[$,n.value]])]))]))])}}}),ls=de(as,[["__scopeId","data-v-c6b721c7"]]),os="data:image/svg+xml,%3csvg%20width='200'%20height='200'%20viewBox='0%200%20200%20200'%20xmlns='http://www.w3.org/2000/svg'%3e%3c!--%20主分支%20--%3e%3cline%20x1='40'%20y1='40'%20x2='40'%20y2='160'%20stroke='%2334495e'%20stroke-width='8'%20stroke-linecap='round'%20/%3e%3c!--%20特性分支%20--%3e%3cpath%20d='M40,70%20C60,70%2080,90%2080,110%20L80,130'%20stroke='%233498db'%20stroke-width='8'%20stroke-linecap='round'%20stroke-linejoin='round'%20fill='none'%20/%3e%3c!--%20开发分支%20--%3e%3cpath%20d='M40,100%20C60,100%20100,110%20100,130%20L100,160'%20stroke='%232ecc71'%20stroke-width='8'%20stroke-linecap='round'%20stroke-linejoin='round'%20fill='none'%20/%3e%3c!--%20修复分支%20--%3e%3cpath%20d='M40,130%20C60,130%20120,140%20120,160'%20stroke='%23e74c3c'%20stroke-width='8'%20stroke-linecap='round'%20stroke-linejoin='round'%20fill='none'%20/%3e%3c!--%20合并点%20--%3e%3cpath%20d='M80,130%20C80,145%2060,145%2040,145'%20stroke='%233498db'%20stroke-width='8'%20stroke-linecap='round'%20stroke-linejoin='round'%20fill='none'%20/%3e%3c!--%20节点%20--%3e%3ccircle%20cx='40'%20cy='40'%20r='10'%20fill='%2334495e'%20/%3e%3ccircle%20cx='40'%20cy='70'%20r='10'%20fill='%2334495e'%20/%3e%3ccircle%20cx='40'%20cy='100'%20r='10'%20fill='%2334495e'%20/%3e%3ccircle%20cx='40'%20cy='130'%20r='10'%20fill='%2334495e'%20/%3e%3ccircle%20cx='40'%20cy='145'%20r='10'%20fill='%2334495e'%20/%3e%3ccircle%20cx='40'%20cy='160'%20r='10'%20fill='%2334495e'%20/%3e%3ccircle%20cx='80'%20cy='130'%20r='10'%20fill='%233498db'%20/%3e%3ccircle%20cx='100'%20cy='160'%20r='10'%20fill='%232ecc71'%20/%3e%3ccircle%20cx='120'%20cy='160'%20r='10'%20fill='%23e74c3c'%20/%3e%3c/svg%3e",ns={class:"main-header"},is={class:"header-left"},rs=["src"],cs={class:"header-info"},us={key:0,id:"user-info"},ds={class:"user-name"},ps={class:"user-email"},fs={class:"container"},vs={class:"layout-container"},ms={class:"left-panel"},gs={class:"right-panel"},ys={class:"dialog-footer"},hs={class:"main-footer"},_s={key:0,class:"branch-info"},ws=ce({__name:"App",setup(O){const G=l(""),p=l(null),y=l(null),n=l(""),h=l(""),z=l(""),P=l([]),E=l(!1);async function L(){try{const i=await(await fetch("/api/config/getConfig")).json();G.value=`默认提交信息: ${i.defaultCommitMessage}`}catch(_){console.error("加载配置失败:",_)}}async function I(){try{const i=await(await fetch("/api/branch")).json();i.branch&&(n.value=i.branch)}catch(_){console.error("获取分支信息失败:",_)}}async function F(){try{const i=await(await fetch("/api/branches")).json();i.branches&&Array.isArray(i.branches)&&(P.value=i.branches)}catch(_){console.error("获取所有分支信息失败:",_)}}async function A(_){console.log("切换到分支:",_);try{E.value=!0;const H=await(await fetch("/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch:_})})).json();H.success?(c({message:`已切换到分支: ${_}`,type:"success"}),I(),y.value&&y.value.refreshStatus(),p.value&&p.value.refreshLog()):(c({message:`切换分支失败: ${H.error}`,type:"error"}),n.value=n.value)}catch(i){c({message:`切换分支失败: ${i.message}`,type:"error"}),n.value=n.value}finally{E.value=!1}}async function J(){try{const i=await(await fetch("/api/user-info")).json();i.name&&i.email&&(h.value=i.name,z.value=i.email)}catch(_){console.error("获取用户信息失败:",_)}}ue(()=>{L(),I(),F(),J()});function k(){p.value&&p.value.refreshLog(),y.value&&y.value.refreshStatus()}function C(){p.value&&p.value.refreshLog(),y.value&&y.value.refreshStatus(),I()}const $=l(!1),f=l(""),j=l(""),T=l(!1);async function N(){if(!f.value.trim()){c({message:"分支名称不能为空",type:"warning"});return}try{T.value=!0;const i=await(await fetch("/api/create-branch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newBranchName:f.value,baseBranch:j.value||n.value})})).json();i.success?(c({message:`已创建并切换到分支: ${f.value}`,type:"success"}),$.value=!1,f.value="",I(),F(),y.value&&y.value.refreshStatus(),p.value&&p.value.refreshLog()):c({message:`创建分支失败: ${i.error}`,type:"error"})}catch(_){c({message:`创建分支失败: ${_.message}`,type:"error"})}finally{T.value=!1}}function R(){j.value=n.value,$.value=!0}return(_,i)=>{const H=_e,te=Be,Q=Le,X=Pe,ae=je,ee=se,le=he,oe=xe;return d(),g(K,null,[a("header",ns,[a("div",is,[a("img",{src:S(os),alt:"Zen GitSync Logo",class:"logo"},null,8,rs),i[5]||(i[5]=a("h1",null,"Zen GitSync UI",-1))]),a("div",cs,[h.value&&z.value?(d(),g("div",us,[i[6]||(i[6]=a("span",{class:"user-label"},"用户:",-1)),a("span",ds,w(h.value),1),a("span",ps,"<"+w(z.value)+">",1)])):q("",!0)])]),a("div",fs,[a("div",vs,[a("div",ms,[t(bt,{ref_key:"gitStatusRef",ref:y},null,512)]),a("div",gs,[t(Jt,{onCommitSuccess:k,onPushSuccess:C}),t(ls,{ref_key:"logListRef",ref:p},null,512)]),t(le,{modelValue:$.value,"onUpdate:modelValue":i[3]||(i[3]=D=>$.value=D),title:"创建新分支",width:"30%","destroy-on-close":""},{footer:r(()=>[a("span",ys,[t(ee,{onClick:i[2]||(i[2]=D=>$.value=!1)},{default:r(()=>i[7]||(i[7]=[B("取消")])),_:1}),t(ee,{type:"primary",onClick:N,loading:T.value},{default:r(()=>i[8]||(i[8]=[B(" 创建 ")])),_:1},8,["loading"])])]),default:r(()=>[t(ae,{model:{newBranchName:f.value,selectedBaseBranch:j.value}},{default:r(()=>[t(te,{label:"新分支名称"},{default:r(()=>[t(H,{modelValue:f.value,"onUpdate:modelValue":i[0]||(i[0]=D=>f.value=D),placeholder:"请输入新分支名称"},null,8,["modelValue"])]),_:1}),t(te,{label:"基于分支"},{default:r(()=>[t(X,{modelValue:j.value,"onUpdate:modelValue":i[1]||(i[1]=D=>j.value=D),placeholder:"选择基础分支",style:{width:"100%"}},{default:r(()=>[(d(!0),g(K,null,Y(P.value,D=>(d(),Z(Q,{key:D,label:D,value:D},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])]),a("footer",hs,[n.value?(d(),g("div",_s,[i[9]||(i[9]=a("span",{class:"branch-label"},"当前分支:",-1)),t(X,{modelValue:n.value,"onUpdate:modelValue":i[4]||(i[4]=D=>n.value=D),size:"small",onChange:A,loading:E.value,class:"branch-select"},{default:r(()=>[(d(!0),g(K,null,Y(P.value,D=>(d(),Z(Q,{key:D,label:D,value:D},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),t(ee,{type:"primary",size:"small",onClick:R,style:{"margin-left":"5px"}},{default:r(()=>[t(oe,null,{default:r(()=>[t(S(Qe))]),_:1})]),_:1})])):q("",!0),i[10]||(i[10]=a("div",{class:"footer-right"},null,-1))])],64)}}}),bs=de(ws,[["__scopeId","data-v-93cc73d5"]]),ks=Xe(bs);ks.mount("#app");
