import{d as Cs,r as d,o as kt,a as Ss,E as n,l as fa,c as fe,b as pt,w as Ye,e as $,f,n as dt,g as A,h as e,t as L,i as t,u as o,j as pa,k as a,m as W,p as Et,F as we,q as Fe,s as ge,v as $t,x as ns,y as Nt,z as ma,A as _s,B as De,C as _,D as It,G as Xe,H as Ts,I as os,J as Vs,K as xs,L as Ls,M as ft,N as lt,O as va,P as is,Q as Bt,R as zs,S as yt,T as ws,U as ga,V as Ut,W as Ee,X as qe,Y as _t,Z as rs,_ as Tt,$ as ha,a0 as ks,a1 as cs,a2 as ya,a3 as ts,a4 as ss,a5 as Mt,a6 as Pt,a7 as us,a8 as Bs,a9 as _a,aa as wa,ab as Fs,ac as ka,ad as Ds,ae as Rs,af as $a,ag as ba,ah as Ca,ai as Gs,aj as xt,ak as ut,al as Sa,am as Ta,an as Va,ao as xa,ap as La,aq as za,ar as Ba,as as Fa,at as Da,au as Ra,av as Ga,aw as Lt,ax as Oa,ay as ja,az as Ua,aA as $s,aB as bs,aC as Aa,aD as Oe,aE as Ea,aF as Ma}from"./vendor-BHXhVXkb.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))p(h);new MutationObserver(h=>{for(const R of h)if(R.type==="childList")for(const F of R.addedNodes)F.tagName==="LINK"&&F.rel==="modulepreload"&&p(F)}).observe(document,{childList:!0,subtree:!0});function m(h){const R={};return h.integrity&&(R.integrity=h.integrity),h.referrerPolicy&&(R.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?R.credentials="include":h.crossOrigin==="anonymous"?R.credentials="omit":R.credentials="same-origin",R}function p(h){if(h.ep)return;h.ep=!0;const R=m(h);fetch(h.href,R)}})();const as=800;function Pa(){const Q="3001";return console.log(`从环境变量读取后端端口: ${Q}`),parseInt(Q,10)}const Na=Pa(),wt=Cs("git",()=>{const Q=d(""),r=d([]),m=d(""),p=d(""),h=d(!1),R=d(!1),F=d(!1),E=d(0),M=d(""),P=d(!1),O=d(!1),I=d(!1),ie=d(!1),G=d(!1),oe=d(0),ue=d(0),re=d(!1),C=d(""),B=d(0),z=d(0),q=d(!0),D=d(null),K=d([]),he=d({staged:[],unstaged:[],untracked:[]}),de=d([]),V=d(!1),T=d(!1),Z=d(!1),Y=d(!1),X=d(!1),te=d([]),$e=d(!1),Te=d(!1),g=d(!1),v=d(!1);function ae(){Q.value="",r.value=[],m.value="",p.value="",h.value=!1,R.value=!1,F.value=!1,E.value=0,oe.value=0,ue.value=0,re.value=!1,C.value="",B.value=0,z.value=0,O.value=!1,I.value=!1,ie.value=!1,G.value=!1,M.value="",P.value=!1,K.value=[],he.value={staged:[],unstaged:[],untracked:[]},de.value=[],V.value=!1,T.value=!1,Z.value=!1,Y.value=!1,X.value=!1}async function N(l=!1,u=!1){if(!F.value)return;const k=Date.now();if(!l&&!u&&k-B.value<3e4){console.log("使用缓存的分支状态");return}try{console.log("获取分支状态...");let j="/api/branch-status";const ne=[];l&&ne.push("force=true"),u&&ne.push("countOnly=true"),ne.length>0&&(j+="?"+ne.join("&"));const Se=await(await fetch(j)).json();Se&&(oe.value=Se.ahead||0,ue.value=Se.behind||0,re.value=Se.hasUpstream||!1,C.value=Se.upstreamBranch||"",B.value=k,console.log(`分支状态更新：领先 ${oe.value} 个提交，落后 ${ue.value} 个提交，上游分支：${re.value?C.value:"无"}`))}catch(j){console.error("获取分支状态失败:",j),oe.value=0,ue.value=0,re.value=!1,C.value=""}}async function le(){const l=Date.now();if(l-E.value<1e3)return console.log("使用缓存的Git仓库状态:",F.value?"是":"不是"),F.value;try{const k=await(await fetch("/api/current_directory")).json();return F.value=k.isGitRepo===!0,E.value=l,console.log(`当前目录${F.value?"是":"不是"}Git仓库`),F.value}catch(u){return console.error("检查Git仓库状态失败:",u),F.value=!1,E.value=l,!1}}async function se(l=!1){try{const j=await(await fetch(l?"/api/branch?force=true":"/api/branch")).json();j.branch&&(Q.value=j.branch,console.log(`当前分支更新为: ${j.branch}${l?" (强制刷新)":""}`))}catch(u){console.error("获取分支信息失败:",u)}}async function ke(){if(F.value)try{console.log("获取所有分支...");const u=await(await fetch("/api/branches")).json();u.branches&&Array.isArray(u.branches)&&(r.value=u.branches,z.value=Date.now(),console.log(`获取到${u.branches.length}个分支`))}catch(l){console.error("获取所有分支信息失败:",l)}}async function je(l){console.log("切换到分支:",l);try{h.value=!0;const k=await(await fetch("/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch:l})})).json();return k.success?(n({message:`已切换到分支: ${l}`,type:"success"}),await se(!0),await N(!0),!0):(n({message:`切换分支失败: ${k.error}`,type:"error"}),!1)}catch(u){return n({message:`切换分支失败: ${u.message}`,type:"error"}),!1}finally{h.value=!1}}async function Re(){try{const u=await(await fetch("/api/user-info")).json();u.name&&u.email&&(m.value=u.name,p.value=u.email)}catch(l){console.error("获取用户信息失败:",l)}}async function y(l,u){if(!l.trim())return n({message:"分支名称不能为空",type:"warning"}),!1;try{R.value=!0;const j=await(await fetch("/api/create-branch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newBranchName:l,baseBranch:u||Q.value})})).json();return j.success?(n({message:`已创建并切换到分支: ${l}`,type:"success"}),await se(!0),await N(!0),await ke(),!0):(n({message:`创建分支失败: ${j.error}`,type:"error"}),!1)}catch(k){return n({message:`创建分支失败: ${k.message}`,type:"error"}),!1}finally{R.value=!1}}async function pe(){try{const u=await(await fetch("/api/clear-user-config",{method:"POST"})).json();return u.success?(m.value="",p.value="",n({message:"已清除Git用户配置",type:"success"}),!0):(n({message:`清除配置失败: ${u.error}`,type:"error"}),!1)}catch(l){return n({message:`清除配置失败: ${l.message}`,type:"error"}),!1}}async function be(l,u){try{const j=await(await fetch("/api/restore-user-config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:l,email:u})})).json();return j.success?(m.value=l,p.value=u,n({message:"已恢复Git用户配置",type:"success"}),!0):(n({message:`恢复配置失败: ${j.error}`,type:"error"}),!1)}catch(k){return n({message:`恢复配置失败: ${k.message}`,type:"error"}),!1}}async function ze(){if(!F.value)return n({message:"当前目录不是Git仓库",type:"warning"}),!1;try{I.value=!0;const u=await(await fetch("/api/pull",{method:"POST"})).json();return u.success?(n({message:"拉取成功",type:"success"}),await N(),!0):(u.needsMerge?n({message:`需要合并更改: ${u.pullOutput||"存在冲突需要手动解决"}`,type:"warning",duration:5e3}):n({message:`拉取失败: ${u.error}`,type:"error"}),!1)}catch(l){return n({message:`拉取失败: ${l.message}`,type:"error"}),!1}finally{I.value=!1}}async function Be(){if(!F.value)return n({message:"当前目录不是Git仓库",type:"warning"}),!1;try{ie.value=!0;const u=await(await fetch("/api/fetch-all",{method:"POST"})).json();return u.success?(n({message:"获取所有远程分支信息成功",type:"success"}),await N(),!0):(n({message:`获取远程分支信息失败: ${u.error}`,type:"error"}),!1)}catch(l){return n({message:`获取远程分支信息失败: ${l.message}`,type:"error"}),!1}finally{ie.value=!1}}function Ne(){D.value&&D.value.disconnect();try{const l=`http://localhost:${Na}`;if(console.log("尝试连接Socket.IO服务器:",l),D.value=fa(l,{reconnectionDelayMax:1e4,reconnection:!0,reconnectionAttempts:10,reconnectionDelay:1e3,timeout:2e4,autoConnect:!0,forceNew:!0,transports:["websocket","polling"]}),!D.value){console.error("Socket.IO初始化失败: socket为null");return}console.log("Socket.IO初始化成功，socket ID:",D.value.id||"未连接"),D.value.on("connect",()=>{console.log("成功连接到Socket.IO服务器"),q.value&&D.value&&D.value.emit("start_monitoring")}),D.value.on("disconnect",u=>{console.log("与Socket.IO服务器断开连接:",u)}),D.value.on("git_status_update",u=>{q.value&&(console.log("收到Git状态更新通知:",new Date().toLocaleTimeString()),u.porcelain!==void 0&&Ue(u.porcelain))}),D.value.on("monitoring_status",u=>{console.log("文件监控状态:",u.active?"已启动":"已停止")}),D.value.on("connect_error",u=>{console.error("Socket连接错误:",u.message)}),D.value.on("connect_timeout",()=>{console.error("Socket连接超时")}),D.value.on("reconnect",u=>{var k;console.log(`Socket重连成功，尝试次数: ${u}`),q.value&&(console.log("重连后重新发送start_monitoring请求"),(k=D.value)==null||k.emit("start_monitoring"))}),D.value.on("reconnect_attempt",u=>{console.log(`Socket尝试重连，第 ${u} 次尝试`)}),D.value.on("reconnect_error",u=>{console.error("Socket重连错误:",u.message)}),D.value.on("reconnect_failed",()=>{console.error("Socket重连失败，已达到最大重试次数")}),D.value&&!D.value.connected&&(console.log("Socket未连接，尝试手动连接..."),D.value.connect())}catch(l){console.error("Socket.IO连接初始化失败:",l)}}function Ze(){if(console.log("toggleAutoUpdate调用，当前值:",q.value),!D.value){console.error("无法切换自动更新状态: socket连接不存在"),n.error("无法连接到服务器，自动更新可能不会生效"),console.log("尝试重新建立socket连接..."),Ne(),localStorage.setItem("zen-gitsync-auto-update",q.value.toString());return}try{q.value?(console.log("发送start_monitoring命令..."),D.value.emit("start_monitoring"),n.success("自动更新已启用")):(console.log("发送stop_monitoring命令..."),D.value.emit("stop_monitoring"),n.info("自动更新已禁用")),localStorage.setItem("zen-gitsync-auto-update",q.value.toString()),console.log("已保存自动更新设置到本地存储:",q.value)}catch(l){console.error("切换自动更新状态时出错:",l),n.error(`切换自动更新失败: ${l.message}`)}}function Ue(l){if(l===void 0||l===""){de.value=[];return}const u=l.split(`
`),k=[];for(const j of u){const ne=j.match(/^([ MADRCU\?]{2})\s+(.+)$/);if(ne){let U="";const Se=ne[1],Ke=Se.charAt(0),Ft=Se.charAt(1);Ke==="A"||Ke==="M"||Ke==="D"||Ke==="R"?U="added":Ke===" "&&Ft==="M"?U="modified":Ke===" "&&Ft==="D"?U="deleted":Se==="??"?U="untracked":U="other",k.push({path:ne[2],type:U})}}de.value=k}async function Ie(l=!0){if(!F.value){console.log("当前目录不是Git仓库，跳过加载提交历史");return}try{V.value=!0,console.log("开始加载提交历史...");const u=new Date().getTime(),j=await(await fetch(`/api/log?page=1&_t=${u}`)).json();j&&j.data&&Array.isArray(j.data)?(K.value=[...j.data],console.log(`提交历史加载完成，共 ${K.value.length} 条记录`)):(console.warn("API返回的提交历史格式不正确:",j),K.value=[])}catch(u){console.error("获取提交历史失败:",u),l&&n({message:`获取提交历史失败: ${u.message}`,type:"error"})}finally{V.value=!1}}async function S(){if(!F.value){console.log("当前目录不是Git仓库，跳过加载Git状态");return}try{T.value=!0,await c()}catch(l){console.error("获取Git状态失败:",l),n({message:`获取Git状态失败: ${l.message}`,type:"error"})}finally{T.value=!1}}async function c(){if(console.log("开始获取Git状态(porcelain格式)..."),!F.value){console.log("当前目录不是Git仓库，跳过加载Git状态");return}try{const u=await(await fetch("/api/status_porcelain")).json();u.status!==void 0?Ue(u.status):de.value=[]}catch(l){console.error("获取Git状态(porcelain)失败:",l),n({message:`获取Git状态(porcelain)失败: ${l.message}`,type:"error"}),de.value=[]}}async function ee(){if(!F.value)return n.warning("当前目录不是Git仓库"),!1;try{Z.value=!0;const u=await(await fetch("/api/add",{method:"POST"})).json();return u.success?(n({message:"文件已添加到暂存区",type:"success"}),!0):(n({message:`添加文件失败: ${u.error}`,type:"error"}),!1)}catch(l){return n({message:`添加文件失败: ${l.message}`,type:"error"}),!1}finally{Z.value=!1}}async function H(l){if(!F.value)return n.warning("当前目录不是Git仓库"),!1;try{Z.value=!0;const k=await(await fetch("/api/add-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:l})})).json();return k.success?(n({message:"文件已暂存",type:"success"}),S(),!0):(n({message:`暂存文件失败: ${k.error}`,type:"error"}),!1)}catch(u){return n({message:`暂存文件失败: ${u.message}`,type:"error"}),!1}finally{Z.value=!1}}async function Ce(l){if(!F.value)return n.warning("当前目录不是Git仓库"),!1;try{X.value=!0;const k=await(await fetch("/api/unstage-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:l})})).json();return k.success?(n({message:"已取消暂存文件",type:"success"}),S(),!0):(n({message:`取消暂存失败: ${k.error}`,type:"error"}),!1)}catch(u){return n({message:`取消暂存失败: ${u.message}`,type:"error"}),!1}finally{X.value=!1}}function Le(l){return new Promise(u=>setTimeout(u,l))}async function me(l,u=!1){if(!F.value)return n.warning("当前目录不是Git仓库"),!1;try{Y.value=!0;const j=await(await fetch("/api/commit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:l,hasNewlines:l.includes(`
`),noVerify:u})})).json();return j.success?(n({message:"提交成功",type:"success"}),!0):(n({message:`commitChanges 提交失败: ${j.error}`,type:"error"}),!1)}catch(k){return n({message:`提交失败: ${k.message}`,type:"error"}),!1}finally{Y.value=!1}}async function _e(){if(!F.value)return n.warning("当前目录不是Git仓库"),!1;try{O.value=!0;const u=await(await fetch("/api/push",{method:"POST"})).json();return u.success?(n({message:"推送成功",type:"success"}),oe.value=0,ue.value=0,await Promise.all([S(),Ie()]),console.log("推送成功，分支状态已设置为同步 (ahead=0, behind=0)"),!0):(n({message:`推送失败: ${u.error}`,type:"error"}),!1)}catch(l){return n({message:`推送失败: ${l.message}`,type:"error"}),!1}finally{O.value=!1}}async function Ae(l,u={}){if(!F.value)return n({message:"当前目录不是Git仓库",type:"warning"}),!1;if(!l)return n({message:"请选择要合并的分支",type:"warning"}),!1;if(l===Q.value)return n({message:"不能合并当前分支到自身",type:"warning"}),!1;try{G.value=!0;const k=await fetch("/api/merge",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch:l,...u})}),j=await k.json();return k.status===409?(n({message:"合并分支时发生冲突，请手动解决",type:"warning",duration:5e3}),!1):j.success?(n({message:`成功合并分支 ${l} 到 ${Q.value}`,type:"success"}),await S(),await N(),!0):(n({message:`合并分支失败: ${j.error}`,type:"error"}),!1)}catch(k){return n({message:`合并分支失败: ${k.message}`,type:"error"}),!1}finally{G.value=!1}}async function ce(l,u=!1){if(console.log("开始暂存并提交操作..."),!await ee())return!1;console.log("暂存完成，等待Git操作完成..."),await Le(as),console.log("开始提交更改...");const j=await me(l,u);return console.log("暂存并提交操作完成"),j}async function ve(l,u=!1){try{if(console.log("开始暂存文件..."),!await ee()||(console.log("暂存完成，等待Git操作完成..."),await Le(as),console.log("开始提交更改..."),!await me(l,u)))return!1;console.log("提交完成，等待Git操作完成..."),await Le(as),console.log("开始推送到远程...");const ne=await _e();return console.log("一键推送操作完成，状态已统一刷新"),ne}catch(k){console.error("一键推送操作失败:",k);try{(await(await fetch("/api/remove-lock",{method:"POST"})).json()).success&&n({message:"检测到Git锁定文件冲突，已自动清理，请重试操作",type:"warning"})}catch(j){console.error("清理锁定文件失败:",j)}n({message:`操作失败: ${k.message}`,type:"error"});try{await Promise.all([S(),Ie(),N()])}catch(j){console.error("刷新状态失败:",j)}return!1}}async function He(){if(!F.value)return n.warning("当前目录不是Git仓库"),!1;try{X.value=!0;const u=await(await fetch("/api/reset-head",{method:"POST"})).json();return u.success?(n({message:"已重置暂存区",type:"success"}),S(),!0):(n({message:`重置暂存区失败: ${u.error}`,type:"error"}),!1)}catch(l){return n({message:`重置暂存区失败: ${l.message}`,type:"error"}),!1}finally{X.value=!1}}async function Je(l){if(!F.value)return n.warning("当前目录不是Git仓库"),!1;try{X.value=!0;const k=await(await fetch("/api/reset-to-remote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch:l})})).json();return k.success?(n({message:`已重置分支 ${l} 到远程状态`,type:"success"}),S(),Ie(),!0):(n({message:`重置分支失败: ${k.error}`,type:"error"}),!1)}catch(u){return n({message:`重置分支失败: ${u.message}`,type:"error"}),!1}finally{X.value=!1}}async function J(){if(F.value)try{P.value=!0,console.log("获取远程仓库地址...");const u=await(await fetch("/api/remote-url")).json();u.success?(M.value=u.url||"",console.log(`获取到远程仓库地址: ${M.value}`)):(console.warn("获取远程仓库地址失败:",u.error),M.value="")}catch(l){console.error("获取远程仓库地址失败:",l),M.value=""}finally{P.value=!1}}async function Ge(){if(!M.value)return n({message:"没有可复制的远程仓库地址",type:"warning"}),!1;try{return await navigator.clipboard.writeText(M.value),n({message:"已复制远程仓库地址",type:"success"}),!0}catch(l){return console.error("复制远程仓库地址失败:",l),n({message:`复制失败: ${l.message}`,type:"error"}),!1}}kt(()=>{const l=localStorage.getItem("zen-gitsync-auto-update");l!==null&&(q.value=l==="true"),Ne()});function ot(){D.value&&(D.value.disconnect(),D.value=null)}Ss(()=>{ot()});async function Qe(){if(!F.value)return n.warning("当前目录不是Git仓库"),[];try{$e.value=!0;const u=await(await fetch("/api/stash-list")).json();return u.success?(te.value=u.stashes,u.stashes):(n.error(`获取stash列表失败: ${u.error}`),[])}catch(l){return console.error("获取stash列表失败:",l),n.error(`获取stash列表失败: ${l.message}`),[]}finally{$e.value=!1}}async function nt(l,u=!1,k=!0){if(!F.value)return n.warning("当前目录不是Git仓库"),!1;try{v.value=!0;const ne=await(await fetch("/api/stash-save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:l,includeUntracked:u,excludeLocked:k})})).json();return ne.success?(n.success(ne.message),await Qe(),await S(),!0):(n.warning(ne.message),!1)}catch(j){return console.error("保存stash失败:",j),n.error(`保存stash失败: ${j.message}`),!1}finally{v.value=!1}}async function Me(l,u=!1){if(!F.value)return n.warning("当前目录不是Git仓库"),!1;try{Te.value=!0;const k=await fetch("/api/stash-apply",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({stashId:l,pop:u})}),j=await k.json();return k.status===409?(n.warning("应用stash时发生冲突，请手动解决"),!1):j.success?(n.success(j.message),await Qe(),await S(),!0):(n.error(`应用stash失败: ${j.error}`),!1)}catch(k){return console.error("应用stash失败:",k),n.error(`应用stash失败: ${k.message}`),!1}finally{Te.value=!1}}async function bt(l){if(!F.value)return n.warning("当前目录不是Git仓库"),!1;try{g.value=!0;const k=await(await fetch("/api/stash-drop",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({stashId:l})})).json();return k.success?(n.success(k.message),await Qe(),!0):(n.error(`删除stash失败: ${k.error}`),!1)}catch(u){return console.error("删除stash失败:",u),n.error(`删除stash失败: ${u.message}`),!1}finally{g.value=!1}}async function w(){if(!F.value)return n.warning("当前目录不是Git仓库"),!1;try{g.value=!0;const u=await(await fetch("/api/stash-clear",{method:"POST"})).json();return u.success?(n.success(u.message),te.value=[],!0):(n.error(`清空stash失败: ${u.error}`),!1)}catch(l){return console.error("清空stash失败:",l),n.error(`清空stash失败: ${l.message}`),!1}finally{g.value=!1}}return{currentBranch:Q,allBranches:r,userName:m,userEmail:p,isChangingBranch:h,isCreatingBranch:R,isGitRepo:F,lastCheckedTime:E,branchAhead:oe,branchBehind:ue,hasUpstream:re,upstreamBranch:C,lastBranchStatusTime:B,lastBranchesTime:z,remoteUrl:M,isLoadingRemoteUrl:P,stashes:te,isLoadingStashes:$e,isApplyingStash:Te,isDroppingStash:g,isSavingStash:v,log:K,status:he,fileList:de,isLoadingLog:V,isLoadingStatus:T,isAddingFiles:Z,isCommiting:Y,isResetting:X,autoUpdateEnabled:q,isPushing:O,isGitPulling:I,isGitFetching:ie,isGitMerging:G,$reset:ae,checkGitRepo:le,getCurrentBranch:se,getAllBranches:ke,changeBranch:je,getUserInfo:Re,createBranch:y,clearUserConfig:pe,restoreUserConfig:be,getBranchStatus:N,gitPull:ze,gitFetchAll:Be,initSocketConnection:Ne,toggleAutoUpdate:Ze,parseStatusPorcelain:Ue,fetchLog:Ie,fetchStatus:S,fetchStatusPorcelain:c,addToStage:ee,addFileToStage:H,unstageFile:Ce,commitChanges:me,pushToRemote:_e,addAndCommit:ce,addCommitAndPush:ve,resetHead:He,resetToRemote:Je,getRemoteUrl:J,copyRemoteUrl:Ge,mergeBranch:Ae,getStashList:Qe,saveStash:nt,applyStash:Me,dropStash:bt,clearAllStashes:w,socket:D,disconnectSocket:ot}}),ds=Cs("config",()=>{const Q=d(""),r=d([]),m=d([]),p=d([]),h=d([]),R=d(!1),F=d(!1),E=fe(()=>({defaultCommitMessage:Q.value,descriptionTemplates:r.value,scopeTemplates:m.value,messageTemplates:p.value,lockedFiles:h.value}));async function M(C=!1){if(!C&&F.value&&!R.value)return console.log("使用缓存的配置信息"),E.value;try{R.value=!0,console.log("加载配置信息...");const z=await(await fetch("/api/config/getConfig")).json();return Q.value=z.defaultCommitMessage||"",r.value=z.descriptionTemplates||[],m.value=z.scopeTemplates||[],p.value=z.messageTemplates||[],h.value=z.lockedFiles||[],F.value=!0,console.log("配置信息加载完成"),E.value}catch(B){return console.error("加载配置失败:",B),n.error(`加载配置失败: ${B.message}`),null}finally{R.value=!1}}async function P(C){try{const z=await(await fetch("/api/config/saveDefaultMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({defaultCommitMessage:C})})).json();return z.success?(Q.value=C,n.success("默认提交信息已保存"),!0):(n.error(`保存失败: ${z.error}`),!1)}catch(B){return n.error(`保存失败: ${B.message}`),!1}}async function O(C,B){try{const q=await(await fetch("/api/config/save-template",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({template:C,type:B})})).json();return q.success?(B==="description"?r.value.includes(C)||r.value.push(C):B==="scope"?m.value.includes(C)||m.value.push(C):B==="message"&&(p.value.includes(C)||p.value.push(C)),n.success("模板已保存"),!0):(n.error(`保存模板失败: ${q.error}`),!1)}catch(z){return n.error(`保存模板失败: ${z.message}`),!1}}async function I(C,B){try{const q=await(await fetch("/api/config/delete-template",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({template:C,type:B})})).json();return q.success?(B==="description"?r.value=r.value.filter(D=>D!==C):B==="scope"?m.value=m.value.filter(D=>D!==C):B==="message"&&(p.value=p.value.filter(D=>D!==C)),n.success("模板已删除"),!0):(n.error(`删除模板失败: ${q.error}`),!1)}catch(z){return n.error(`删除模板失败: ${z.message}`),!1}}async function ie(C,B,z){try{const D=await(await fetch("/api/config/update-template",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldTemplate:C,newTemplate:B,type:z})})).json();if(D.success){if(z==="description"){const K=r.value.indexOf(C);K!==-1&&(r.value[K]=B)}else if(z==="scope"){const K=m.value.indexOf(C);K!==-1&&(m.value[K]=B)}else if(z==="message"){const K=p.value.indexOf(C);K!==-1&&(p.value[K]=B)}return n.success("模板已更新"),!0}else return n.error(`更新模板失败: ${D.error}`),!1}catch(q){return n.error(`更新模板失败: ${q.message}`),!1}}async function G(){try{const B=await(await fetch("/api/locked-files")).json();return B.success?(h.value=B.lockedFiles||[],B.lockedFiles):(n.error(`加载锁定文件列表失败: ${B.error}`),[])}catch(C){return console.error("加载锁定文件列表失败:",C),n.error(`加载锁定文件列表失败: ${C.message}`),[]}}async function oe(C){try{const z=await(await fetch("/api/lock-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:C})})).json();return z.success?(await G(),n.success(`文件已锁定: ${C}`),!0):(n.error(`锁定文件失败: ${z.error}`),!1)}catch(B){return console.error("锁定文件失败:",B),n.error(`锁定文件失败: ${B.message}`),!1}}async function ue(C){try{const z=await(await fetch("/api/unlock-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:C})})).json();return z.success?(await G(),n.success(`文件已解锁: ${C}`),!0):(n.error(`解锁文件失败: ${z.error}`),!1)}catch(B){return console.error("解锁文件失败:",B),n.error(`解锁文件失败: ${B.message}`),!1}}async function re(C){try{const z=await(await fetch("/api/check-file-lock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:C})})).json();return z.success?z.isLocked:(console.error("检查文件锁定状态失败:",z.error),!1)}catch(B){return console.error("检查文件锁定状态失败:",B),!1}}return{defaultCommitMessage:Q,descriptionTemplates:r,scopeTemplates:m,messageTemplates:p,lockedFiles:h,isLoading:R,isLoaded:F,config:E,loadConfig:M,saveDefaultMessage:P,saveTemplate:O,deleteTemplate:I,updateTemplate:ie,loadLockedFiles:G,lockFile:oe,unlockFile:ue,isFileLocked:re}});function Ia(Q){return Q.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function Ha(Q){return Q?Q.split(`
`).map(m=>{const p=Ia(m);return m.startsWith("diff --git")||m.startsWith("diff --cc")||m.startsWith("diff --combined")?`<div class="diff-header">${p}</div>`:m.startsWith("---")?`<div class="diff-old-file">${p}</div>`:m.startsWith("+++")?`<div class="diff-new-file">${p}</div>`:m.startsWith("@@")?`<div class="diff-hunk-header">${p}</div>`:m.startsWith("+")?`<div class="diff-added">${p}</div>`:m.startsWith("-")?`<div class="diff-removed">${p}</div>`:`<div class="diff-context">${p}</div>`}).join(""):""}function Ja(Q){return Q?Q.trim():"(无提交信息)"}function Wa(Q){if(!Q)return"";const r=/^(feat|fix|docs|style|refactor|perf|test|chore|build|ci|revert)(\([^)]+\))?\s*:\s*(.+)$/s,m=Q.match(r);return m?m[3].trim():Q.trim()}const qa={key:0,class:"files-panel"},Ya={class:"panel-header"},Xa={key:0,class:"file-count"},Ka={class:"files-list"},Za=["onClick"],Qa={class:"file-name"},el={class:"panel-header"},tl={key:0,class:"selected-file"},sl={class:"diff-content"},al=["innerHTML"],ll=pt({__name:"FileDiffViewer",props:{files:{},emptyText:{default:"没有找到变更文件"},diffContent:{default:""},selectedFile:{default:""},height:{default:"100%"},showFileList:{type:Boolean,default:!0}},emits:["file-select"],setup(Q,{emit:r}){const m=Q,p=r,h=d(""),R=fe(()=>m.selectedFile||h.value),F=fe(()=>m.files.map(P=>({...P,displayName:P.name||P.path.split("/").pop()||P.path}))),E=fe(()=>m.diffContent&&m.diffContent.trim()!=="");function M(P){h.value=P,p("file-select",P)}return Ye(()=>m.selectedFile,P=>{P!==void 0&&(h.value=P)}),Ye(()=>m.files,P=>{if(P.length>0&&!R.value){const O=P[0];M(O.path)}},{immediate:!0}),(P,O)=>(f(),$("div",{class:"file-diff-viewer",style:dt({height:P.height})},[P.showFileList?(f(),$("div",qa,[e("div",Ya,[O[0]||(O[0]=e("h4",null,"变更文件",-1)),P.files.length>0?(f(),$("span",Xa,"("+L(P.files.length)+")",1)):A("",!0)]),e("div",Ka,[t(o(pa),{height:"100%"},{default:a(()=>[P.files.length===0?(f(),W(o(Et),{key:0,description:P.emptyText,"image-size":60},null,8,["description"])):A("",!0),(f(!0),$(we,null,Fe(F.value,I=>(f(),$("div",{key:I.path,class:ge(["file-item",{active:I.path===R.value,[`file-type-${I.type}`]:I.type}]),onClick:ie=>M(I.path)},[t(o($t),{class:"file-icon"},{default:a(()=>[t(o(ns))]),_:1}),t(o(Nt),{content:I.path,placement:"top",disabled:I.displayName.length<=35,"hide-after":1e3},{default:a(()=>[e("span",Qa,L(I.displayName),1)]),_:2},1032,["content","disabled"])],10,Za))),128))]),_:1})])])):A("",!0),e("div",{class:ge(["diff-panel",{"full-width":!P.showFileList}])},[e("div",el,[O[1]||(O[1]=e("h4",null,"文件差异",-1)),R.value?(f(),$("span",tl,L(R.value.split("/").pop()),1)):A("",!0)]),e("div",sl,[E.value?(f(),$("div",{key:1,class:"diff-text",innerHTML:o(Ha)(P.diffContent)},null,8,al)):(f(),W(o(Et),{key:0,description:R.value?"该文件没有差异内容":"请选择文件查看差异","image-size":80},null,8,["description"]))])],2)],4))}}),mt=(Q,r)=>{const m=Q.__vccOpts||Q;for(const[p,h]of r)m[p]=h;return m},fs=mt(ll,[["__scopeId","data-v-eb828e1c"]]),ol={class:"common-dialog__footer"},nl=pt({__name:"CommonDialog",props:{modelValue:{type:Boolean},title:{},size:{default:"medium"},type:{default:"default"},width:{},height:{},top:{default:"8vh"},closeOnClickModal:{type:Boolean,default:!1},closeOnPressEscape:{type:Boolean,default:!0},destroyOnClose:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},customClass:{},appendToBody:{type:Boolean,default:!1},lockScroll:{type:Boolean,default:!0},showFooter:{type:Boolean,default:!1},confirmText:{default:"确定"},cancelText:{default:"取消"},showCancel:{type:Boolean,default:!0},confirmLoading:{type:Boolean,default:!1}},emits:["update:modelValue","confirm","cancel","close","opened","closed"],setup(Q,{emit:r}){const m=Q,p=r,h=fe(()=>{if(m.width)return m.width;switch(m.size){case"small":return"30%";case"medium":return"50%";case"large":return"80%";case"extra-large":return"90%";default:return"50%"}}),R=fe(()=>{if(m.height)return m.height;switch(m.type){case"full-height":return"calc(100vh - 100px)";case"flex":return"calc(100vh - 160px)";default:return"auto"}}),F=fe(()=>{const G={};return(m.type==="full-height"||m.type==="flex")&&(G["--dialog-height"]=R.value),G}),E=fe(()=>{const G=[];return m.customClass&&G.push(m.customClass),m.type==="flex"&&G.push("common-dialog--flex"),m.type==="full-height"&&G.push("common-dialog--full-height"),G.join(" ")});function M(){p("update:modelValue",!1),p("close")}function P(){p("confirm")}function O(){p("cancel"),M()}function I(){p("opened")}function ie(){p("closed")}return(G,oe)=>{const ue=De;return f(),W(o(It),{"model-value":G.modelValue,title:G.title,width:h.value,top:G.top,style:dt(F.value),"close-on-click-modal":G.closeOnClickModal,"close-on-press-escape":G.closeOnPressEscape,"destroy-on-close":G.destroyOnClose,draggable:G.draggable,class:ge(E.value),"append-to-body":G.appendToBody,"lock-scroll":G.lockScroll,onClose:M,onOpened:I,onClosed:ie},ma({default:a(()=>[_s(G.$slots,"default",{},void 0,!0)]),_:2},[G.showFooter||G.$slots.footer?{name:"footer",fn:a(()=>[_s(G.$slots,"footer",{},()=>[e("div",ol,[G.showCancel?(f(),W(ue,{key:0,onClick:O},{default:a(()=>[_(L(G.cancelText),1)]),_:1})):A("",!0),t(ue,{type:"primary",loading:G.confirmLoading,onClick:P},{default:a(()=>[_(L(G.confirmText),1)]),_:1},8,["loading"])])],!0)]),key:"0"}:void 0]),1032,["model-value","title","width","top","style","close-on-click-modal","close-on-press-escape","destroy-on-close","draggable","class","append-to-body","lock-scroll"])}}}),zt=mt(nl,[["__scopeId","data-v-c1505473"]]),il={class:"card"},rl={class:"status-header"},cl={class:"header-actions"},ul=["element-loading-text"],dl={key:0,class:"status-box"},fl={key:1,class:"status-box-wrap"},pl={key:0,class:"branch-status-info"},ml={class:"branch-sync-status"},vl={class:"sync-status-content"},gl={class:"status-badges"},hl={class:"badge-content"},yl={class:"badge-content"},_l={key:1,class:"file-list-container"},wl={key:0,class:"file-group"},kl={class:"file-list"},$l=["onClick"],bl={class:"file-info"},Cl={class:"file-name-section"},Sl=["title"],Tl={class:"file-directory"},Vl={class:"file-actions"},xl={key:1,class:"file-group"},Ll={class:"file-list"},zl=["onClick"],Bl={class:"file-info"},Fl={class:"file-name-section"},Dl=["title"],Rl={class:"file-directory"},Gl={class:"file-actions"},Ol={key:2,class:"file-group"},jl={class:"file-list"},Ul=["onClick"],Al={class:"file-info"},El={class:"file-name-section"},Ml=["title"],Pl={class:"file-directory"},Nl={class:"file-actions"},Il={key:2,class:"empty-status"},Hl={class:"empty-icon"},Jl={class:"lock-feature-description"},Wl={class:"description-header"},ql={key:0,class:"empty-locked-files"},Yl={class:"empty-icon"},Xl={key:1,class:"locked-files-list"},Kl={class:"locked-files-header"},Zl={class:"locked-file-items"},Ql={class:"file-info"},eo={class:"file-path-container"},to={class:"file-name"},so={class:"file-directory"},ao={class:"file-actions"},lo={class:"dialog-footer"},oo=pt({__name:"GitStatus",props:{initialDirectory:{type:String,default:""}},setup(Q,{expose:r}){const m=Q,p=wt(),h=ds(),R=fe(()=>p.isLoadingStatus),F=d(""),E=d(""),M=d(!1),P=d(!1),O=d(-1),I=fe(()=>p.fileList.map(g=>({path:g.path,name:g.path.split("/").pop()||g.path,type:g.type})));async function ie(g){await z(g)}const G=d(!1),oe=d({staged:!1,unstaged:!1,untracked:!1}),ue=d(m.initialDirectory||"");async function re(){try{if(!ue.value){const v=await(await fetch("/api/current_directory")).json();ue.value=v.directory||"未知目录"}if(!p.isGitRepo)return;await p.fetchStatus(),await p.getBranchStatus(),n({message:"Git 状态已刷新",type:"success"})}catch(g){n({message:"刷新失败: "+g.message,type:"error"})}}async function C(g){try{await Ee.confirm(`确认解锁该文件？
${g}`,"确认解锁",{type:"warning",confirmButtonText:"解锁",cancelButtonText:"取消"}),await h.unlockFile(g)}catch{}}async function B(){if(h.lockedFiles.length)try{await Ee.confirm(`确认解锁所有已锁定文件？共 ${h.lockedFiles.length} 个。`,"清空全部锁定",{type:"warning",confirmButtonText:"全部解锁",cancelButtonText:"取消"});const g=[...h.lockedFiles];await Promise.all(g.map(v=>h.unlockFile(v))),await h.loadLockedFiles(),n.success("已清空所有文件锁定")}catch{}}async function z(g){try{P.value=!0,F.value=g,O.value=p.fileList.findIndex(ae=>ae.path===g);const v=p.fileList[O.value];if(v&&v.type==="untracked")try{const N=await(await fetch(`/api/file-content?file=${encodeURIComponent(g)}`)).json();N.success&&N.content?E.value=`diff --git a/${g} b/${g}
新文件: ${g}
--- /dev/null
+++ b/${g}
@@ -0,0 +1,${N.content.split(`
`).length} @@
`+N.content.split(`
`).map(le=>`+${le}`).join(`
`):E.value=`这是一个新文件，尚未被Git跟踪。
添加到暂存区后可以提交该文件。`}catch(ae){console.error("获取未跟踪文件内容失败:",ae),E.value=`这是一个新文件，尚未被Git跟踪。
添加到暂存区后可以提交该文件。`}else if(v&&v.type==="added"){const N=await(await fetch(`/api/diff-cached?file=${encodeURIComponent(g)}`)).json();E.value=N.diff||"没有变更"}else{const N=await(await fetch(`/api/diff?file=${encodeURIComponent(g)}`)).json();E.value=N.diff||"没有变更"}}catch(v){n({message:"获取文件差异失败: "+v.message,type:"error"}),E.value="获取差异失败: "+v.message}finally{P.value=!1}}function q(g){if(M.value=!0,p.fileList.length>0){const v=p.fileList.find(ae=>ae.path===g.path)||p.fileList[0];z(v.path)}}async function D(g){await p.addFileToStage(g)}async function K(g){await p.unstageFile(g)}async function he(){await de()}async function de(){try{if(!p.isGitRepo)return;await p.fetchStatus(),n({message:"Git 文件状态已刷新",type:"success"})}catch(g){n({message:"刷新失败: "+g.message,type:"error"})}}async function V(){try{await p.gitPull(),await re()}catch(g){console.error("拉取操作发生错误:",g)}}async function T(){try{await p.gitFetchAll(),await re()}catch(g){console.error("获取远程分支信息操作发生错误:",g)}}async function Z(g){try{await Ee.confirm(`确定要撤回文件 "${g}" 的所有修改吗？此操作无法撤销。`,"撤回修改",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const ae=await(await fetch("/api/revert_file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:g})})).json();ae.success?(n.success("已撤回文件修改"),await re()):n.error(ae.error?`撤回失败: ${ae.error}`:"撤回文件修改失败，请重试")}catch(v){if(v==="cancel"||v.message==="cancel")return;const ae=v.message||"未知错误";ae!=="undefined"?n.error(`撤回文件修改失败: ${ae}`):n.error("撤回文件修改失败，请重试")}}function Y(g){const v=g.split("/");return v[v.length-1]}function X(g){const v=g.split("/");return v.length<=1?"":v.slice(0,-1).join("/")}function te(g){const v=g.replace(/\\/g,"/"),ae=h.lockedFiles.some(N=>{const le=N.replace(/\\/g,"/");return v===le});return(g==="test/2.txt"||g==="2.txt")&&console.log("检查文件锁定状态:",{filePath:g,normalizedPath:v,lockedFiles:h.lockedFiles,normalizedLockedFiles:h.lockedFiles.map(N=>N.replace(/\\/g,"/")),isLocked:ae}),ae}function $e(g){te(g)?h.unlockFile(g):h.lockFile(g)}function Te(g){oe.value[g]=!oe.value[g]}return kt(()=>{re(),h.loadConfig(),h.loadLockedFiles()}),Ye(()=>p.autoUpdateEnabled,(g,v)=>{console.log(`自动更新状态变更: ${v} -> ${g}`),p.toggleAutoUpdate()},{immediate:!1}),r({refreshStatus:he}),(g,v)=>{const ae=Ts,N=Nt,le=De,se=$t,ke=Bt,je=ga,Re=is;return f(),$(we,null,[e("div",il,[e("div",rl,[v[8]||(v[8]=e("h2",null,"Git 状态",-1)),e("div",cl,[t(N,{content:o(p).autoUpdateEnabled?"禁用自动更新文件状态":"启用自动更新文件状态",placement:"top","hide-after":1e3},{default:a(()=>[t(ae,{modelValue:o(p).autoUpdateEnabled,"onUpdate:modelValue":v[0]||(v[0]=y=>o(p).autoUpdateEnabled=y),style:{"--el-switch-on-color":"#67C23A","--el-switch-off-color":"#909399","margin-right":"10px"},"inline-prompt":"","active-icon":o(Vs),"inactive-icon":o(os),class:"auto-update-switch"},null,8,["modelValue","active-icon","inactive-icon"])]),_:1},8,["content"]),t(N,{content:"Git Pull (拉取远程更新)",placement:"top","hide-after":1e3},{default:a(()=>[t(le,{type:"primary",icon:o(xs),circle:"",size:"small",onClick:V,loading:o(p).isGitPulling,disabled:!o(p).hasUpstream},null,8,["icon","loading","disabled"])]),_:1}),t(N,{content:"Git Fetch All (获取所有远程分支)",placement:"top","hide-after":1e3},{default:a(()=>[Xe(t(le,{type:"primary",icon:o(Ls),circle:"",size:"small",onClick:T,loading:o(p).isGitFetching},null,8,["icon","loading"]),[[ft,!1]])]),_:1}),o(h).lockedFiles.length>0?(f(),W(N,{key:0,content:"管理锁定文件",placement:"top","hide-after":1e3},{default:a(()=>[t(le,{type:"warning",circle:"",size:"small",onClick:v[1]||(v[1]=y=>G.value=!0)},{default:a(()=>[t(se,null,{default:a(()=>[t(o(lt))]),_:1})]),_:1})]),_:1})):A("",!0),t(N,{content:"刷新状态",placement:"top","hide-after":1e3},{default:a(()=>[t(le,{type:"primary",icon:o(va),circle:"",size:"small",onClick:he,loading:R.value},null,8,["icon","loading"])]),_:1})])]),Xe((f(),$("div",{class:"card-content","element-loading-text":o(p).isGitPulling?"正在拉取代码...":"正在获取远程分支信息..."},[o(p).isGitRepo?(f(),$("div",fl,[o(p).hasUpstream&&(o(p).branchAhead>0||o(p).branchBehind>0)?(f(),$("div",pl,[e("div",ml,[e("div",vl,[t(N,{content:"本地分支与远程分支的状态对比",placement:"top"},{default:a(()=>[e("div",gl,[o(p).branchAhead>0?(f(),W(ke,{key:0,size:"small",type:"warning",class:"status-badge"},{default:a(()=>[e("span",hl,[t(se,null,{default:a(()=>[t(o(zs))]),_:1}),_(" 你的分支领先 'origin/"+L(o(p).currentBranch)+"' "+L(o(p).branchAhead)+" 个提交 ",1)])]),_:1})):A("",!0),o(p).branchBehind>0?(f(),W(ke,{key:1,size:"small",type:"info",class:"status-badge"},{default:a(()=>[e("span",yl,[t(se,null,{default:a(()=>[t(o(yt))]),_:1}),_(" 你的分支落后 'origin/"+L(o(p).currentBranch)+"' "+L(o(p).branchBehind)+" 个提交 ",1)])]),_:1})):A("",!0)])]),_:1})])])])):A("",!0),o(p).fileList.length?(f(),$("div",_l,[o(p).fileList.some(y=>y.type==="added")?(f(),$("div",wl,[e("div",{class:"file-group-header",onClick:v[2]||(v[2]=y=>Te("staged"))},[t(se,{class:ge(["collapse-icon",{collapsed:oe.value.staged}])},{default:a(()=>[t(o(yt))]),_:1},8,["class"]),v[10]||(v[10]=e("span",null,"已暂存的更改",-1))]),Xe(e("div",kl,[(f(!0),$(we,null,Fe(o(p).fileList.filter(y=>y.type==="added"),y=>(f(),$("div",{key:y.path,class:"file-item",onClick:pe=>q(y)},[e("div",bl,[e("div",{class:ge(["file-status-indicator",["added",{locked:te(y.path)}]])},null,2),e("div",Cl,[t(N,{content:Y(y.path),placement:"top",disabled:Y(y.path).length<=25,"hide-after":1e3},{default:a(()=>[e("span",{class:ge(["file-name",{"locked-file-name":te(y.path)}])},[_(L(Y(y.path))+" ",1),te(y.path)?(f(),W(se,{key:0,class:"lock-indicator"},{default:a(()=>[t(o(lt))]),_:1})):A("",!0)],2)]),_:2},1032,["content","disabled"])]),e("div",{class:"file-path-section",title:X(y.path)},[t(N,{content:X(y.path),placement:"top",disabled:X(y.path).length<=30,"hide-after":1e3},{default:a(()=>[e("span",Tl,L(X(y.path)),1)]),_:2},1032,["content","disabled"])],8,Sl)]),e("div",Vl,[t(N,{content:te(y.path)?"解锁文件":"锁定文件",placement:"top","hide-after":1e3},{default:a(()=>[t(le,{type:te(y.path)?"danger":"info",size:"small",circle:"",onClick:qe(pe=>$e(y.path),["stop"]),class:"file-action-btn"},{default:a(()=>[t(se,{size:"12"},{default:a(()=>[(f(),W(_t(te(y.path)?o(lt):o(Ut))))]),_:2},1024)]),_:2},1032,["type","onClick"])]),_:2},1032,["content"]),t(N,{content:"取消暂存",placement:"top","hide-after":1e3},{default:a(()=>[t(le,{type:"warning",size:"small",circle:"",onClick:qe(pe=>K(y.path),["stop"]),class:"file-action-btn"},{default:a(()=>v[11]||(v[11]=[_("-")])),_:2},1032,["onClick"])]),_:2},1024)])],8,$l))),128))],512),[[ft,!oe.value.staged]])])):A("",!0),o(p).fileList.some(y=>y.type==="modified"||y.type==="deleted")?(f(),$("div",xl,[e("div",{class:"file-group-header",onClick:v[3]||(v[3]=y=>Te("unstaged"))},[t(se,{class:ge(["collapse-icon",{collapsed:oe.value.unstaged}])},{default:a(()=>[t(o(yt))]),_:1},8,["class"]),v[12]||(v[12]=e("span",null,"未暂存的更改",-1))]),Xe(e("div",Ll,[(f(!0),$(we,null,Fe(o(p).fileList.filter(y=>y.type==="modified"||y.type==="deleted"),y=>(f(),$("div",{key:y.path,class:"file-item",onClick:pe=>q(y)},[e("div",Bl,[e("div",{class:ge(["file-status-indicator",[y.type,{locked:te(y.path)}]])},null,2),e("div",Fl,[t(N,{content:Y(y.path),placement:"top",disabled:Y(y.path).length<=25,"hide-after":1e3},{default:a(()=>[e("span",{class:ge(["file-name",{"locked-file-name":te(y.path)}])},[_(L(Y(y.path))+" ",1),te(y.path)?(f(),W(se,{key:0,class:"lock-indicator"},{default:a(()=>[t(o(lt))]),_:1})):A("",!0)],2)]),_:2},1032,["content","disabled"])]),e("div",{class:"file-path-section",title:X(y.path)},[t(N,{content:X(y.path),placement:"top",disabled:X(y.path).length<=30,"hide-after":1e3},{default:a(()=>[e("span",Rl,L(X(y.path)),1)]),_:2},1032,["content","disabled"])],8,Dl)]),e("div",Gl,[t(N,{content:te(y.path)?"解锁文件":"锁定文件",placement:"top","hide-after":1e3},{default:a(()=>[t(le,{type:te(y.path)?"danger":"info",size:"small",circle:"",onClick:qe(pe=>$e(y.path),["stop"]),class:"file-action-btn"},{default:a(()=>[t(se,{size:"12"},{default:a(()=>[(f(),W(_t(te(y.path)?o(lt):o(Ut))))]),_:2},1024)]),_:2},1032,["type","onClick"])]),_:2},1032,["content"]),t(N,{content:"添加到暂存区",placement:"top","hide-after":1e3},{default:a(()=>[t(le,{type:"success",size:"small",circle:"",onClick:qe(pe=>D(y.path),["stop"]),class:"file-action-btn"},{default:a(()=>v[13]||(v[13]=[_("+")])),_:2},1032,["onClick"])]),_:2},1024),t(N,{content:"撤回修改",placement:"top","hide-after":1e3},{default:a(()=>[t(le,{type:"danger",size:"small",icon:o(rs),circle:"",onClick:qe(pe=>Z(y.path),["stop"]),class:"file-action-btn"},null,8,["icon","onClick"])]),_:2},1024)])],8,zl))),128))],512),[[ft,!oe.value.unstaged]])])):A("",!0),o(p).fileList.some(y=>y.type==="untracked")?(f(),$("div",Ol,[e("div",{class:"file-group-header",onClick:v[4]||(v[4]=y=>Te("untracked"))},[t(se,{class:ge(["collapse-icon",{collapsed:oe.value.untracked}])},{default:a(()=>[t(o(yt))]),_:1},8,["class"]),v[14]||(v[14]=e("span",null,"未跟踪的文件",-1))]),Xe(e("div",jl,[(f(!0),$(we,null,Fe(o(p).fileList.filter(y=>y.type==="untracked"),y=>(f(),$("div",{key:y.path,class:"file-item",onClick:pe=>q(y)},[e("div",Al,[e("div",{class:ge(["file-status-indicator",["untracked",{locked:te(y.path)}]])},null,2),e("div",El,[t(N,{content:Y(y.path),placement:"top",disabled:Y(y.path).length<=25,"hide-after":1e3},{default:a(()=>[e("span",{class:ge(["file-name",{"locked-file-name":te(y.path)}])},[_(L(Y(y.path))+" ",1),te(y.path)?(f(),W(se,{key:0,class:"lock-indicator"},{default:a(()=>[t(o(lt))]),_:1})):A("",!0)],2)]),_:2},1032,["content","disabled"])]),e("div",{class:"file-path-section",title:X(y.path)},[t(N,{content:X(y.path),placement:"top",disabled:X(y.path).length<=30,"hide-after":1e3},{default:a(()=>[e("span",Pl,L(X(y.path)),1)]),_:2},1032,["content","disabled"])],8,Ml)]),e("div",Nl,[t(N,{content:te(y.path)?"解锁文件":"锁定文件",placement:"top","hide-after":1e3},{default:a(()=>[t(le,{type:te(y.path)?"danger":"info",size:"small",circle:"",onClick:qe(pe=>$e(y.path),["stop"]),class:"file-action-btn"},{default:a(()=>[t(se,{size:"12"},{default:a(()=>[(f(),W(_t(te(y.path)?o(lt):o(Ut))))]),_:2},1024)]),_:2},1032,["type","onClick"])]),_:2},1032,["content"]),t(N,{content:"添加到暂存区",placement:"top","hide-after":1e3},{default:a(()=>[t(le,{type:"success",size:"small",circle:"",onClick:qe(pe=>D(y.path),["stop"]),class:"file-action-btn"},{default:a(()=>v[15]||(v[15]=[_("+")])),_:2},1032,["onClick"])]),_:2},1024),t(N,{content:"删除文件",placement:"top","hide-after":1e3},{default:a(()=>[t(le,{type:"danger",size:"small",icon:o(os),circle:"",onClick:qe(pe=>Z(y.path),["stop"]),class:"file-action-btn"},null,8,["icon","onClick"])]),_:2},1024)])],8,Ul))),128))],512),[[ft,!oe.value.untracked]])])):A("",!0)])):o(p).isGitRepo?(f(),$("div",Il,[e("div",Hl,[t(se,null,{default:a(()=>[t(o(ns))]),_:1})]),v[16]||(v[16]=e("div",{class:"empty-text"},"没有检测到任何更改",-1)),v[17]||(v[17]=e("div",{class:"empty-subtext"},"工作区是干净的",-1))])):A("",!0)])):(f(),$("div",dl,v[9]||(v[9]=[e("div",{class:"empty-status"},[e("p",null,"当前目录不是Git仓库")],-1)])))],8,ul)),[[Re,o(p).isGitPulling||o(p).isGitFetching]])]),t(zt,{modelValue:M.value,"onUpdate:modelValue":v[5]||(v[5]=y=>M.value=y),title:"文件差异","custom-class":"file-diff-dialog",size:"extra-large",type:"flex","destroy-on-close":""},{default:a(()=>[t(fs,{files:I.value,diffContent:E.value,selectedFile:F.value,emptyText:"选择文件查看差异",onFileSelect:ie},null,8,["files","diffContent","selectedFile"])]),_:1},8,["modelValue"]),t(zt,{modelValue:G.value,"onUpdate:modelValue":v[7]||(v[7]=y=>G.value=y),title:"锁定文件管理",size:"large","destroy-on-close":""},{footer:a(()=>[e("span",lo,[t(le,{onClick:v[6]||(v[6]=y=>G.value=!1)},{default:a(()=>v[25]||(v[25]=[_("关闭")])),_:1})])]),default:a(()=>[e("div",Jl,[e("div",Wl,[t(se,{class:"description-icon"},{default:a(()=>[t(o(ws))]),_:1}),v[18]||(v[18]=e("span",{class:"description-title"},"文件锁定功能说明",-1))]),v[19]||(v[19]=e("div",{class:"description-content"},[e("p",null,[e("strong",null,"🔒 锁定文件的作用：")]),e("ul",null,[e("li",null,"锁定的文件在执行 Git 提交时会被自动跳过，不会被添加到暂存区"),e("li",null,"适用于临时文件、配置文件、或不想提交的开发中文件"),e("li",null,"锁定状态会持久保存，直到手动解锁")]),e("p",null,[e("strong",null,"💡 使用场景：")]),e("ul",null,[e("li",null,"开发过程中的临时测试文件"),e("li",null,"本地配置文件（如数据库连接、API密钥等）"),e("li",null,"正在开发但还不想提交的功能文件")])],-1))]),t(je),o(h).lockedFiles.length===0?(f(),$("div",ql,[e("div",Yl,[t(se,null,{default:a(()=>[t(o(lt))]),_:1})]),v[20]||(v[20]=e("p",null,"当前没有锁定的文件",-1)),v[21]||(v[21]=e("p",{class:"empty-tip"},"您可以在文件列表中点击锁定按钮来锁定文件",-1))])):(f(),$("div",Xl,[e("div",Kl,[e("span",null,"🔒 已锁定 "+L(o(h).lockedFiles.length)+" 个文件",1),t(N,{content:"这些文件在提交时会被自动跳过",placement:"top"},{default:a(()=>[t(se,{class:"info-icon"},{default:a(()=>[t(o(ws))]),_:1})]),_:1}),v[23]||(v[23]=e("div",{style:{flex:"1"}},null,-1)),t(le,{type:"danger",size:"small",plain:"",disabled:!o(h).lockedFiles.length,onClick:B},{default:a(()=>v[22]||(v[22]=[_(" 清空全部锁定 ")])),_:1},8,["disabled"])]),e("div",Zl,[(f(!0),$(we,null,Fe(o(h).lockedFiles,y=>(f(),$("div",{key:y,class:"locked-file-item"},[e("div",Ql,[v[24]||(v[24]=e("div",{class:"file-status-indicator locked"},null,-1)),e("div",eo,[e("span",to,L(Y(y)),1),e("span",so,L(X(y)),1)])]),e("div",ao,[t(N,{content:"解锁文件",placement:"top","hide-after":1e3},{default:a(()=>[t(le,{type:"danger",size:"small",circle:"",class:"file-action-btn",icon:o(Ut),"aria-label":"解锁",onClick:pe=>C(y)},null,8,["icon","onClick"])]),_:2},1024)])]))),128))])]))]),_:1},8,["modelValue"])],64)}}}),no=mt(oo,[["__scopeId","data-v-8f451bd3"]]),io={class:"card-header"},ro={class:"header-actions"},co={key:0,class:"pushing-indicator"},uo={class:"pushing-text"},fo={key:0,class:"push-success-indicator"},po={class:"card-content"},mo={class:"layout-container"},vo={key:0,class:"git-config-warning"},go={key:1,class:"commit-section"},ho={class:"commit-options"},yo={class:"options-row"},_o={class:"commit-mode-toggle"},wo={class:"no-verify-toggle"},ko={key:0,class:"commit-form"},$o={class:"description-container"},bo={class:"preview-section"},Co={class:"preview-content code-command"},So={class:"form-bottom-actions"},To={class:"actions-flex-container"},Vo={class:"left-actions"},xo={class:"button-grid"},Lo={key:0},zo={key:0},Bo={key:0},Fo={class:"right-actions"},Do={class:"one-push-content"},Ro={key:1,class:"standard-commit-form"},Go={class:"standard-commit-header"},Oo={class:"type-scope-container"},jo={class:"scope-wrapper"},Uo={class:"description-container"},Ao={class:"advanced-fields"},Eo={class:"preview-section"},Mo={class:"preview-content code-command"},Po={class:"form-bottom-actions"},No={class:"actions-flex-container"},Io={class:"left-actions"},Ho={class:"button-grid"},Jo={key:0},Wo={key:0},qo={key:0},Yo={class:"right-actions"},Xo={class:"one-push-content"},Ko={class:"actions-section"},Zo={class:"action-groups"},Qo={class:"operations-wrapper"},en={class:"action-group"},tn={class:"group-buttons"},sn={key:0},an={key:0},ln={key:0},on={key:0},nn={class:"action-group"},rn={class:"group-buttons"},cn={class:"action-group reset-group"},un={class:"group-buttons"},dn={key:0},fn={class:"action-group branch-group"},pn={class:"group-buttons"},mn={class:"action-group"},vn={class:"group-buttons"},gn={class:"dialog-footer"},hn={class:"template-container"},yn={class:"template-form"},_n={class:"template-form-buttons"},wn={class:"template-list"},kn={class:"template-content"},$n={class:"template-actions"},bn={class:"template-container"},Cn={class:"template-form"},Sn={class:"template-form-buttons"},Tn={class:"template-list"},Vn={class:"template-content"},xn={class:"template-actions"},Ln={class:"template-container message-template-container"},zn={class:"template-form"},Bn={class:"template-form-buttons"},Fn={class:"templates-container"},Dn={class:"message-templates-list"},Rn={class:"templates-scroll-area"},Gn={class:"template-content"},On={class:"template-actions"},jn={class:"current-default-message"},Un={class:"default-message-content"},An={class:"message-help-text"},En={class:"stash-dialog-content"},Mn={class:"merge-dialog-content"},Pn={class:"merge-intro"},Nn={class:"merge-options"},In={class:"dialog-footer"},Hn={class:"stash-list-content"},Jn={class:"stash-action-buttons"},Wn={key:0,class:"stash-list-actions"},qn={class:"stash-content"},Yn={key:0,class:"stash-info-row"},Xn={class:"stash-id"},Kn={class:"stash-id-value"},Zn={class:"stash-description"},Qn={class:"stash-description-value"},ei={class:"stash-main-content"},ti=pt({__name:"CommitForm",setup(Q){const r=wt(),m=ds(),p=d(""),h=d(!1),R=d(!1),F=d("输入提交信息..."),E=d(""),M=d(!1),P=d("feat"),O=d(""),I=d(""),ie=d(""),G=d(""),oe=d(!1),ue=d(""),re=d(!1),C=d([]),B=d(!1),z=d(""),q=d(!1),D=d(""),K=d(-1),he=d(!1),de=d(""),V=d({noFf:!1,squash:!1,noCommit:!1,message:""}),T=d([]),Z=d(!1),Y=d(""),X=d(!1),te=d(""),$e=d(-1),Te=d(!1),g=d(""),v=d(!1),ae=d(!1),N=[{value:"feat",label:"feat: 新功能"},{value:"fix",label:"fix: 修复bug"},{value:"docs",label:"docs: 文档修改"},{value:"style",label:"style: 样式修改"},{value:"refactor",label:"refactor: 代码重构"},{value:"test",label:"test: 测试代码"},{value:"chore",label:"chore: 构建/工具修改"}],le=d(!1),se=d(!1),ke=d(""),je=d(!1),Re=d(!0),y=d(!1),pe=d(null),be=d([]),ze=d(""),Be=d(!1),Ne=d("");function Ze(){ke.value="",je.value=!1,Re.value=!0,le.value=!0}function Ue(){try{const i=m.config;ue.value=JSON.stringify(i,null,2),oe.value=!0}catch{n.error("加载配置失败")}}async function Ie(){try{re.value=!0;let i;try{i=JSON.parse(ue.value)}catch(ye){n.error(`JSON 解析失败: ${ye.message||ye}`);return}const x=await(await fetch("/api/config/saveAll",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:i})})).json();if(!x.success)throw new Error(x.error||"保存失败");await m.loadConfig(!0);try{await m.loadLockedFiles()}catch{}try{Array.isArray(m.descriptionTemplates)&&(C.value=[...m.descriptionTemplates])}catch{}try{Array.isArray(m.scopeTemplates)&&(T.value=[...m.scopeTemplates])}catch{}try{Array.isArray(m.messageTemplates)&&(ce.value=[...m.messageTemplates])}catch{}n.success("配置已保存"),oe.value=!1}catch(i){n.error(`保存配置失败: ${i.message||i}`)}finally{re.value=!1}}async function S(){try{const i=await fetch("/api/config/open-file",{method:"POST"}),s=await i.json();if(!i.ok||!(s!=null&&s.success))throw new Error((s==null?void 0:s.error)||"打开失败");n.success("已用系统程序打开配置文件")}catch(i){n.error(`打开配置文件失败: ${(i==null?void 0:i.message)||i}`)}}function c(){r.getStashList(),se.value=!0}async function ee(){try{await r.saveStash(ke.value,je.value,Re.value),le.value=!1}catch(i){console.error("储藏失败:",i)}}async function H(i,s=!1){try{await r.applyStash(i,s),s&&await r.getStashList()}catch(x){console.error("应用储藏失败:",x)}}async function Ce(i){Ee.confirm("确定要删除此储藏吗？此操作不可恢复。","删除储藏",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await r.dropStash(i),await r.getStashList()}).catch(()=>{})}async function Le(){Ee.confirm("确定要清空所有储藏吗？此操作不可恢复。","清空所有储藏",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await r.clearAllStashes(),await r.getStashList()}).catch(()=>{})}async function me(i){if(i){pe.value=i,y.value=!0,Be.value=!0,be.value=[],ze.value="",Ne.value="";try{if(!i.id||i.id.length<7){ze.value="无效的stash ID",Be.value=!1;return}const x=await(await fetch(`/api/stash-files?stashId=${encodeURIComponent(i.id)}`)).json();x.success&&Array.isArray(x.files)?(be.value=x.files,be.value.length>0?await _e(i.id,be.value[0]):ze.value="该stash没有变更文件"):ze.value=`获取文件列表失败: ${x.error||"未知错误"}`}catch(s){ze.value=`获取stash详情失败: ${s.message}`}finally{Be.value=!1}}}async function _e(i,s){Be.value=!0,Ne.value=s;try{const ye=await(await fetch(`/api/stash-file-diff?stashId=${encodeURIComponent(i)}&file=${encodeURIComponent(s)}`)).json();ye.success?ze.value=ye.diff||"没有变更内容":ze.value=`获取差异失败: ${ye.error||"未知错误"}`}catch(x){ze.value=`获取差异失败: ${x.message}`}finally{Be.value=!1}}function Ae(i){pe.value&&_e(pe.value.id,i)}const ce=d([]),ve=d(!1),He=d(""),Je=d(-1);Ye(M,i=>{localStorage.setItem("zen-gitsync-standard-commit",i.toString())}),Ye(v,i=>{localStorage.setItem("zen-gitsync-skip-hooks",i.toString())});const J=fe(()=>{if(!M.value)return p.value||E.value;let i=`${P.value||""}`;return O.value&&(i+=`(${O.value})`),i+=`: ${I.value}`,ie.value&&(i+=`

${ie.value}`),G.value&&(i+=`

${G.value}`),i}),Ge=fe(()=>M.value?P.value.trim()!==""&&I.value.trim()!=="":p.value.trim()!==""),ot=fe(()=>be.value.map(i=>({path:i,name:i.split("/").pop()||i}))),Qe=fe(()=>{let i=`git commit -m "${J.value}"`;return v.value&&(i+=" --no-verify"),i});function nt(){const i=m.config;i&&(F.value=`输入提交信息 (默认: ${i.defaultCommitMessage})`,E.value=i.defaultCommitMessage||"",i.descriptionTemplates&&Array.isArray(i.descriptionTemplates)&&(C.value=i.descriptionTemplates),i.scopeTemplates&&Array.isArray(i.scopeTemplates)&&(T.value=i.scopeTemplates),i.messageTemplates&&Array.isArray(i.messageTemplates)&&(ce.value=i.messageTemplates))}async function Me(){if(!z.value.trim()){n({message:"请输入模板内容",type:"warning"});return}try{if(q.value)await bt();else{if(C.value.includes(z.value)){n({message:"该模板已存在",type:"warning"});return}await m.saveTemplate(z.value,"description")&&(C.value.includes(z.value)||C.value.push(z.value),C.value=[...C.value],z.value="")}}catch(i){n({message:`保存模板失败: ${i.message}`,type:"error"})}}async function bt(){if(!z.value.trim()){n({message:"请输入模板内容",type:"warning"});return}try{if(await m.updateTemplate(D.value,z.value,"description")){const s=C.value.indexOf(D.value);s!==-1&&(C.value[s]=z.value),C.value=[...C.value],q.value=!1,D.value="",K.value=-1,z.value=""}}catch(i){n({message:`更新模板失败: ${i.message}`,type:"error"})}}function w(i,s){q.value=!0,D.value=i,K.value=s,z.value=i}function l(){q.value=!1,D.value="",K.value=-1,z.value=""}async function u(){if(!Y.value.trim()){n({message:"请输入模板内容",type:"warning"});return}try{if(X.value)await k();else{if(T.value.includes(Y.value)){n({message:"该模板已存在",type:"warning"});return}await m.saveTemplate(Y.value,"scope")&&(T.value.includes(Y.value)||T.value.push(Y.value),T.value=[...T.value],Y.value="")}}catch(i){n({message:`保存模板失败: ${i.message}`,type:"error"})}}async function k(){if(!Y.value.trim()){n({message:"请输入模板内容",type:"warning"});return}try{if(await m.updateTemplate(te.value,Y.value,"scope")){const s=T.value.indexOf(te.value);s!==-1&&(T.value[s]=Y.value),T.value=[...T.value],X.value=!1,te.value="",$e.value=-1,Y.value=""}}catch(i){n({message:`更新模板失败: ${i.message}`,type:"error"})}}function j(i,s){X.value=!0,te.value=i,$e.value=s,Y.value=i}function ne(){X.value=!1,te.value="",$e.value=-1,Y.value=""}async function U(i){try{if(await Ee.confirm(`确定要删除描述模板 "${i}" 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await m.deleteTemplate(i,"description")){const x=C.value.indexOf(i);x!==-1&&C.value.splice(x,1),C.value=[...C.value]}}catch(s){if(s==="cancel")return;n({message:`删除模板失败: ${s.message}`,type:"error"})}}async function Se(i){try{if(await Ee.confirm(`确定要删除作用域模板 "${i}" 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await m.deleteTemplate(i,"scope")){const x=T.value.indexOf(i);x!==-1&&T.value.splice(x,1),T.value=[...T.value]}}catch(s){if(s==="cancel")return;n({message:`删除模板失败: ${s.message}`,type:"error"})}}function Ke(i){I.value=i,B.value=!1}function Ft(i){O.value=i,Z.value=!1}function js(){B.value=!0}function Us(){Z.value=!0}async function Ht(){try{await r.addToStage()&&r.fetchStatus()}catch(i){n({message:`添加文件失败: ${i.message}`,type:"error"})}}async function Jt(){if(!J.value.trim()){n({message:"提交信息不能为空",type:"warning"});return}try{await r.commitChanges(J.value,v.value)&&(Yt(),r.fetchStatus(),r.fetchLog(),r.getBranchStatus(!0))}catch(i){n({message:`提交失败: ${i.message}`,type:"error"})}}function Dt(){h.value=!0,setTimeout(()=>{h.value=!1},2e3)}async function Wt(){try{await r.pushToRemote(),R.value=!0;try{await new Promise(i=>setTimeout(i,200)),Dt()}catch(i){console.error("推送后处理失败:",i),Dt()}finally{R.value=!1}}catch(i){R.value=!1,n({message:`推送失败: ${i.message}`,type:"error"})}}async function As(){try{await r.gitPull(),await r.fetchStatus(),await r.fetchLog(!1)}catch(i){console.error("拉取操作发生错误:",i)}}async function Es(){try{await r.gitFetchAll(),await r.fetchStatus(),await r.fetchLog(!1)}catch(i){console.error("获取远程分支信息操作发生错误:",i)}}async function Ms(){if(!J.value.trim()){n({message:"提交信息不能为空",type:"warning"});return}try{await r.addAndCommit(J.value,v.value),Yt(),r.fetchStatus(),r.fetchLog()}catch(i){n({message:`暂存并提交失败: ${i.message}`,type:"error"})}}async function qt(){if(!J.value.trim()){n({message:"提交信息不能为空",type:"warning"});return}try{if(await r.addCommitAndPush(J.value,v.value)){Yt(),R.value=!0;try{await new Promise(s=>setTimeout(s,1e3)),console.log("一键推送完成，状态已在pushToRemote中刷新"),Dt()}catch(s){console.error("一键推送后处理失败:",s),Dt()}finally{R.value=!1}}}catch(i){n({message:`暂存、提交并推送失败: ${i.message}`,type:"error"})}}async function Ps(){try{await Ee.confirm(`确定要重置当前分支 "${r.currentBranch}" 到远程状态吗？这将丢失所有未推送的提交和本地更改。`,"重置到远程分支",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await r.resetToRemote(r.currentBranch)&&(r.fetchStatus(),r.fetchLog())}catch(i){i!=="cancel"&&n({message:`重置到远程分支失败: ${i.message}`,type:"error"})}}function Yt(){p.value="",I.value="",ie.value="",G.value=""}function Ns(){g.value=E.value,Te.value=!0}async function Is(){if(!g.value.trim()){n({message:"请输入默认提交信息",type:"warning"});return}try{await m.saveDefaultMessage(g.value)&&(E.value=g.value,F.value=`输入提交信息 (默认: ${g.value})`,Te.value=!1)}catch(i){n({message:`保存默认提交信息失败: ${i.message}`,type:"error"})}}function Rt(i){const s=i.replace(/\\/g,"/");return m.lockedFiles.some(x=>{const ye=x.replace(/\\/g,"/");return s===ye})}const Ct=fe(()=>r.fileList.some(i=>["modified","deleted","untracked"].includes(i.type)&&!Rt(i.path))),it=fe(()=>r.fileList.filter(i=>["modified","deleted","untracked"].includes(i.type)&&!Rt(i.path)).length),We=fe(()=>r.fileList.filter(i=>i.type==="added"&&!Rt(i.path)).length),vt=fe(()=>We.value>0),rt=fe(()=>r.fileList.some(i=>!Rt(i.path))),et=fe(()=>r.branchAhead>0),Xt=fe(()=>r.branchBehind>0),tt=fe(()=>r.hasUpstream&&et.value&&!vt.value),ps=fe(()=>vt.value),Hs=fe(()=>r.hasUpstream&&(et.value||Xt.value||rt.value));async function Js(){if(!g.value.trim()){n({message:"请输入模板内容",type:"warning"});return}try{if(ve.value)await Ws();else{if(ce.value.includes(g.value)){n({message:"该模板已存在",type:"warning"});return}ce.value.push(g.value);const s=await(await fetch("/api/config/save-template",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({template:g.value,type:"message"})})).json();s.success?(n({message:"提交信息模板保存成功!",type:"success"}),g.value=""):n({message:"模板保存失败: "+s.error,type:"error"})}}catch(i){n({message:"模板保存失败: "+i.message,type:"error"})}}async function Ws(){try{if(Je.value>=0){const i=He.value,s=g.value;ce.value[Je.value]=s;const ye=await(await fetch("/api/config/update-template",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldTemplate:i,newTemplate:s,type:"message"})})).json();ye.success?(n({message:"提交信息模板更新成功!",type:"success"}),ve.value=!1,He.value="",Je.value=-1,g.value=""):n({message:"模板更新失败: "+ye.error,type:"error"})}}catch(i){n({message:"模板更新失败: "+i.message,type:"error"})}}function qs(i,s){ve.value=!0,He.value=i,Je.value=s,g.value=i}function Ys(){ve.value=!1,He.value="",Je.value=-1,g.value=""}async function Xs(i){try{const s=ce.value.indexOf(i);s!==-1&&ce.value.splice(s,1);const ye=await(await fetch("/api/config/delete-template",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({template:i,type:"message"})})).json();ye.success?n({message:"提交信息模板删除成功!",type:"success"}):n({message:"模板删除失败: "+ye.error,type:"error"})}catch(s){n({message:"模板删除失败: "+s.message,type:"error"})}}function Ks(i){p.value=i,g.value=i}kt(async()=>{const i=localStorage.getItem("zen-gitsync-standard-commit");i!==null&&(M.value=i==="true");const s=localStorage.getItem("zen-gitsync-skip-hooks");s!==null&&(v.value=s==="true"),Ye(()=>m.config,nt,{immediate:!0}),m.config||await m.loadConfig()});function Zs(){de.value="",V.value={noFf:!1,squash:!1,noCommit:!1,message:""},gt.value="all",he.value=!0,r.allBranches.length===0&&r.getAllBranches()}const gt=d("all"),Qs=fe(()=>{const i=r.allBranches.filter(s=>s!==r.currentBranch);if(console.log("筛选分支列表:",{allBranches:r.allBranches,currentBranch:r.currentBranch,branchTypeFilter:gt.value,filteredBranches:i}),gt.value==="local"){const s=i.filter(x=>!x.includes("origin/"));return console.log("本地分支:",s),s}else if(gt.value==="remote"){const s=i.filter(x=>x.includes("origin/"));return console.log("远程分支:",s),s}else return console.log("所有分支:",i),i});async function ea(){if(!de.value){n({message:"请选择要合并的分支",type:"warning"});return}try{await r.mergeBranch(de.value,V.value)&&(he.value=!1,await r.fetchStatus(),await r.fetchLog(!1))}catch(i){console.error("合并分支操作发生错误:",i)}}const Gt=d(!1);function ta(){Gt.value=!Gt.value}function sa(i,s){const ye=[...i?C.value.filter(Ve=>Ve.toLowerCase().includes(i.toLowerCase())).map(Ve=>({value:Ve})):C.value.map(Ve=>({value:Ve})),{value:"⚙️ 管理模板...",isSettings:!0}];s(ye)}function aa(i,s){const ye=[...i?T.value.filter(Ve=>Ve.toLowerCase().includes(i.toLowerCase())).map(Ve=>({value:Ve})):T.value.map(Ve=>({value:Ve})),{value:"⚙️ 管理模板...",isSettings:!0}];s(ye)}function la(i){i.isSettings?(js(),I.value=""):I.value=i.value}function oa(i){i.isSettings?(Us(),O.value=""):O.value=i.value}function na(i,s){const ye=[...i?ce.value.filter(Ve=>Ve.toLowerCase().includes(i.toLowerCase())).map(Ve=>({value:Ve})):ce.value.map(Ve=>({value:Ve})),{value:"⚙️ 管理模板...",isSettings:!0}];s(ye)}function ia(i){i.isSettings?(Ns(),p.value=""):p.value=i.value}return(i,s)=>{const x=De,ye=$t,Ve=cs,ms=Ts,Kt=ya,xe=Nt,vs=Mt,gs=Pt,st=us,ra=wa,ht=It,Ot=Et,Zt=ka,jt=Fs,hs=Bt,ct=Rs,St=$a,ys=Ds,Qt=Ca,ca=ba,es=xt,ua=Gs,da=is;return f(),$(we,null,[e("div",{class:ge(["card",{"is-pushing":o(r).isPushing}])},[e("div",io,[s[34]||(s[34]=e("h2",null,"提交更改",-1)),e("div",ro,[t(x,{size:"small",type:"primary",icon:o(Tt),onClick:Ue},{default:a(()=>s[33]||(s[33]=[_("配置")])),_:1},8,["icon"]),t(x,{type:"primary",icon:o(ha),size:"small",circle:"",onClick:ta,class:"git-tools-button"},null,8,["icon"])])]),t(ks,{name:"el-fade-in-linear"},{default:a(()=>[o(r).isPushing||R.value?(f(),$("div",co,[s[35]||(s[35]=e("div",{class:"pushing-spinner"},[e("svg",{viewBox:"0 0 50 50",class:"circular"},[e("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})])],-1)),e("div",uo,L(o(r).isPushing?"正在推送...":"更新状态中..."),1)])):A("",!0)]),_:1}),t(ks,{name:"el-fade-in-linear"},{default:a(()=>[h.value?(f(),$("div",fo,[t(ye,{class:"push-success-icon"},{default:a(()=>[t(o(Vs))]),_:1}),s[36]||(s[36]=e("div",{class:"push-success-text"},"已完成!",-1))])):A("",!0)]),_:1}),e("div",po,[e("div",mo,[o(r).userName===""||o(r).userEmail===""?(f(),$("div",vo,[t(Ve,{title:"Git用户信息未配置",type:"warning",closable:!1,"show-icon":""},{default:a(()=>s[37]||(s[37]=[e("p",null,"您需要配置Git用户名和邮箱才能提交代码。请使用以下命令配置：",-1),e("pre",{class:"config-command"},`git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"`,-1)])),_:1})])):(f(),$("div",go,[e("div",ho,[e("div",yo,[e("div",_o,[t(ms,{modelValue:M.value,"onUpdate:modelValue":s[0]||(s[0]=b=>M.value=b),"active-text":"标准化提交","inactive-text":"普通提交"},null,8,["modelValue"])]),e("div",wo,[t(ms,{modelValue:v.value,"onUpdate:modelValue":s[1]||(s[1]=b=>v.value=b),"active-text":"跳过 Git 钩子检查 (--no-verify)"},null,8,["modelValue"])])])]),M.value?(f(),$("div",Ro,[e("div",Go,[e("div",Oo,[t(gs,{modelValue:P.value,"onUpdate:modelValue":s[3]||(s[3]=b=>P.value=b),placeholder:"提交类型",class:"type-select",clearable:""},{default:a(()=>[(f(),$(we,null,Fe(N,b=>t(vs,{key:b.value,label:b.label,value:b.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),e("div",jo,[t(Kt,{modelValue:O.value,"onUpdate:modelValue":s[4]||(s[4]=b=>O.value=b),"fetch-suggestions":aa,placeholder:"作用域（可选）",class:"scope-input",clearable:"",onSelect:oa},null,8,["modelValue"])])]),e("div",Uo,[t(Kt,{modelValue:I.value,"onUpdate:modelValue":s[5]||(s[5]=b=>I.value=b),"fetch-suggestions":sa,placeholder:"简短描述（必填）",class:"description-input",clearable:"",onSelect:la},null,8,["modelValue"])])]),e("div",{class:"advanced-options-toggle",onClick:s[6]||(s[6]=b=>ae.value=!ae.value)},[e("span",null,L(ae.value?"收起":"正文及页脚"),1),t(ye,{class:ge(["toggle-icon",{"is-active":ae.value}])},{default:a(()=>[t(o(yt))]),_:1},8,["class"])]),Xe(e("div",Ao,[t(st,{modelValue:ie.value,"onUpdate:modelValue":s[7]||(s[7]=b=>ie.value=b),type:"textarea",rows:4,placeholder:"正文（可选）：详细描述本次提交的内容和原因",class:"body-input",clearable:""},null,8,["modelValue"]),t(st,{modelValue:G.value,"onUpdate:modelValue":s[8]||(s[8]=b=>G.value=b),placeholder:"页脚（可选）：如 Closes #123",class:"footer-input",clearable:""},null,8,["modelValue"])],512),[[ft,ae.value]]),e("div",Eo,[s[43]||(s[43]=e("div",{class:"preview-title"},"Git提交命令预览：",-1)),e("pre",Mo,L(Qe.value),1)]),e("div",Po,[e("div",No,[e("div",Io,[e("div",Ho,[t(x,{type:"primary",onClick:Ht,loading:o(r).isAddingFiles,disabled:!Ct.value,class:"stage-button"},{default:a(()=>[s[44]||(s[44]=_(" 暂存更改 ")),it.value>0?(f(),$("span",Jo,"("+L(it.value)+")",1)):A("",!0)]),_:1},8,["loading","disabled"]),t(x,{type:"primary",onClick:Jt,loading:o(r).isLoadingStatus,disabled:!vt.value||!Ge.value},{default:a(()=>[s[45]||(s[45]=_(" 提交 ")),We.value>0?(f(),$("span",Wo,"("+L(We.value)+")",1)):A("",!0)]),_:1},8,["loading","disabled"]),t(xe,{content:tt.value?"推送已提交的更改到远程仓库":o(r).hasUpstream?et.value?"有未提交的暂存更改，请先提交":"没有需要推送的提交":"当前分支没有上游分支",placement:"top"},{default:a(()=>[t(x,{type:"primary",icon:o(ts),onClick:Wt,loading:o(r).isPushing,disabled:!tt.value,style:dt(tt.value?{backgroundColor:"#67c23a",borderColor:"#67c23a"}:{})},{default:a(()=>[s[46]||(s[46]=_(" 推送 ")),et.value?(f(),$("span",qo,"("+L(o(r).branchAhead)+")",1)):A("",!0)]),_:1},8,["icon","loading","disabled","style"])]),_:1},8,["content"])])]),e("div",Yo,[t(xe,{content:rt.value?Ge.value?o(r).hasUpstream?"一键完成：暂存所有更改 → 提交 → 推送到远程仓库":"当前分支没有上游分支":"请输入提交信息":"没有需要提交的更改",placement:"top"},{default:a(()=>[t(x,{type:"success",onClick:qt,loading:o(r).isAddingFiles||o(r).isCommiting||o(r).isPushing,disabled:!rt.value||!Ge.value||!o(r).hasUpstream,class:"one-push-button"},{default:a(()=>[e("div",Xo,[t(ye,{class:"one-push-icon"},{default:a(()=>[t(o(ss))]),_:1}),s[47]||(s[47]=e("div",{class:"one-push-text"},[e("span",{class:"one-push-title"},"一键推送所有"),e("span",{class:"one-push-desc"},"暂存 + 提交 + 推送")],-1))])]),_:1},8,["loading","disabled"])]),_:1},8,["content"])])])])])):(f(),$("div",ko,[e("div",$o,[t(Kt,{modelValue:p.value,"onUpdate:modelValue":s[2]||(s[2]=b=>p.value=b),"fetch-suggestions":na,placeholder:F.value,type:"textarea",rows:6,resize:"none",class:"commit-message-input",onSelect:ia},null,8,["modelValue","placeholder"])]),e("div",bo,[s[38]||(s[38]=e("div",{class:"preview-title"},"Git提交命令预览：",-1)),e("pre",Co,'git commit -m "'+L(J.value||"<提交信息>")+'"'+L(v.value?" --no-verify":""),1)]),e("div",So,[e("div",To,[e("div",Vo,[e("div",xo,[t(x,{type:"primary",onClick:Ht,loading:o(r).isAddingFiles,disabled:!Ct.value,class:"stage-button"},{default:a(()=>[s[39]||(s[39]=_(" 暂存更改 ")),it.value>0?(f(),$("span",Lo,"("+L(it.value)+")",1)):A("",!0)]),_:1},8,["loading","disabled"]),t(x,{type:"primary",onClick:Jt,loading:o(r).isLoadingStatus,disabled:!vt.value||!Ge.value},{default:a(()=>[s[40]||(s[40]=_(" 提交 ")),We.value>0?(f(),$("span",zo,"("+L(We.value)+")",1)):A("",!0)]),_:1},8,["loading","disabled"]),t(xe,{content:tt.value?"推送已提交的更改到远程仓库":o(r).hasUpstream?et.value?"有未提交的暂存更改，请先提交":"没有需要推送的提交":"当前分支没有上游分支",placement:"top"},{default:a(()=>[t(x,{type:"primary",icon:o(ts),onClick:Wt,loading:o(r).isPushing,disabled:!tt.value,style:dt(tt.value?{backgroundColor:"#67c23a",borderColor:"#67c23a"}:{})},{default:a(()=>[s[41]||(s[41]=_(" 推送 ")),et.value?(f(),$("span",Bo,"("+L(o(r).branchAhead)+")",1)):A("",!0)]),_:1},8,["icon","loading","disabled","style"])]),_:1},8,["content"])])]),e("div",Fo,[t(xe,{content:rt.value?Ge.value?o(r).hasUpstream?"一键完成：暂存所有更改 → 提交 → 推送到远程仓库":"当前分支没有上游分支":"请输入提交信息":"没有需要提交的更改",placement:"top"},{default:a(()=>[t(x,{type:"success",onClick:qt,loading:o(r).isAddingFiles||o(r).isCommiting||o(r).isPushing,disabled:!rt.value||!Ge.value||!o(r).hasUpstream,class:"one-push-button"},{default:a(()=>[e("div",Do,[t(ye,{class:"one-push-icon"},{default:a(()=>[t(o(ss))]),_:1}),s[42]||(s[42]=e("div",{class:"one-push-text"},[e("span",{class:"one-push-title"},"一键推送所有"),e("span",{class:"one-push-desc"},"暂存 + 提交 + 推送")],-1))])]),_:1},8,["loading","disabled"])]),_:1},8,["content"])])])])]))]))])])],2),t(ra,{modelValue:Gt.value,"onUpdate:modelValue":s[9]||(s[9]=b=>Gt.value=b),title:"Git 操作",direction:"rtl",size:"340px","with-header":!0,"show-close":!0,"destroy-on-close":!1,class:"git-operations-drawer"},{default:a(()=>[e("div",Ko,[e("div",Zo,[e("div",Qo,[e("div",en,[s[53]||(s[53]=e("div",{class:"group-title"},"基础操作",-1)),e("div",tn,[t(xe,{content:Ct.value?`暂存${it.value}个待更改文件`:"git add .",placement:"top",effect:"light","popper-class":"git-cmd-tooltip"},{default:a(()=>[t(x,{type:"primary",onClick:Ht,loading:o(r).isAddingFiles,disabled:!Ct.value,class:"action-button"},{default:a(()=>[s[48]||(s[48]=_(" 暂存更改 ")),it.value>0?(f(),$("span",sn,"("+L(it.value)+")",1)):A("",!0)]),_:1},8,["loading","disabled"])]),_:1},8,["content"]),t(xe,{content:vt.value?`提交${We.value}个已暂存文件`:"git commit",placement:"top",effect:"light","popper-class":"git-cmd-tooltip"},{default:a(()=>[t(x,{type:"primary",onClick:Jt,loading:o(r).isLoadingStatus,disabled:!vt.value||!Ge.value,class:"action-button"},{default:a(()=>[s[49]||(s[49]=_(" 提交 ")),We.value>0?(f(),$("span",an,"("+L(We.value)+")",1)):A("",!0)]),_:1},8,["loading","disabled"])]),_:1},8,["content"]),t(xe,{content:et.value?`推送${o(r).branchAhead}个本地提交`:"git push",placement:"top",effect:"light","popper-class":"git-cmd-tooltip"},{default:a(()=>[t(x,{type:"primary",icon:o(ts),onClick:Wt,loading:o(r).isPushing,disabled:!tt.value,class:ge(["action-button","push-button",{"is-loading":o(r).isPushing}]),style:dt(tt.value?{backgroundColor:"#67c23a",borderColor:"#67c23a"}:{})},{default:a(()=>[s[50]||(s[50]=_(" 推送 ")),et.value?(f(),$("span",ln,"("+L(o(r).branchAhead)+")",1)):A("",!0)]),_:1},8,["icon","loading","disabled","class","style"])]),_:1},8,["content"]),t(xe,{content:Xt.value?`拉取${o(r).branchBehind}个远程提交`:"git pull",placement:"top",effect:"light","popper-class":"git-cmd-tooltip"},{default:a(()=>[t(x,{type:"primary",icon:o(xs),onClick:As,loading:o(r).isGitPulling,disabled:!o(r).hasUpstream,class:"action-button",style:dt(o(r).hasUpstream?{color:"white",backgroundColor:"#1e90ff",borderColor:"#1e90ff"}:{})},{default:a(()=>[s[51]||(s[51]=_(" 拉取 ")),Xt.value?(f(),$("span",on,"("+L(o(r).branchBehind)+")",1)):A("",!0)]),_:1},8,["icon","loading","disabled","style"])]),_:1},8,["content"]),t(xe,{content:"git fetch --all",placement:"top",effect:"light","popper-class":"git-cmd-tooltip"},{default:a(()=>[t(x,{type:"info",icon:o(Ls),onClick:Es,loading:o(r).isGitFetching,class:"action-button",style:{color:"white","background-color":"#1e90ff","border-color":"#1e90ff"}},{default:a(()=>s[52]||(s[52]=[_(" 获取所有远程分支 ")])),_:1},8,["icon","loading"])]),_:1})])]),e("div",nn,[s[56]||(s[56]=e("div",{class:"group-title"},"组合操作",-1)),e("div",rn,[t(xe,{content:"git add + git commit",placement:"top",effect:"light","popper-class":"git-cmd-tooltip"},{default:a(()=>[t(x,{type:"primary",icon:o(Tt),onClick:Ms,loading:o(r).isAddingFiles||o(r).isCommiting,disabled:!Ct.value||!Ge.value,class:"action-button"},{default:a(()=>s[54]||(s[54]=[_(" 暂存并提交 ")])),_:1},8,["icon","loading","disabled"])]),_:1}),t(xe,{content:"git add + git commit + git push",placement:"top",effect:"light","popper-class":"git-cmd-tooltip"},{default:a(()=>[t(x,{type:"success",icon:o(ss),onClick:qt,loading:o(r).isAddingFiles||o(r).isCommiting||o(r).isPushing,disabled:!rt.value||!Ge.value||!o(r).hasUpstream,class:ge(["action-button","one-click-push",{"is-loading":o(r).isAddingFiles||o(r).isCommiting||o(r).isPushing}])},{default:a(()=>s[55]||(s[55]=[_(" 一键推送所有 ")])),_:1},8,["icon","loading","disabled","class"])]),_:1})])])]),e("div",cn,[s[59]||(s[59]=e("div",{class:"group-title"},"重置操作",-1)),e("div",un,[t(xe,{content:ps.value?`撤销${We.value}个已暂存文件`:"git reset HEAD",placement:"top",effect:"light","popper-class":"git-cmd-tooltip"},{default:a(()=>[t(x,{type:"warning",icon:o(rs),onClick:o(r).resetHead,loading:o(r).isResetting,disabled:!ps.value,class:"action-button reset-button"},{default:a(()=>[s[57]||(s[57]=_(" 重置暂存区 ")),We.value>0?(f(),$("span",dn,"("+L(We.value)+")",1)):A("",!0)]),_:1},8,["icon","onClick","loading","disabled"])]),_:1},8,["content"]),t(xe,{content:"git reset --hard origin/branch",placement:"top",effect:"light","popper-class":"git-cmd-tooltip"},{default:a(()=>[t(x,{type:"danger",icon:o(Bs),onClick:Ps,loading:o(r).isResetting,disabled:!Hs.value,class:"action-button danger-button"},{default:a(()=>s[58]||(s[58]=[_(" 重置到远程 ")])),_:1},8,["icon","loading","disabled"])]),_:1})])]),e("div",fn,[s[61]||(s[61]=e("div",{class:"group-title"},"分支操作",-1)),e("div",pn,[t(xe,{content:"合并其他分支到当前分支",placement:"top",effect:"light","popper-class":"git-cmd-tooltip"},{default:a(()=>[t(x,{type:"primary",icon:o(_a),onClick:Zs,loading:o(r).isGitMerging,class:"action-button merge-button"},{default:a(()=>s[60]||(s[60]=[_(" 合并分支 ")])),_:1},8,["icon","loading"])]),_:1})])]),e("div",mn,[s[64]||(s[64]=e("div",{class:"group-title"},"储藏操作",-1)),e("div",vn,[t(xe,{content:"将工作区更改储藏起来",placement:"top",effect:"light","popper-class":"git-cmd-tooltip"},{default:a(()=>[t(x,{type:"warning",onClick:Ze,loading:o(r).isSavingStash,disabled:!rt.value,class:"action-button"},{default:a(()=>s[62]||(s[62]=[_(" 储藏更改 ")])),_:1},8,["loading","disabled"])]),_:1}),t(xe,{content:"查看和管理所有储藏记录",placement:"top",effect:"light","popper-class":"git-cmd-tooltip"},{default:a(()=>[t(x,{type:"info",onClick:c,class:"action-button"},{default:a(()=>s[63]||(s[63]=[_(" 储藏列表 ")])),_:1})]),_:1})])])])])]),_:1},8,["modelValue"]),t(ht,{class:"config-editor-dialog",title:"编辑配置 JSON",modelValue:oe.value,"onUpdate:modelValue":s[12]||(s[12]=b=>oe.value=b),width:"60%"},{footer:a(()=>[e("span",gn,[t(x,{onClick:S},{default:a(()=>s[65]||(s[65]=[_("打开系统配置文件")])),_:1}),t(x,{onClick:s[11]||(s[11]=b=>oe.value=!1)},{default:a(()=>s[66]||(s[66]=[_("取消")])),_:1}),t(x,{type:"primary",loading:re.value,onClick:Ie},{default:a(()=>s[67]||(s[67]=[_("保存")])),_:1},8,["loading"])])]),default:a(()=>[t(st,{modelValue:ue.value,"onUpdate:modelValue":s[10]||(s[10]=b=>ue.value=b),type:"textarea",rows:18,spellcheck:"false",autocomplete:"off",placeholder:"在此编辑当前项目配置的 JSON"},null,8,["modelValue"])]),_:1},8,["modelValue"]),t(ht,{title:"简短描述模板设置",modelValue:B.value,"onUpdate:modelValue":s[14]||(s[14]=b=>B.value=b),width:"80vw",top:"70px",style:{height:"calc(100vh - 140px)"},"close-on-click-modal":!1,class:"template-dialog"},{default:a(()=>[e("div",hn,[e("div",yn,[t(st,{modelValue:z.value,"onUpdate:modelValue":s[13]||(s[13]=b=>z.value=b),placeholder:q.value?"编辑模板内容":"输入新模板内容",class:"template-input",clearable:""},null,8,["modelValue","placeholder"]),e("div",_n,[q.value?(f(),W(x,{key:0,onClick:l},{default:a(()=>s[68]||(s[68]=[_("取消")])),_:1})):A("",!0),t(x,{type:"primary",onClick:Me,disabled:!z.value.trim()},{default:a(()=>[_(L(q.value?"更新模板":"添加模板"),1)]),_:1},8,["disabled"])])]),e("div",wn,[s[72]||(s[72]=e("h3",null,"已保存模板",-1)),C.value.length===0?(f(),W(Ot,{key:0,description:"暂无保存的模板"})):A("",!0),(f(!0),$(we,null,Fe(C.value,(b,Pe)=>(f(),W(jt,{key:Pe,class:"template-item"},{default:a(()=>[t(Zt,{justify:"space-between",align:"middle",style:{width:"100%"}},{default:a(()=>[e("div",kn,L(b),1),e("div",$n,[t(x,{type:"primary",size:"small",onClick:at=>Ke(b)},{default:a(()=>s[69]||(s[69]=[_("使用")])),_:2},1032,["onClick"]),t(x,{type:"warning",size:"small",icon:o(Tt),onClick:at=>w(b,Pe)},{default:a(()=>s[70]||(s[70]=[_("编辑")])),_:2},1032,["icon","onClick"]),t(x,{type:"danger",size:"small",onClick:at=>U(b)},{default:a(()=>s[71]||(s[71]=[_("删除")])),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))])])]),_:1},8,["modelValue"]),t(ht,{title:"作用域模板设置",modelValue:Z.value,"onUpdate:modelValue":s[16]||(s[16]=b=>Z.value=b),width:"80vw",top:"70px",style:{height:"calc(100vh - 140px)"},"close-on-click-modal":!1,class:"template-dialog"},{default:a(()=>[e("div",bn,[e("div",Cn,[t(st,{modelValue:Y.value,"onUpdate:modelValue":s[15]||(s[15]=b=>Y.value=b),placeholder:X.value?"编辑作用域模板内容":"输入新作用域模板",class:"template-input",clearable:""},null,8,["modelValue","placeholder"]),e("div",Sn,[X.value?(f(),W(x,{key:0,onClick:ne},{default:a(()=>s[73]||(s[73]=[_("取消")])),_:1})):A("",!0),t(x,{type:"primary",onClick:u,disabled:!Y.value.trim()},{default:a(()=>[_(L(X.value?"更新模板":"添加模板"),1)]),_:1},8,["disabled"])])]),e("div",Tn,[s[77]||(s[77]=e("h3",null,"已保存作用域",-1)),T.value.length===0?(f(),W(Ot,{key:0,description:"暂无保存的作用域"})):A("",!0),(f(!0),$(we,null,Fe(T.value,(b,Pe)=>(f(),W(jt,{key:Pe,class:"template-item"},{default:a(()=>[t(Zt,{justify:"space-between",align:"middle",style:{width:"100%"}},{default:a(()=>[e("div",Vn,L(b),1),e("div",xn,[t(x,{type:"primary",size:"small",onClick:at=>Ft(b)},{default:a(()=>s[74]||(s[74]=[_("使用")])),_:2},1032,["onClick"]),t(x,{type:"warning",size:"small",icon:o(Tt),onClick:at=>j(b,Pe)},{default:a(()=>s[75]||(s[75]=[_("编辑")])),_:2},1032,["icon","onClick"]),t(x,{type:"danger",size:"small",onClick:at=>Se(b)},{default:a(()=>s[76]||(s[76]=[_("删除")])),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))])])]),_:1},8,["modelValue"]),t(ht,{title:"默认提交信息设置",modelValue:Te.value,"onUpdate:modelValue":s[18]||(s[18]=b=>Te.value=b),width:"80vw",top:"70px",style:{height:"calc(100vh - 140px)"},"close-on-click-modal":!1,class:"message-template-dialog"},{default:a(()=>[e("div",Ln,[e("div",zn,[t(st,{modelValue:g.value,"onUpdate:modelValue":s[17]||(s[17]=b=>g.value=b),placeholder:ve.value?"编辑模板内容":"输入新模板内容",class:"template-input",clearable:""},null,8,["modelValue","placeholder"]),e("div",Bn,[ve.value?(f(),W(x,{key:0,onClick:Ys},{default:a(()=>s[78]||(s[78]=[_("取消")])),_:1})):A("",!0),t(x,{type:"primary",onClick:Js,disabled:!g.value.trim()},{default:a(()=>[_(L(ve.value?"更新模板":"添加模板"),1)]),_:1},8,["disabled"]),t(x,{type:"success",onClick:Is,disabled:!g.value.trim()},{default:a(()=>s[79]||(s[79]=[_(" 设为默认提交信息 ")])),_:1},8,["disabled"])])]),e("div",Fn,[e("div",Dn,[s[83]||(s[83]=e("h3",null,"已保存模板",-1)),e("div",Rn,[ce.value.length===0?(f(),W(Ot,{key:0,description:"暂无保存的模板"})):A("",!0),(f(!0),$(we,null,Fe(ce.value,(b,Pe)=>(f(),W(jt,{key:Pe,class:"template-item"},{default:a(()=>[t(Zt,{justify:"space-between",align:"middle",style:{width:"100%"}},{default:a(()=>[e("div",Gn,L(b),1),e("div",On,[t(x,{type:"primary",size:"small",onClick:at=>Ks(b)},{default:a(()=>s[80]||(s[80]=[_("使用")])),_:2},1032,["onClick"]),t(x,{type:"warning",size:"small",icon:o(Tt),onClick:at=>qs(b,Pe)},{default:a(()=>s[81]||(s[81]=[_("编辑")])),_:2},1032,["icon","onClick"]),t(x,{type:"danger",size:"small",onClick:at=>Xs(b)},{default:a(()=>s[82]||(s[82]=[_("删除")])),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))])]),e("div",jn,[s[91]||(s[91]=e("h3",null,"当前默认提交信息",-1)),E.value?(f(),W(jt,{key:0,class:"default-message-card"},{default:a(()=>[e("div",Un,L(E.value),1)]),_:1})):(f(),W(Ot,{key:1,description:"尚未设置默认提交信息","image-size":100})),e("div",An,[s[89]||(s[89]=e("h4",null,"关于默认提交信息",-1)),s[90]||(s[90]=e("p",null,"默认提交信息将在未输入提交信息时自动使用。",-1)),e("p",null,[s[86]||(s[86]=_("你可以通过点击左侧模板的")),t(hs,{size:"small",type:"primary"},{default:a(()=>s[84]||(s[84]=[_("使用")])),_:1}),s[87]||(s[87]=_("按钮先选择喜欢的模板，然后点击上方")),t(hs,{size:"small",type:"success"},{default:a(()=>s[85]||(s[85]=[_("设为默认提交信息")])),_:1}),s[88]||(s[88]=_("按钮保存。"))])])])])])]),_:1},8,["modelValue"]),t(zt,{modelValue:le.value,"onUpdate:modelValue":s[22]||(s[22]=b=>le.value=b),title:"储藏更改 (Git Stash)",size:"medium","close-on-click-modal":!1,"show-footer":"","confirm-text":"储藏","confirm-loading":o(r).isSavingStash,onConfirm:ee},{default:a(()=>[e("div",En,[s[94]||(s[94]=e("p",null,"将当前工作区的更改储藏起来，稍后可以再次应用。",-1)),t(ys,{"label-position":"top"},{default:a(()=>[t(ct,{label:"储藏说明 (可选)"},{default:a(()=>[t(st,{modelValue:ke.value,"onUpdate:modelValue":s[19]||(s[19]=b=>ke.value=b),placeholder:"输入储藏说明（可选）",clearable:""},null,8,["modelValue"])]),_:1}),t(ct,null,{default:a(()=>[t(St,{modelValue:je.value,"onUpdate:modelValue":s[20]||(s[20]=b=>je.value=b)},{default:a(()=>s[92]||(s[92]=[_(" 包含未跟踪文件 (--include-untracked) ")])),_:1},8,["modelValue"])]),_:1}),t(ct,null,{default:a(()=>[t(St,{modelValue:Re.value,"onUpdate:modelValue":s[21]||(s[21]=b=>Re.value=b)},{default:a(()=>s[93]||(s[93]=[_(" 排除锁定文件 ")])),_:1},8,["modelValue"])]),_:1})]),_:1})])]),_:1},8,["modelValue","confirm-loading"]),t(ht,{title:"合并分支",modelValue:he.value,"onUpdate:modelValue":s[30]||(s[30]=b=>he.value=b),width:"500px","close-on-click-modal":!1,class:"merge-dialog"},{footer:a(()=>[e("div",In,[t(x,{onClick:s[29]||(s[29]=b=>he.value=!1)},{default:a(()=>s[101]||(s[101]=[_("取消")])),_:1}),t(x,{type:"primary",onClick:ea,loading:o(r).isGitMerging,disabled:!de.value,class:"merge-confirm-btn"},{default:a(()=>s[102]||(s[102]=[_(" 合并 ")])),_:1},8,["loading","disabled"])])]),default:a(()=>[e("div",Mn,[e("p",Pn,"选择要合并到当前分支 ("+L(o(r).currentBranch)+") 的分支:",1),t(ys,{"label-position":"top"},{default:a(()=>[t(ct,{label:"分支类型"},{default:a(()=>[t(ca,{modelValue:gt.value,"onUpdate:modelValue":s[23]||(s[23]=b=>gt.value=b),size:"small"},{default:a(()=>[t(Qt,{label:"all"},{default:a(()=>s[95]||(s[95]=[_("所有分支")])),_:1}),t(Qt,{label:"local"},{default:a(()=>s[96]||(s[96]=[_("本地分支")])),_:1}),t(Qt,{label:"remote"},{default:a(()=>s[97]||(s[97]=[_("远程分支")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(ct,{label:"选择分支"},{default:a(()=>[t(gs,{modelValue:de.value,"onUpdate:modelValue":s[24]||(s[24]=b=>de.value=b),placeholder:"选择要合并的分支",style:{width:"100%"},filterable:""},{default:a(()=>[(f(!0),$(we,null,Fe(Qs.value,b=>(f(),W(vs,{key:b,label:b,value:b},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(ct,{label:"合并选项"},{default:a(()=>[e("div",Nn,[t(St,{modelValue:V.value.noFf,"onUpdate:modelValue":s[25]||(s[25]=b=>V.value.noFf=b)},{default:a(()=>[t(xe,{content:"创建合并提交，即使可以使用快进合并",placement:"top"},{default:a(()=>s[98]||(s[98]=[e("span",null,"禁用快进合并 (--no-ff)",-1)])),_:1})]),_:1},8,["modelValue"]),t(St,{modelValue:V.value.squash,"onUpdate:modelValue":s[26]||(s[26]=b=>V.value.squash=b)},{default:a(()=>[t(xe,{content:"将多个提交压缩为一个提交",placement:"top"},{default:a(()=>s[99]||(s[99]=[e("span",null,"压缩提交 (--squash)",-1)])),_:1})]),_:1},8,["modelValue"]),t(St,{modelValue:V.value.noCommit,"onUpdate:modelValue":s[27]||(s[27]=b=>V.value.noCommit=b)},{default:a(()=>[t(xe,{content:"执行合并但不自动创建提交",placement:"top"},{default:a(()=>s[100]||(s[100]=[e("span",null,"不自动提交 (--no-commit)",-1)])),_:1})]),_:1},8,["modelValue"])])]),_:1}),V.value.noFf&&!V.value.noCommit?(f(),W(ct,{key:0,label:"合并提交信息 (可选)"},{default:a(()=>[t(st,{modelValue:V.value.message,"onUpdate:modelValue":s[28]||(s[28]=b=>V.value.message=b),type:"textarea",rows:3,placeholder:"输入自定义合并提交信息"},null,8,["modelValue"])]),_:1})):A("",!0)]),_:1})])]),_:1},8,["modelValue"]),t(ht,{title:"储藏列表 (Git Stash)",modelValue:se.value,"onUpdate:modelValue":s[31]||(s[31]=b=>se.value=b),width:"600px","close-on-click-modal":!1},{default:a(()=>[e("div",Hn,[Xe((f(),W(ua,{data:o(r).stashes,stripe:"",style:{width:"100%"},"empty-text":"暂无储藏记录"},{default:a(()=>[t(es,{prop:"id",label:"ID",width:"100"}),t(es,{prop:"description",label:"描述"}),t(es,{label:"操作",width:"280"},{default:a(b=>[e("div",Jn,[t(x,{size:"small",type:"info",onClick:Pe=>me(b.row),loading:Be.value},{default:a(()=>s[103]||(s[103]=[_(" 查看 ")])),_:2},1032,["onClick","loading"]),t(x,{size:"small",onClick:Pe=>H(b.row.id,!1),loading:o(r).isApplyingStash},{default:a(()=>s[104]||(s[104]=[_(" 应用 ")])),_:2},1032,["onClick","loading"]),t(x,{size:"small",type:"primary",onClick:Pe=>H(b.row.id,!0),loading:o(r).isApplyingStash},{default:a(()=>s[105]||(s[105]=[_(" 应用并删除 ")])),_:2},1032,["onClick","loading"]),t(x,{size:"small",type:"danger",onClick:Pe=>Ce(b.row.id),loading:o(r).isDroppingStash},{default:a(()=>s[106]||(s[106]=[_(" 删除 ")])),_:2},1032,["onClick","loading"])])]),_:1})]),_:1},8,["data"])),[[da,o(r).isLoadingStashes]]),o(r).stashes.length>0?(f(),$("div",Wn,[t(x,{type:"danger",onClick:Le,loading:o(r).isDroppingStash},{default:a(()=>s[107]||(s[107]=[_(" 清空所有储藏 ")])),_:1},8,["loading"])])):A("",!0)])]),_:1},8,["modelValue"]),t(zt,{modelValue:y.value,"onUpdate:modelValue":s[32]||(s[32]=b=>y.value=b),title:"储藏详情","custom-class":"stash-detail-dialog",size:"extra-large",type:"flex","close-on-click-modal":!1},{default:a(()=>[e("div",qn,[pe.value?(f(),$("div",Yn,[e("div",Xn,[s[108]||(s[108]=e("span",{class:"info-label"},"Stash ID:",-1)),e("code",Kn,L(pe.value.id),1)]),e("div",Zn,[s[109]||(s[109]=e("span",{class:"info-label"},"描述:",-1)),e("span",Qn,L(pe.value.description),1)])])):A("",!0),e("div",ei,[t(fs,{files:ot.value,diffContent:ze.value,selectedFile:Ne.value,emptyText:"该stash没有变更文件",onFileSelect:Ae},null,8,["files","diffContent","selectedFile"])])])]),_:1},8,["modelValue"])],64)}}}),si=mt(ti,[["__scopeId","data-v-ad7100ce"]]),ai={class:"log-header"},li={class:"log-actions"},oi={key:0,class:"filter-panel-header"},ni={class:"filter-form"},ii={class:"filter-item"},ri={class:"filter-item"},ci={class:"filter-item"},ui={class:"filter-item"},di={class:"filter-actions"},fi={key:0},pi={key:1,class:"content-area-content"},mi={key:0,class:"graph-view"},vi={key:0,class:"commit-count"},gi={class:"graph-controls"},hi={class:"zoom-controls"},yi={class:"scale-info"},_i={key:1,class:"table-view-container"},wi=["onClick"],ki={class:"commit-message-cell"},$i={class:"message-content"},bi={key:0,class:"branch-container"},Ci={class:"message-text"},Si={class:"author-name"};const Ti={class:"commit-detail-container"},Vi={key:0,class:"commit-info"},xi={class:"commit-info-header"},Li={class:"info-item"},zi={class:"item-value"},Bi={class:"info-item"},Fi={class:"item-value"},Di={class:"info-item"},Ri={class:"item-value"},Gi={class:"commit-message-container"},Oi=["innerHTML"],Vt=.5,At=1.5,ls=.1,ji=pt({__name:"LogList",setup(Q,{expose:r}){const m=wt();let p=[];const h=d(p),R=d(""),F=d(!1),E=fe(()=>m.isLoadingLog||F.value),M=d(!1),P=d(0),O=d(!1),I=d(null),ie=d(1),G=d(!0),oe=d(!1),ue=d(null),re=d(!1),C=d(null),B=d([]),z=d(""),q=d(!1),D=d(""),K=d(1),he=d(!1),de=d(!1),V=d([]),T=d(""),Z=d(null),Y=d([]),X=d([]),te=d([]),$e=d(!1),Te=d(0),g=d(0),v=d(null),ae=fe(()=>h.value),N=fe(()=>B.value.map(w=>({path:w,name:w.split("/").pop()||w})));async function le(w=!1,l=1){if(!wt().isGitRepo){R.value="当前目录不是Git仓库";return}try{l>1?oe.value=!0:F.value=!0;const k=new URLSearchParams;k.append("page",l.toString()),k.append("all",w.toString()),k.append("with_parents","true"),V.value.length>0&&k.append("author",V.value.join(",")),X.value.length>0&&k.append("branch",X.value.join(",")),T.value&&k.append("message",T.value),Z.value&&Array.isArray(Z.value)&&Z.value.length===2&&(k.append("dateFrom",Z.value[0]),k.append("dateTo",Z.value[1])),k.append("_t",Date.now().toString());const ne=await(await fetch(`/api/log?${k.toString()}`)).json();if(!ne||!ne.data||!Array.isArray(ne.data)){R.value="加载提交历史失败: 服务器返回数据格式不正确";return}const U=l>1;U?ne.data.forEach(Se=>p.push(Se)):(p.length=0,ne.data.forEach(Se=>p.push(Se))),h.value=[...p],ie.value=l,P.value=ne.total||p.length,G.value=ne.hasMore===!0,U||(he.value=!0,setTimeout(()=>{he.value=!1},2e3)),!U&&O.value?setTimeout(se,0):!U&&!O.value&&!w&&ut(()=>{Be(),setTimeout(nt,200)}),R.value=""}catch(k){R.value="加载提交历史失败: "+(k instanceof Error?k.message:String(k)),l>1&&(G.value=!1)}finally{l>1?oe.value=!1:F.value=!1}}async function se(){if(I.value&&p.length!==0)try{I.value.innerHTML="";const w=Oa(I.value,{orientation:"vertical-reverse",template:"metro",author:"提交者 <committer@example.com>"}),l={},u=w.branch(m.currentBranch||"main");l[m.currentBranch||"main"]=u,p.forEach(k=>{let j=u;if(k.branch){const ne=Re(k.branch.split(",")[0]);l[ne]||(l[ne]=w.branch(ne)),j=l[ne]}j.commit({hash:k.hash,subject:k.message,author:`${k.author} <${k.email}>`})}),setTimeout(()=>{ee()},100)}catch(w){R.value="渲染图表失败: "+(w instanceof Error?w.message:String(w))}}function ke(){O.value=!O.value,O.value&&p.length>0&&setTimeout(se,0)}function je(){M.value=!M.value,M.value||(G.value=!0),ie.value=1,le(M.value),ut(()=>{setTimeout(()=>{!O.value&&!M.value&&(Be(),nt())},300)})}function Re(w){return w.includes("HEAD -> ")?w.replace("HEAD -> ",""):w.includes("origin/")?w:w.trim()}function y(w){return w.includes("HEAD")?"success":w.includes("origin/")?"warning":"info"}const pe=d(null),be=d(null);function ze(w){if(O.value||!G.value||oe.value||E.value)return;const l=w.target,{scrollTop:u,scrollHeight:k,clientHeight:j}=l;k-u-j<=20&&_e()}function Be(){if(!pe.value)return;const w=pe.value.$el.querySelector(".el-table__body-wrapper");w&&(be.value=w,be.value&&(be.value.removeEventListener("scroll",ze,!0),be.value.addEventListener("scroll",ze,!0)))}function Ne(){be.value&&(be.value.removeEventListener("scroll",ze,!0),be.value=null)}function Ze(w){w.key==="Escape"&&Me.value&&(Me.value=!1)}kt(()=>{m.isGitRepo?(m.log.length>0?(p.length=0,m.log.forEach(w=>p.push(w)),P.value=m.log.length,O.value&&setTimeout(()=>{se()},100)):le(),ve()):R.value="当前目录不是Git仓库",ut(()=>{setTimeout(()=>{Be()},500)}),Ye(()=>pe.value,w=>{w&&!O.value&&!M.value&&ut(()=>{Be()})}),window.addEventListener("keydown",Ze)}),Ye(()=>m.allBranches,w=>{w&&w.length>0?te.value=[...w].sort():te.value=[]},{immediate:!0}),Sa(()=>{Ne(),ue.value!==null&&(window.clearInterval(ue.value),ue.value=null),window.removeEventListener("keydown",Ze)});async function Ue(){await m.fetchLog(!0),p.length=0,m.log.forEach(w=>p.push(w)),h.value=[...p],P.value=m.log.length,ie.value=1,G.value=!1,he.value=!0,setTimeout(()=>{he.value=!1},2e3),O.value&&(await ut(),se())}Ye(()=>m.log,w=>{try{p.length=0,Array.isArray(w)&&w.forEach(l=>l&&p.push(l)),P.value=p.length,ie.value=1,h.value=[...p],he.value=!0,setTimeout(()=>{he.value=!1},2e3),O.value&&p.length>0&&setTimeout(se,0)}catch{}},{immediate:!0}),r({refreshLog:Ue});function Ie(){K.value<At&&(K.value=Math.min(At,K.value+ls),c())}function S(){K.value>Vt&&(K.value=Math.max(Vt,K.value-ls),c())}function c(){if(!I.value)return;const w=I.value.querySelector("svg");w&&(w.style.transform=`scale(${K.value})`,w.style.transformOrigin="top left")}function ee(){if(!I.value)return;const w=I.value.querySelector("svg");if(!w)return;const l=w.getBoundingClientRect().width/K.value,u=I.value.clientWidth;l>u?K.value=Math.max(Vt,u/l):K.value=1,c()}async function H(w){if(w){C.value=w,re.value=!0,q.value=!0,B.value=[],z.value="",D.value="";try{if(!w.hash||w.hash.length<7){z.value="无效的提交哈希值",q.value=!1;return}const u=await(await fetch(`/api/commit-files?hash=${w.hash}`)).json();u.success&&Array.isArray(u.files)?(B.value=u.files,B.value.length>0?await Ce(w.hash,B.value[0]):z.value="该提交没有变更文件"):z.value=`获取文件列表失败: ${u.error||"未知错误"}`}catch(l){z.value=`获取提交详情失败: ${l.message}`}finally{q.value=!1}}}async function Ce(w,l){q.value=!0,D.value=l;try{const k=await(await fetch(`/api/commit-file-diff?hash=${w}&file=${encodeURIComponent(l)}`)).json();k.success?z.value=k.diff||"没有变更内容":z.value=`获取差异失败: ${k.error||"未知错误"}`}catch(u){z.value=`获取差异失败: ${u.message}`}finally{q.value=!1}}function Le(w){C.value&&Ce(C.value.hash,w)}async function me(w){try{const l=Wa(w);await navigator.clipboard.writeText(l),n.success("提交信息已复制到剪贴板")}catch{n.error("复制失败")}}function _e(){!G.value||oe.value||E.value||le(M.value,ie.value+1)}function Ae(){V.value=[],X.value=[],T.value="",Z.value=null,ie.value=1,le(M.value,1)}function ce(){ie.value=1,le(M.value,1)}async function ve(){try{const l=await(await fetch("/api/authors")).json();l.success&&Array.isArray(l.authors)?Y.value=l.authors.sort():He()}catch{He()}}function He(){const w=new Set;h.value.forEach(l=>{l.author&&w.add(l.author)}),Y.value=Array.from(w).sort()}Ye(()=>h.value,()=>{},{deep:!0});function Je(w,l,u){u.preventDefault(),Te.value=u.clientY,g.value=u.clientX,v.value=w,$e.value=!0;const k=()=>{$e.value=!1,document.removeEventListener("click",k)};setTimeout(()=>{document.addEventListener("click",k)},0)}async function J(w){if(w)try{await Ee.confirm(`确定要撤销提交 ${w.hash.substring(0,7)} 吗？这将创建一个新的提交来撤销这次提交的更改。`,"撤销提交确认",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const u=await(await fetch("/api/revert-commit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hash:w.hash})})).json();u.success?(n.success(u.message||"已成功撤销提交"),Ue(),m.fetchStatus(),m.getBranchStatus()):n.error(u.error||"撤销提交失败")}catch(l){l!=="cancel"&&n.error("撤销提交失败: "+(l.message||l))}}async function Ge(w){if(w)try{await Ee.confirm(`确定要将提交 ${w.hash.substring(0,7)} Cherry-Pick 到当前分支吗？`,"Cherry-Pick确认",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const u=await(await fetch("/api/cherry-pick-commit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hash:w.hash})})).json();u.success?(n.success(u.message||"已成功Cherry-Pick提交"),Ue(),m.fetchStatus(),m.getBranchStatus()):n.error(u.error||"Cherry-Pick提交失败")}catch(l){l!=="cancel"&&n.error("Cherry-Pick提交失败: "+(l.message||l))}}async function ot(w){if(w)try{await navigator.clipboard.writeText(w.hash),n.success(`已复制提交哈希: ${w.hash.substring(0,7)}`)}catch(l){n.error(`复制提交哈希失败: ${l.message}`)}}async function Qe(w){if(w)try{await Ee.confirm(`确定要将当前分支重置(hard)到提交 ${w.hash.substring(0,7)} 吗？
      
      警告：这将丢失该提交之后的所有更改！`,"重置确认",{confirmButtonText:"确认重置",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0});const u=await(await fetch("/api/reset-to-commit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hash:w.hash})})).json();u.success?(n.success(u.message||"已成功重置到指定提交"),Ue(),m.fetchStatus(),m.getBranchStatus()):n.error(u.error||"重置到指定提交失败")}catch(l){l!=="cancel"&&n.error("重置到指定提交失败: "+(l.message||l))}}function nt(){if(O.value||!G.value||oe.value||E.value||M.value)return;if(!be.value){Be();return}const{scrollTop:w,scrollHeight:l,clientHeight:u}=be.value;l-w-u<=50&&_e()}Ye(()=>O.value,w=>{!w&&!M.value&&ut(()=>{Be(),setTimeout(nt,200)})});const Me=d(!1);function bt(){Me.value=!Me.value,ut(()=>{O.value&&I.value&&se()})}return(w,l)=>{var ne;const u=$t,k=Nt,j=is;return f(),$(we,null,[e("div",{class:ge(["card",{"fullscreen-mode":Me.value}])},[e("div",ai,[l[13]||(l[13]=e("div",{class:"header-left"},[e("h2",null,"提交历史")],-1)),e("div",li,[O.value?A("",!0):(f(),W(o(De),{key:0,type:de.value?"primary":"default",size:"small",onClick:l[0]||(l[0]=U=>de.value=!de.value),class:ge(["action-button filter-button icon-only-button",{"active-filter":de.value}])},{icon:a(()=>[t(u,null,{default:a(()=>[t(o(Ta))]),_:1})]),_:1},8,["type","class"])),t(o(De),{type:"primary",size:"small",onClick:ke,class:ge(["action-button view-mode-button icon-only-button",{"active-view":O.value}])},{icon:a(()=>[t(u,null,{default:a(()=>[(f(),W(_t(O.value?o(ns):o(Va))))]),_:1})]),_:1},8,["class"]),Xe(t(o(De),{type:"success",size:"small",onClick:je,loading:E.value,class:ge(["action-button commit-display-button",{"active-commits":M.value}])},{icon:a(()=>[t(u,null,{default:a(()=>[(f(),W(_t(M.value?o(xa):o(La))))]),_:1})]),default:a(()=>[_(" "+L(M.value?"显示分页加载":"显示所有提交"),1)]),_:1},8,["loading","class"]),[[ft,!1]]),t(o(De),{type:"info",size:"small",onClick:bt,class:ge(["action-button fullscreen-button icon-only-button",{"active-fullscreen":Me.value}])},{icon:a(()=>[t(u,null,{default:a(()=>[(f(),W(_t(Me.value?o(os):o(za))))]),_:1})]),_:1},8,["class"]),t(o(De),{circle:"",size:"small",onClick:l[1]||(l[1]=U=>Ue()),class:ge([{"refresh-button-animated":he.value},"action-button refresh-button"])},{default:a(()=>[E.value?(f(),W(u,{key:1},{default:a(()=>[t(o(Ba))]),_:1})):(f(),W(u,{key:0},{default:a(()=>[t(o(rs))]),_:1}))]),_:1},8,["class"])])]),de.value&&!O.value?(f(),$("div",oi,[e("div",ni,[e("div",ii,[t(o(Pt),{modelValue:V.value,"onUpdate:modelValue":l[2]||(l[2]=U=>V.value=U),placeholder:"选择作者",multiple:"",clearable:"",filterable:"",class:"filter-input",size:"small"},{prefix:a(()=>l[14]||(l[14]=[e("span",{class:"compact-label"},"作者",-1)])),default:a(()=>[(f(!0),$(we,null,Fe(Y.value,U=>(f(),W(o(Mt),{key:U,label:U,value:U},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),e("div",ri,[t(o(Pt),{modelValue:X.value,"onUpdate:modelValue":l[3]||(l[3]=U=>X.value=U),placeholder:"选择分支",multiple:"",clearable:"",filterable:"",class:"filter-input",size:"small"},{prefix:a(()=>l[15]||(l[15]=[e("span",{class:"compact-label"},"分支",-1)])),default:a(()=>[(f(!0),$(we,null,Fe(te.value,U=>(f(),W(o(Mt),{key:U,label:U,value:U},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),e("div",ci,[t(o(us),{modelValue:T.value,"onUpdate:modelValue":l[4]||(l[4]=U=>T.value=U),placeholder:"提交信息关键词",clearable:"",class:"filter-input",size:"small"},{prefix:a(()=>l[16]||(l[16]=[e("span",{class:"compact-label"},"信息",-1)])),_:1},8,["modelValue"])]),e("div",ui,[t(o(Fa),{modelValue:Z.value,"onUpdate:modelValue":l[5]||(l[5]=U=>Z.value=U),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"filter-input date-range",size:"small"},{prefix:a(()=>l[17]||(l[17]=[e("span",{class:"compact-label"},"日期",-1)])),_:1},8,["modelValue"])]),e("div",di,[t(o(De),{type:"primary",size:"small",onClick:ce,class:"filter-action-button"},{default:a(()=>l[18]||(l[18]=[_("应用")])),_:1}),t(o(De),{type:"info",size:"small",onClick:Ae,class:"filter-action-button"},{default:a(()=>l[19]||(l[19]=[_("重置")])),_:1})])])])):A("",!0),e("div",{class:ge(["content-area",{"with-filter":de.value&&!O.value}])},[R.value?(f(),$("div",fi,L(R.value),1)):(f(),$("div",pi,[O.value?(f(),$("div",mi,[o(p).length>0?(f(),$("div",vi," 显示 "+L(o(p).length)+" 条提交记录 "+L(M.value?"(全部)":"(分页加载，每页20条)"),1)):A("",!0),e("div",gi,[e("div",hi,[t(o(De),{type:"primary",circle:"",size:"small",onClick:S,disabled:K.value<=Vt},{default:a(()=>[t(u,null,{default:a(()=>[t(o(Da))]),_:1})]),_:1},8,["disabled"]),t(o(Ra),{modelValue:K.value,"onUpdate:modelValue":l[6]||(l[6]=U=>K.value=U),min:Vt,max:At,step:ls,onChange:c,class:"zoom-slider"},null,8,["modelValue"]),t(o(De),{type:"primary",circle:"",size:"small",onClick:Ie,disabled:K.value>=At},{default:a(()=>[t(u,null,{default:a(()=>[t(o(Ga))]),_:1})]),_:1},8,["disabled"]),t(o(De),{type:"primary",size:"small",onClick:ee},{default:a(()=>l[20]||(l[20]=[_(" 自适应大小 ")])),_:1})]),e("div",yi," 缩放: "+L(Math.round(K.value*100))+"% ",1)]),e("div",{ref_key:"graphContainer",ref:I,class:"graph-container"},null,512)])):(f(),$("div",_i,[Xe((f(),W(o(Gs),{ref_key:"tableRef",ref:pe,data:ae.value,stripe:"",border:"",class:"log-table","empty-text":E.value?"加载中...":"没有匹配的提交记录",height:"450",onRowContextmenu:Je},{default:a(()=>[t(o(xt),{label:"哈希",width:"80",resizable:""},{default:a(U=>[e("span",{class:"commit-hash",onClick:Se=>H(U.row)},L(U.row.hash.substring(0,6)),9,wi)]),_:1}),t(o(xt),{label:"提交信息","min-width":"300"},{default:a(U=>[e("div",ki,[e("div",$i,[U.row.branch?(f(),$("div",bi,[(f(!0),$(we,null,Fe(U.row.branch.split(","),(Se,Ke)=>(f(),W(o(Bt),{key:Ke,size:"small",type:y(Se),class:"branch-tag"},{default:a(()=>[_(L(Re(Se)),1)]),_:2},1032,["type"]))),128))])):A("",!0),e("span",Ci,L(U.row.message),1),t(o(De),{type:"text",icon:o(Lt),size:"small",onClick:qe(Se=>me(U.row.message),["stop"]),class:"copy-message-btn",title:"复制纯净提交信息（不含类型前缀）"},null,8,["icon","onClick"])])])]),_:1}),t(o(xt),{prop:"date",label:"日期",width:"150",resizable:""}),t(o(xt),{label:"作者",width:"100",resizable:""},{default:a(U=>[t(k,{content:U.row.email,placement:"top","hide-after":1e3},{default:a(()=>[e("span",Si,L(U.row.author),1)]),_:2},1032,["content"])]),_:1})]),_:1},8,["data","empty-text"])),[[j,E.value]]),(M.value,A("",!0))]))]))],2),t(zt,{modelValue:re.value,"onUpdate:modelValue":l[7]||(l[7]=U=>re.value=U),title:`提交详情: ${(ne=C.value)!=null&&ne.hash?C.value.hash.substring(0,7):"未知"}`,size:"extra-large",type:"flex","destroy-on-close":"","custom-class":"commit-detail-dialog"},{default:a(()=>[Xe((f(),$("div",Ti,[C.value?(f(),$("div",Vi,[e("div",xi,[e("div",Li,[l[24]||(l[24]=e("span",{class:"item-label"},"哈希:",-1)),e("span",zi,L(C.value.hash),1)]),e("div",Bi,[l[25]||(l[25]=e("span",{class:"item-label"},"作者:",-1)),e("span",Fi,L(C.value.author)+" <"+L(C.value.email)+">",1)]),e("div",Di,[l[26]||(l[26]=e("span",{class:"item-label"},"日期:",-1)),e("span",Ri,L(C.value.date),1)])]),e("div",Gi,[l[27]||(l[27]=e("div",{class:"message-label"},"提交信息:",-1)),e("div",{class:"message-content",innerHTML:o(Ja)(C.value.message).replace(/\n/g,"<br>")},null,8,Oi)])])):A("",!0),t(fs,{files:N.value,loading:q.value,diffContent:z.value,selectedFile:D.value,emptyText:"没有找到变更文件",onFileSelect:Le},null,8,["files","loading","diffContent","selectedFile"])])),[[j,q.value]])]),_:1},8,["modelValue","title"])],2),Xe(e("div",{class:ge(["context-menu",{"fullscreen-context-menu":Me.value}]),style:dt({top:Te.value+"px",left:g.value+"px"})},[e("div",{class:"context-menu-item",onClick:l[8]||(l[8]=U=>H(v.value))},l[28]||(l[28]=[e("i",{class:"el-icon-view"},null,-1),_(" 查看详情 ")])),e("div",{class:"context-menu-item",onClick:l[9]||(l[9]=U=>ot(v.value))},l[29]||(l[29]=[e("i",{class:"el-icon-document-copy"},null,-1),_(" 复制提交哈希 ")])),e("div",{class:"context-menu-item",onClick:l[10]||(l[10]=U=>Qe(v.value))},l[30]||(l[30]=[e("i",{class:"el-icon-refresh-right"},null,-1),_(" 重置到该提交(hard) ")])),e("div",{class:"context-menu-item",onClick:l[11]||(l[11]=U=>J(v.value))},l[31]||(l[31]=[e("i",{class:"el-icon-delete"},null,-1),_(" 撤销提交 (Revert) ")])),e("div",{class:"context-menu-item",onClick:l[12]||(l[12]=U=>Ge(v.value))},l[32]||(l[32]=[e("i",{class:"el-icon-edit"},null,-1),_(" Cherry-Pick 到当前分支 ")]))],6),[[ft,$e.value]])],64)}}}),Ui=mt(ji,[["__scopeId","data-v-10212130"]]),Ai={class:"dialog-content"},Ei={class:"dialog-toolbar"},Mi={class:"history-scroll"},Pi={key:0,class:"loading-state"},Ni={key:2,class:"history-list"},Ii=["onClick"],Hi={class:"command-info"},Ji={class:"command-text"},Wi={class:"command-meta"},qi={class:"timestamp"},Yi={class:"duration"},Xi={class:"item-actions"},Ki={key:0,class:"item-details"},Zi={key:0,class:"output-section"},Qi={class:"output-header"},er={class:"output-content"},tr={key:0,class:"truncation-notice"},sr={class:"output-header"},ar={class:"output-content"},lr={key:0,class:"truncation-notice"},or={key:2,class:"output-section error"},nr={class:"output-content"},ir=pt({__name:"CommandHistory",setup(Q){const r=wt(),m=d([]),p=d(!1),h=d(!1),R=d(!1),F=d(!1),E=d(new Set),M=d(!1),P=d(!1);function O(){P.value=!0,m.value.length===0&&I()}async function I(){try{if(p.value=!0,r.socket&&r.socket.connected)r.socket.emit("request_full_history");else{const T=await(await fetch("/api/command-history")).json();T.success?m.value=T.history:n.error(`加载命令历史失败: ${T.error}`)}}catch(V){n.error(`加载命令历史失败: ${V.message}`)}finally{p.value=!1}}async function ie(){if(m.value.length===0){n.warning("没有可复制的命令历史");return}try{R.value=!0;const V=m.value.map(T=>{let Z=`# ${ue(T.timestamp)} (耗时: ${re(T.executionTime)}) - ${T.success?"成功":"失败"}
`;if(Z+=`${T.command}
`,T.stdout&&(Z+=`
# 输出:
${T.stdout}
`),T.stderr){const Y=D(T.command)?"输出信息":"错误输出";Z+=`
# ${Y}:
${T.stderr}
`}return T.error&&(Z+=`
# 错误信息:
${T.error}
`),Z}).join(`
---

`);await navigator.clipboard.writeText(V),n.success("命令历史已复制到剪贴板")}catch(V){n.error(`复制失败: ${V.message}`)}finally{R.value=!1}}async function G(){if(m.value.length===0){n.warning("没有可复制的命令");return}try{M.value=!0;const V=m.value.map(T=>T.command).join(`
`);await navigator.clipboard.writeText(V),n.success("命令列表已复制到剪贴板")}catch(V){n.error(`复制失败: ${V.message}`)}finally{M.value=!1}}async function oe(){try{if(await Ee.confirm("确定要清空所有命令历史记录吗？此操作不可恢复。","清空命令历史",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),h.value=!0,r.socket&&r.socket.connected)r.socket.emit("clear_command_history");else{const T=await(await fetch("/api/clear-command-history",{method:"POST",headers:{"Content-Type":"application/json"}})).json();T.success?(m.value=[],n.success("命令历史已清空")):n.error(`清空命令历史失败: ${T.error}`)}}catch(V){V!=="cancel"&&V.toString()!=="Error: cancel"&&n.error(`清空命令历史失败: ${V.message}`)}finally{h.value=!1}}function ue(V){return new Date(V).toLocaleString()}function re(V){return V<1e3?`${V}ms`:`${(V/1e3).toFixed(2)}s`}function C(V){E.value.has(V)?E.value.delete(V):E.value.add(V)}function B(V){return E.value.has(V)}async function z(V){try{await navigator.clipboard.writeText(V),n.success("命令已复制到剪贴板")}catch(T){n.error(`复制失败: ${T.message}`)}}function q(V){return V.includes("git push")||V.includes("git-push")}function D(V){return!!q(V)}async function K(V){try{let T="";if(V.stdout&&(T+=`标准输出:
${V.stdout}

`),V.stderr){const Z=D(V.command)?"输出信息":"错误输出";T+=`${Z}:
${V.stderr}

`}V.error&&(T+=`错误信息:
${V.error}`),await navigator.clipboard.writeText(T.trim()),n.success("输出已复制到剪贴板")}catch(T){n.error(`复制失败: ${T.message}`)}}function he(){if(!r.socket){console.error("Socket实例不可用");return}r.socket.on("initial_command_history",V=>{m.value=V.history,F.value=!0}),r.socket.on("command_history_update",V=>{m.value.unshift(V.newCommand),m.value.length>100&&m.value.pop(),F.value=!0}),r.socket.on("full_command_history",V=>{m.value=V.history,p.value=!1,F.value=!0}),r.socket.on("command_history_cleared",V=>{V.success&&(m.value=[],n.success("命令历史已清空")),h.value=!1}),r.socket.on("connect",()=>{F.value=!0,n.success("已连接到实时命令历史")}),r.socket.on("disconnect",()=>{F.value=!1,n.warning("实时命令历史连接已断开")})}function de(){r.socket&&(r.socket.off("initial_command_history"),r.socket.off("command_history_update"),r.socket.off("full_command_history"),r.socket.off("command_history_cleared"))}return kt(()=>{he(),r.socket||(console.log("尝试初始化Socket连接"),r.initSocketConnection())}),Ss(()=>{de()}),(V,T)=>{const Z=De,Y=Bt,X=$t,te=Et,$e=cs,Te=It;return f(),$(we,null,[t(Z,{type:"primary",icon:o(ja),onClick:O,class:"command-history-button",title:"查看Git命令历史"},{default:a(()=>T[1]||(T[1]=[_(" 命令历史 ")])),_:1},8,["icon"]),(f(),W(Ua,{to:"body"},[t(Te,{modelValue:P.value,"onUpdate:modelValue":T[0]||(T[0]=g=>P.value=g),title:"Git 命令历史",width:"80%",top:"5vh","destroy-on-close":"",class:"command-history-dialog","z-index":99999,"append-to-body":"",modal:""},{default:a(()=>[e("div",Ai,[e("div",Ei,[t(Y,{type:F.value?"success":"danger",size:"small",effect:"dark",class:"socket-status"},{default:a(()=>[_(L(F.value?"实时更新":"未连接"),1)]),_:1},8,["type"]),t(Z,{type:"success",icon:o(Lt),circle:"",size:"small",onClick:G,loading:M.value,class:"copy-commands-button",title:"只复制命令列表（不含输出）",disabled:m.value.length===0},null,8,["icon","loading","disabled"]),t(Z,{type:"primary",icon:o(Lt),circle:"",size:"small",onClick:ie,loading:R.value,class:"copy-all-button",title:"复制完整命令历史（含输出）",disabled:m.value.length===0},null,8,["icon","loading","disabled"]),t(Z,{type:"danger",icon:o(Bs),circle:"",size:"small",onClick:oe,loading:h.value,class:"clear-button",title:"清空命令历史",disabled:m.value.length===0},null,8,["icon","loading","disabled"])]),e("div",Mi,[p.value&&m.value.length===0?(f(),$("div",Pi,[t(X,{class:"loading-icon is-loading"},{default:a(()=>T[2]||(T[2]=[e("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[e("path",{fill:"currentColor",d:"M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32zm0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32zm448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32zm-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32zM195.2 195.2a32 32 0 0 1 45.248 0L376.32 331.008a32 32 0 0 1-45.248 45.248L195.2 240.448a32 32 0 0 1 0-45.248zm452.544 452.544a32 32 0 0 1 45.248 0L828.8 783.552a32 32 0 0 1-45.248 45.248L647.744 692.992a32 32 0 0 1 0-45.248zM828.8 195.264a32 32 0 0 1 0 45.184L692.992 376.32a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0zm-452.544 452.48a32 32 0 0 1 0 45.248L240.448 828.8a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0z"})],-1)])),_:1}),T[3]||(T[3]=e("div",{class:"loading-text"},"加载命令历史...",-1))])):m.value.length===0?(f(),W(te,{key:1,description:"暂无命令历史"})):(f(),$("div",Ni,[(f(!0),$(we,null,Fe(m.value,(g,v)=>(f(),$("div",{key:v,class:ge(["history-item",{"is-error":!g.success}])},[e("div",{class:"item-header",onClick:ae=>C(v)},[e("div",Hi,[e("div",Ji,[t(Y,{size:"small",type:g.success?"success":"danger",effect:"dark",class:"status-tag"},{default:a(()=>[_(L(g.success?"成功":"失败"),1)]),_:2},1032,["type"]),e("code",null,L(g.command),1)]),e("div",Wi,[e("span",qi,L(ue(g.timestamp)),1),e("span",Yi,"耗时: "+L(re(g.executionTime)),1)])]),e("div",Xi,[t(Z,{type:"primary",icon:o(Lt),circle:"",size:"small",onClick:qe(ae=>z(g.command),["stop"]),title:"复制命令"},null,8,["icon","onClick"]),t(Z,{type:B(v)?"primary":"default",icon:B(v)?o(zs):o(yt),circle:"",size:"small",onClick:qe(ae=>C(v),["stop"]),title:"展开/收起"},null,8,["type","icon","onClick"])])],8,Ii),B(v)?(f(),$("div",Ki,[g.stdout?(f(),$("div",Zi,[e("div",Qi,[T[4]||(T[4]=e("h4",null,"标准输出",-1)),t(Z,{type:"primary",icon:o(Lt),circle:"",size:"small",onClick:ae=>K(g),title:"复制输出"},null,8,["icon","onClick"])]),e("pre",er,L(g.stdout),1),g.isStdoutTruncated?(f(),$("div",tr,[t($e,{type:"info",closable:!1,"show-icon":""},{default:a(()=>T[5]||(T[5]=[_(" 输出内容过长已被截断，请直接执行命令查看完整输出 ")])),_:1})])):A("",!0)])):A("",!0),g.stderr?(f(),$("div",{key:1,class:ge(["output-section",D(g.command)?"":"error"])},[e("div",sr,[e("h4",null,L(D(g.command)?"输出信息":"错误输出"),1)]),e("pre",ar,L(g.stderr),1),g.isStderrTruncated?(f(),$("div",lr,[t($e,{type:"info",closable:!1,"show-icon":""},{default:a(()=>[_(L(D(g.command)?"输出信息":"错误输出")+"内容过长已被截断，请直接执行命令查看完整输出 ",1)]),_:2},1024)])):A("",!0)],2)):A("",!0),g.error?(f(),$("div",or,[T[6]||(T[6]=e("div",{class:"output-header"},[e("h4",null,"错误信息")],-1)),e("pre",nr,L(g.error),1)])):A("",!0)])):A("",!0)],2))),128))]))])])]),_:1},8,["modelValue"])]))],64)}}}),rr=mt(ir,[["__scopeId","data-v-234c209d"]]),cr="data:image/svg+xml,%3csvg%20width='200'%20height='200'%20viewBox='0%200%20200%20200'%20xmlns='http://www.w3.org/2000/svg'%3e%3c!--%20主分支%20--%3e%3cline%20x1='40'%20y1='40'%20x2='40'%20y2='160'%20stroke='%2334495e'%20stroke-width='8'%20stroke-linecap='round'%20/%3e%3c!--%20特性分支%20--%3e%3cpath%20d='M40,70%20C60,70%2080,90%2080,110%20L80,130'%20stroke='%233498db'%20stroke-width='8'%20stroke-linecap='round'%20stroke-linejoin='round'%20fill='none'%20/%3e%3c!--%20开发分支%20--%3e%3cpath%20d='M40,100%20C60,100%20100,110%20100,130%20L100,160'%20stroke='%232ecc71'%20stroke-width='8'%20stroke-linecap='round'%20stroke-linejoin='round'%20fill='none'%20/%3e%3c!--%20修复分支%20--%3e%3cpath%20d='M40,130%20C60,130%20120,140%20120,160'%20stroke='%23e74c3c'%20stroke-width='8'%20stroke-linecap='round'%20stroke-linejoin='round'%20fill='none'%20/%3e%3c!--%20合并点%20--%3e%3cpath%20d='M80,130%20C80,145%2060,145%2040,145'%20stroke='%233498db'%20stroke-width='8'%20stroke-linecap='round'%20stroke-linejoin='round'%20fill='none'%20/%3e%3c!--%20节点%20--%3e%3ccircle%20cx='40'%20cy='40'%20r='10'%20fill='%2334495e'%20/%3e%3ccircle%20cx='40'%20cy='70'%20r='10'%20fill='%2334495e'%20/%3e%3ccircle%20cx='40'%20cy='100'%20r='10'%20fill='%2334495e'%20/%3e%3ccircle%20cx='40'%20cy='130'%20r='10'%20fill='%2334495e'%20/%3e%3ccircle%20cx='40'%20cy='145'%20r='10'%20fill='%2334495e'%20/%3e%3ccircle%20cx='40'%20cy='160'%20r='10'%20fill='%2334495e'%20/%3e%3ccircle%20cx='80'%20cy='130'%20r='10'%20fill='%233498db'%20/%3e%3ccircle%20cx='100'%20cy='160'%20r='10'%20fill='%232ecc71'%20/%3e%3ccircle%20cx='120'%20cy='160'%20r='10'%20fill='%23e74c3c'%20/%3e%3c/svg%3e",ur={class:"main-header"},dr={class:"header-left"},fr=["src"],pr={class:"header-info"},mr={key:0,id:"user-info"},vr={class:"user-name"},gr={class:"user-email"},hr={key:1,id:"user-info"},yr={class:"directory-selector"},_r={class:"directory-display"},wr={class:"directory-icon"},kr=["title"],$r={class:"directory-actions"},br={key:2,class:"command-history-section"},Cr={class:"main-container"},Sr={key:0,class:"loading-container"},Tr={class:"loading-spinner"},Vr={key:1,class:"grid-layout"},xr={class:"git-status-panel"},Lr={key:0,class:"commit-form-panel"},zr={key:0,class:"card"},Br={class:"tips"},Fr={key:1,class:"commit-form-panel"},Dr={key:2,class:"log-list-panel"},Rr={class:"dialog-footer"},Gr={class:"main-footer"},Or={key:0,class:"branch-info"},jr={class:"branch-wrapper"},Ur={key:1,class:"footer-right"},Ar={class:"repo-url"},Er={class:"dialog-footer"},Mr={class:"directory-input-group"},Pr={class:"recent-directories"},Nr={class:"dialog-footer"},Ir=pt({__name:"App",setup(Q){const r=d(""),m=d(null),p=d(null),h=wt(),R=ds(),F=d(!1),E=d("");function M(){R.config&&(r.value=`默认提交信息: ${R.config.defaultCommitMessage}`)}async function P(){try{const c=await(await fetch("/api/current_directory")).json();return E.value=c.directory||"未知目录",c}catch(S){return console.error("获取当前目录失败:",S),{directory:"未知目录",isGitRepo:!1}}}kt(async()=>{console.log("---------- 页面初始化开始 ----------");try{const S=await P();R.isLoaded||await R.loadConfig(),M(),h.isGitRepo=S.isGitRepo===!0,h.lastCheckedTime=Date.now(),h.isGitRepo?await Promise.all([h.getCurrentBranch(!0),h.getAllBranches(),h.getUserInfo(),h.getRemoteUrl(),h.getBranchStatus(!0)]):n.warning("当前目录不是Git仓库，部分功能将不可用")}catch(S){console.error("初始化失败:",S)}finally{F.value=!0,console.log("---------- 页面初始化完成 ----------"),setTimeout(()=>{$e()},100)}});const O=d(!1),I=d(""),ie=d("");async function G(){await h.createBranch(I.value,ie.value)&&(O.value=!1,I.value="",p.value&&p.value.refreshStatus(),m.value&&m.value.refreshLog())}function oe(){ie.value=h.currentBranch,O.value=!0}async function ue(S){await h.changeBranch(S)&&(p.value&&p.value.refreshStatus(),m.value&&m.value.refreshLog())}const re=d(!1),C=d(""),B=d("");function z(){C.value=h.userName,B.value=h.userEmail,re.value=!0}async function q(){if(!C.value||!B.value){n.warning("用户名和邮箱不能为空");return}await h.restoreUserConfig(C.value,B.value)&&(re.value=!1)}async function D(){await h.clearUserConfig()&&(C.value="",B.value="")}let K=!1,he=!1,de=!1,V=0,T=0,Z="",Y="",X=null;function te(){const S=document.querySelector(".grid-layout");if(!S)return;const c=getComputedStyle(S).gridTemplateColumns.split(" "),ee=getComputedStyle(S).gridTemplateRows.split(" ");if(c.length>=3&&ee.length>=3){const H=parseFloat(c[0]),Ce=parseFloat(c[2]),Le=H+Ce,me=H/Le,_e=parseFloat(ee[0]),Ae=parseFloat(ee[2]),ce=_e+Ae,ve=_e/ce;localStorage.setItem("zen-gitsync-layout-left-ratio",me.toString()),localStorage.setItem("zen-gitsync-layout-top-ratio",ve.toString()),console.log(`布局比例已保存 - 左侧: ${(me*100).toFixed(0)}%, 上方: ${(ve*100).toFixed(0)}%`),localStorage.setItem("zen-gitsync-layout-bottom-left-ratio",me.toString()),console.log(`底部布局比例已保存 - 左侧: ${(me*100).toFixed(0)}%`)}}function $e(){const S=document.querySelector(".grid-layout");if(!S)return;const c=localStorage.getItem("zen-gitsync-layout-left-ratio"),ee=localStorage.getItem("zen-gitsync-layout-top-ratio");if(c){const H=parseFloat(c),Ce=1-H;S.style.gridTemplateColumns=`${H}fr 8px ${Ce}fr`,console.log(`已恢复左侧比例: ${(H*100).toFixed(0)}%`)}else S.style.gridTemplateColumns="1fr 8px 3fr";if(ee){const H=parseFloat(ee),Ce=1-H;S.style.gridTemplateRows=`${H}fr 8px ${Ce}fr`,console.log(`已恢复上方比例: ${(H*100).toFixed(0)}%`)}}function Te(S){var H;const c=S.currentTarget;if(!c||!c.id)return;X=c.id,X==="v-resizer"?K=!0:X==="v-resizer-bottom"&&(he=!0),V=S.clientX;const ee=document.querySelector(".grid-layout");Z=getComputedStyle(ee).gridTemplateColumns,(H=document.getElementById(X))==null||H.classList.add("active"),document.addEventListener("mousemove",g),document.addEventListener("mouseup",v),S.preventDefault()}function g(S){if(!K&&!he)return;const c=document.querySelector(".grid-layout"),ee=S.clientX-V,H=Z.split(" ");if(H.length>=3){const Ce=parseFloat(H[0]),Le=parseFloat(H[2]),me=Ce+Le,_e=(Ce+ee/c.clientWidth*me)/me,Ae=1-_e,ce=.1,ve=.5;_e<ce?c.style.gridTemplateColumns=`${ce}fr 8px ${1-ce}fr`:_e>ve?c.style.gridTemplateColumns=`${ve}fr 8px ${1-ve}fr`:c.style.gridTemplateColumns=`${_e}fr 8px ${Ae}fr`}}function v(){var S,c;K=!1,he=!1,(S=document.getElementById("v-resizer"))==null||S.classList.remove("active"),(c=document.getElementById("v-resizer-bottom"))==null||c.classList.remove("active"),document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",v),te()}function ae(S){var ee;de=!0,T=S.clientY;const c=document.querySelector(".grid-layout");Y=getComputedStyle(c).gridTemplateRows,(ee=document.getElementById("h-resizer"))==null||ee.classList.add("active"),document.addEventListener("mousemove",N),document.addEventListener("mouseup",le),S.preventDefault()}function N(S){if(!de)return;const c=document.querySelector(".grid-layout"),ee=S.clientY-T,H=Y.split(" ");if(H.length>=3){const Ce=parseFloat(H[0]),Le=parseFloat(H[2]),me=Ce+Le,_e=(Ce+ee/c.clientHeight*me)/me,Ae=1-_e,ce=.2,ve=.8;_e<ce?c.style.gridTemplateRows=`${ce}fr 8px ${1-ce}fr`:_e>ve?c.style.gridTemplateRows=`${ve}fr 8px ${1-ve}fr`:c.style.gridTemplateRows=`${_e}fr 8px ${Ae}fr`}}function le(){var S;de=!1,(S=document.getElementById("h-resizer"))==null||S.classList.remove("active"),document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",le),te()}const se=d(!1),ke=d(""),je=d(!1),Re=d([]);async function y(){if(!E.value){n.warning("当前目录路径为空");return}try{await navigator.clipboard.writeText(E.value),n.success("已复制目录路径")}catch(S){console.error("复制目录路径失败:",S),n.error(`复制失败: ${S.message}`)}}function pe(){ke.value=E.value,se.value=!0,be()}async function be(){try{const c=await(await fetch("/api/recent_directories")).json();c.success&&Array.isArray(c.directories)&&(Re.value=c.directories)}catch(S){console.error("获取最近目录失败:",S)}}async function ze(){if(!ke.value){n.warning("目录路径不能为空");return}try{je.value=!0;const c=await(await fetch("/api/change_directory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:ke.value})})).json();c.success?(n.success("已切换工作目录"),E.value=c.directory,se.value=!1,await Be(c.directory),await be(),h.isGitRepo=c.isGitRepo,await R.loadConfig(!0),c.isGitRepo?(await Promise.all([h.getCurrentBranch(),h.getAllBranches(),h.getUserInfo(),h.getRemoteUrl()]),p.value&&p.value.refreshStatus(),m.value&&m.value.refreshLog()):(n.warning("当前目录不是Git仓库，部分功能将不可用"),h.$reset())):n.error(c.error||"切换目录失败")}catch(S){n.error(`切换目录失败: ${S.message}`)}finally{je.value=!1}}async function Be(S){try{await fetch("/api/save_recent_directory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:S})})}catch(c){console.error("保存最近目录失败:",c)}}async function Ne(){try{if(!E.value){n.warning("当前目录路径为空");return}const c=await(await fetch("/api/open_directory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:E.value})})).json();c.success?n.success("已在文件管理器中打开目录"):c.error&&n.error(c.error)}catch(S){console.error("打开目录失败:",S),n.error(`打开目录失败: ${S.message}`)}}async function Ze(){try{const c=await(await fetch("/api/browse_directory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPath:ke.value||E.value})})).json();c.success?Ue(c):c.error&&n.error(c.error)}catch(S){console.error("浏览目录失败:",S),n.error(`浏览目录失败: ${S.message}`)}}function Ue(S){!S||!S.items||Ee.alert(Oe("div",{class:"directory-browser"},[Oe("div",{class:"current-path"},[Oe("span",{class:"path-label"},"当前路径: "),Oe("span",{class:"path-value"},S.path)]),Oe("div",{class:"directory-list"},[S.parentPath?Oe("div",{class:"directory-item parent-dir",onClick:()=>{Ie(S.parentPath)}},[Oe("span",{class:"dir-icon"},Oe("svg",{class:"folder-icon",viewBox:"0 0 24 24",width:"20",height:"20",style:{fill:"#E6A23C"}},[Oe("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"})])),Oe("span",{class:"dir-name"},"返回上级目录")]):null,...S.items.map(c=>Oe("div",{class:"directory-item",onClick:()=>{Ie(c.path)}},[Oe("span",{class:"dir-icon"},Oe("svg",{class:"folder-icon",viewBox:"0 0 24 24",width:"20",height:"20",style:{fill:"#409EFF"}},[Oe("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"})])),Oe("span",{class:"dir-name"},c.name)]))])]),"浏览并选择目录",{confirmButtonText:"使用当前目录",customClass:"directory-browser-dialog",callback:c=>{c==="confirm"&&(ke.value=S.path)}})}async function Ie(S){try{Ee.close(),setTimeout(async()=>{try{const ee=await(await fetch("/api/browse_directory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPath:S})})).json();ee.success?Ue(ee):ee.error&&n.error(ee.error)}catch(c){console.error("浏览目录失败:",c),n.error(`浏览目录失败: ${c.message}`)}},100)}catch(c){console.error("处理目录选择时出错:",c),n.error(`处理目录选择时出错: ${c.message}`)}}return(S,c)=>{const ee=$t,H=De,Ce=Fs,Le=us,me=Rs,_e=Mt,Ae=Pt,ce=Ds,ve=It,He=cs,Je=Bt;return f(),$(we,null,[e("header",ur,[e("div",dr,[e("img",{src:o(cr),alt:"Zen GitSync Logo",class:"logo"},null,8,fr),c[14]||(c[14]=e("h1",null,"Zen GitSync UI",-1))]),e("div",pr,[o(h).userName&&o(h).userEmail?(f(),$("div",mr,[c[15]||(c[15]=e("span",{class:"user-label"},"用户:",-1)),e("span",vr,L(o(h).userName),1),e("span",gr,"<"+L(o(h).userEmail)+">",1),t(H,{type:"primary",size:"small",onClick:z,class:"user-settings-btn",circle:""},{default:a(()=>[t(ee,null,{default:a(()=>[t(o($s))]),_:1})]),_:1})])):(f(),$("div",hr,[c[16]||(c[16]=e("span",{class:"user-label"},"用户: ",-1)),c[17]||(c[17]=e("span",{class:"user-warning"},"未配置",-1)),t(H,{type:"primary",size:"small",onClick:z,class:"user-settings-btn",circle:""},{default:a(()=>[t(ee,null,{default:a(()=>[t(o($s))]),_:1})]),_:1})])),e("div",yr,[e("div",_r,[e("div",wr,[t(ee,null,{default:a(()=>[t(o(bs))]),_:1})]),e("div",{class:"directory-path",title:E.value},L(E.value),9,kr)]),e("div",$r,[t(H,{type:"primary",size:"small",onClick:pe,class:"dir-button",circle:"",title:"切换目录"},{default:a(()=>[t(ee,null,{default:a(()=>c[18]||(c[18]=[e("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[e("path",{fill:"currentColor",d:"M128 192v640h768V320H485.76L357.504 192H128zm-32-64h287.872l128.384 128H928a32 32 0 0 1 32 32v576a32 32 0 0 1-32 32H96a32 32 0 0 1-32-32V160a32 32 0 0 1 32-32z"})],-1)])),_:1})]),_:1}),t(H,{type:"success",size:"small",onClick:Ne,class:"dir-button",circle:"",title:"在资源管理器中打开"},{default:a(()=>[t(ee,null,{default:a(()=>c[19]||(c[19]=[e("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[e("path",{fill:"currentColor",d:"M928 444H820V330.4c0-17.7-14.3-32-32-32H473L355.7 186.2a8.15 8.15 0 0 0-5.5-2.2H96c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h698c13 0 24.8-7.9 29.7-20l134-332c1.5-3.8 2.3-7.9 2.3-12 0-17.7-14.3-32-32-32zM136 256h188.5l119.6 114.4H748V444H238c-13 0-24.8 7.9-29.7 20L136 643.2V256zm635.3 512H159l103.3-256h612.4L771.3 768z"})],-1)])),_:1})]),_:1}),t(H,{type:"info",size:"small",onClick:y,class:"dir-button",circle:"",title:"复制路径"},{default:a(()=>[t(ee,null,{default:a(()=>c[20]||(c[20]=[e("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[e("path",{fill:"currentColor",d:"M768 832a128 128 0 0 1-128 128H192A128 128 0 0 1 64 832V384a128 128 0 0 1 128-128v64a64 64 0 0 0-64 64v448a64 64 0 0 0 64 64h448a64 64 0 0 0 64-64h64z"}),e("path",{fill:"currentColor",d:"M384 128a64 64 0 0 0-64 64v448a64 64 0 0 0 64 64h448a64 64 0 0 0 64-64V192a64 64 0 0 0-64-64H384zm0-64h448a128 128 0 0 1 128 128v448a128 128 0 0 1-128 128H384a128 128 0 0 1-128-128V192A128 128 0 0 1 384 64z"})],-1)])),_:1})]),_:1})])]),o(h).isGitRepo?(f(),$("div",br,[t(rr)])):A("",!0)])]),e("main",Cr,[F.value?(f(),$("div",Vr,[e("div",xr,[t(no,{ref_key:"gitStatusRef",ref:p,"initial-directory":E.value},null,8,["initial-directory"])]),e("div",{class:"vertical-resizer",id:"v-resizer",onMousedown:Te},null,32),o(h).isGitRepo?(f(),$("div",Lr,[!o(h).userName||!o(h).userEmail?(f(),$("div",zr,[c[26]||(c[26]=e("h2",null,"Git用户未配置",-1)),c[27]||(c[27]=e("p",null,"请先配置Git用户信息才能进行提交操作。",-1)),e("div",Br,[c[24]||(c[24]=e("h3",null,"您可以通过以下方式配置：",-1)),c[25]||(c[25]=e("ol",null,[e("li",null,"点击右上角的设置按钮，配置用户名和邮箱"),e("li",null,"或者使用命令行配置："),e("div",{class:"code-block"},[_(' git config --global user.name "您的用户名"'),e("br"),_(' git config --global user.email "您的邮箱" ')])],-1)),t(H,{type:"primary",onClick:z},{default:a(()=>c[23]||(c[23]=[_(" 立即配置 ")])),_:1})])])):(f(),W(si,{key:1}))])):(f(),$("div",Fr,c[28]||(c[28]=[e("div",{class:"card",style:{padding:"20px"}},[e("h2",null,"Git仓库初始化"),e("p",null,"当前目录不是Git仓库，请先初始化Git仓库或切换到Git仓库目录。"),e("div",{class:"tips"},[e("h3",null,"可以使用以下命令初始化仓库："),e("div",{class:"code-block"},"git init")])],-1)]))),e("div",{class:"horizontal-resizer",id:"h-resizer",onMousedown:ae},null,32),o(h).isGitRepo?(f(),$("div",Dr,[t(Ui,{ref_key:"logListRef",ref:m},null,512)])):A("",!0),t(ve,{modelValue:O.value,"onUpdate:modelValue":c[3]||(c[3]=J=>O.value=J),title:"创建新分支",width:"30%","destroy-on-close":""},{footer:a(()=>[e("span",Rr,[t(H,{onClick:c[2]||(c[2]=J=>O.value=!1)},{default:a(()=>c[29]||(c[29]=[_("取消")])),_:1}),t(H,{type:"primary",onClick:G,loading:o(h).isCreatingBranch},{default:a(()=>c[30]||(c[30]=[_(" 创建 ")])),_:1},8,["loading"])])]),default:a(()=>[t(ce,{model:{newBranchName:I.value,selectedBaseBranch:ie.value}},{default:a(()=>[t(me,{label:"新分支名称"},{default:a(()=>[t(Le,{modelValue:I.value,"onUpdate:modelValue":c[0]||(c[0]=J=>I.value=J),placeholder:"请输入新分支名称"},null,8,["modelValue"])]),_:1}),t(me,{label:"基于分支"},{default:a(()=>[t(Ae,{modelValue:ie.value,"onUpdate:modelValue":c[1]||(c[1]=J=>ie.value=J),placeholder:"选择基础分支",style:{width:"100%"}},{default:a(()=>[(f(!0),$(we,null,Fe(o(h).allBranches,J=>(f(),W(_e,{key:J,label:J,value:J},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])):(f(),$("div",Sr,[t(Ce,{class:"loading-card"},{default:a(()=>[e("div",Tr,[t(ee,{class:"is-loading"},{default:a(()=>c[21]||(c[21]=[e("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[e("path",{fill:"currentColor",d:"M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32zm0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32zm448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32zm-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32zM195.2 195.2a32 32 0 0 1 45.248 0L376.32 331.008a32 32 0 0 1-45.248 45.248L195.2 240.448a32 32 0 0 1 0-45.248zm452.544 452.544a32 32 0 0 1 45.248 0L828.8 783.552a32 32 0 0 1-45.248 45.248L647.744 692.992a32 32 0 0 1 0-45.248zM828.8 195.264a32 32 0 0 1 0 45.184L692.992 376.32a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0zm-452.544 452.48a32 32 0 0 1 0 45.248L240.448 828.8a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0z"})],-1)])),_:1})]),c[22]||(c[22]=e("div",{class:"loading-text"},"加载中...",-1))]),_:1})]))]),e("footer",Gr,[o(h).currentBranch?(f(),$("div",Or,[e("div",jr,[c[32]||(c[32]=e("span",{class:"branch-label"},"当前分支:",-1)),t(Ae,{modelValue:o(h).currentBranch,"onUpdate:modelValue":c[4]||(c[4]=J=>o(h).currentBranch=J),size:"small",onChange:ue,loading:o(h).isChangingBranch,class:"branch-select"},{default:a(()=>[(f(!0),$(we,null,Fe(o(h).allBranches,J=>(f(),W(_e,{key:J,label:J,value:J},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),t(H,{type:"primary",size:"small",onClick:oe,class:"create-branch-btn"},{default:a(()=>[t(ee,null,{default:a(()=>[t(o(Aa))]),_:1}),c[31]||(c[31]=_(" 新建分支 "))]),_:1})])])):A("",!0),o(h).remoteUrl?(f(),$("div",Ur,[c[34]||(c[34]=e("span",{class:"repo-url-label"},"远程仓库:",-1)),e("span",Ar,L(o(h).remoteUrl),1),t(H,{type:"primary",circle:"",size:"small",onClick:c[5]||(c[5]=J=>o(h).copyRemoteUrl()),class:"copy-url-btn",title:"复制仓库地址"},{default:a(()=>[t(ee,null,{default:a(()=>c[33]||(c[33]=[e("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[e("path",{fill:"currentColor",d:"M768 832a128 128 0 0 1-128 128H192A128 128 0 0 1 64 832V384a128 128 0 0 1 128-128v64a64 64 0 0 0-64 64v448a64 64 0 0 0 64 64h448a64 64 0 0 0 64-64h64z"}),e("path",{fill:"currentColor",d:"M384 128a64 64 0 0 0-64 64v448a64 64 0 0 0 64 64h448a64 64 0 0 0 64-64V192a64 64 0 0 0-64-64H384zm0-64h448a128 128 0 0 1 128 128v448a128 128 0 0 1-128 128H384a128 128 0 0 1-128-128V192A128 128 0 0 1 384 64z"})],-1)])),_:1})]),_:1})])):A("",!0)]),t(ve,{modelValue:re.value,"onUpdate:modelValue":c[9]||(c[9]=J=>re.value=J),title:"Git用户设置",width:"30%","destroy-on-close":""},{footer:a(()=>[e("span",Er,[t(H,{type:"danger",onClick:D},{default:a(()=>c[36]||(c[36]=[_(" 清除配置 ")])),_:1}),t(H,{onClick:c[8]||(c[8]=J=>re.value=!1)},{default:a(()=>c[37]||(c[37]=[_("取消")])),_:1}),t(H,{type:"primary",onClick:q},{default:a(()=>c[38]||(c[38]=[_(" 保存 ")])),_:1})])]),default:a(()=>[t(ce,null,{default:a(()=>[t(me,{label:"用户名"},{default:a(()=>[t(Le,{modelValue:C.value,"onUpdate:modelValue":c[6]||(c[6]=J=>C.value=J),placeholder:"请输入Git用户名"},null,8,["modelValue"])]),_:1}),t(me,{label:"邮箱"},{default:a(()=>[t(Le,{modelValue:B.value,"onUpdate:modelValue":c[7]||(c[7]=J=>B.value=J),placeholder:"请输入Git邮箱"},null,8,["modelValue"])]),_:1}),t(me,null,{default:a(()=>[t(He,{type:"info",closable:!1,"show-icon":""},{default:a(()=>c[35]||(c[35]=[_(" 这些设置将影响全局Git配置，对所有Git仓库生效。 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ve,{modelValue:se.value,"onUpdate:modelValue":c[13]||(c[13]=J=>se.value=J),title:"切换工作目录",width:"50%","destroy-on-close":""},{footer:a(()=>[e("span",Nr,[t(H,{onClick:c[11]||(c[11]=J=>se.value=!1)},{default:a(()=>c[40]||(c[40]=[_("取消")])),_:1}),t(H,{type:"primary",onClick:c[12]||(c[12]=J=>ze()),loading:je.value},{default:a(()=>c[41]||(c[41]=[_(" 切换 ")])),_:1},8,["loading"])])]),default:a(()=>[t(ce,null,{default:a(()=>[t(me,{label:"目录路径"},{default:a(()=>[e("div",Mr,[t(Le,{modelValue:ke.value,"onUpdate:modelValue":c[10]||(c[10]=J=>ke.value=J),placeholder:"请输入目录路径"},null,8,["modelValue"]),t(H,{type:"primary",onClick:Ze},{default:a(()=>[t(ee,null,{default:a(()=>[t(o(bs))]),_:1}),c[39]||(c[39]=_(" 浏览 "))]),_:1})])]),_:1}),Re.value.length>0?(f(),W(me,{key:0,label:"常用目录"},{default:a(()=>[e("div",Pr,[(f(!0),$(we,null,Fe(Re.value,(J,Ge)=>(f(),W(Je,{key:Ge,class:"recent-dir-tag",onClick:ot=>ke.value=J,effect:"plain"},{default:a(()=>[_(L(J),1)]),_:2},1032,["onClick"]))),128))])]),_:1})):A("",!0)]),_:1})]),_:1},8,["modelValue"])],64)}}}),Hr=mt(Ir,[["__scopeId","data-v-a5d01110"]]),Os=Ea(Hr);Os.use(Ma());Os.mount("#app");
