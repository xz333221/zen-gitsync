import{d as _s,r as d,c as K,E as n,o as pt,a as ws,l as co,b as Be,w as Ge,e as w,f as c,n as bt,g as I,h as e,t as G,i as t,u as a,j as uo,k as s,m as N,p as zt,F as $e,q as Re,s as pe,v as je,x as ke,y as fo,z as Ze,A as Wt,B as Pt,C as po,D as ut,G as A,H as bs,I as st,J as yt,K as _t,L as Lt,M as ks,N as ls,O as ns,P as $s,Q as ft,R as os,S as gt,T as mo,U as is,V as Dt,W as Cs,X as as,Y as Ye,Z as Ss,_ as jt,$ as wt,a0 as Ts,a1 as Ot,a2 as Vs,a3 as xs,a4 as vo,a5 as dt,a6 as ht,a7 as go,a8 as ho,a9 as Fs,aa as yo,ab as gs,ac as Ls,ad as _o,ae as Ht,af as Jt,ag as Bt,ah as wo,ai as bo,aj as ko,ak as Bs,al as zs,am as Ps,an as $o,ao as Co,ap as So,aq as js,ar as ct,as as To,at as Vo,au as xo,av as Fo,aw as Lo,ax as Bo,ay as zo,az as Po,aA as jo,aB as Ut,aC as Do,aD as Oo,aE as Ds,aF as Mo,aG as Et,aH as hs,aI as ys,aJ as Ro,aK as Go,aL as Ie,aM as Ao,aN as Uo}from"./vendor-CNeIgA7v.js";(function(){const b=document.createElement("link").relList;if(b&&b.supports&&b.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))i(v);new MutationObserver(v=>{for(const u of v)if(u.type==="childList")for(const j of u.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&i(j)}).observe(document,{childList:!0,subtree:!0});function o(v){const u={};return v.integrity&&(u.integrity=v.integrity),v.referrerPolicy&&(u.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?u.credentials="include":v.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(v){if(v.ep)return;v.ep=!0;const u=o(v);fetch(v.href,u)}})();const rt=_s("config",()=>{const q=d(""),b=d([]),o=d([]),i=d([]),v=d([]),u=d(!1),j=d(!1),_=K(()=>({defaultCommitMessage:q.value,descriptionTemplates:b.value,scopeTemplates:o.value,messageTemplates:i.value,lockedFiles:v.value}));async function R(B=!1){if(!B&&j.value&&!u.value)return console.log("使用缓存的配置信息"),_.value;try{u.value=!0,console.log("加载配置信息...");const S=await(await fetch("/api/config/getConfig")).json();return q.value=S.defaultCommitMessage||"",b.value=S.descriptionTemplates||[],o.value=S.scopeTemplates||[],i.value=S.messageTemplates||[],v.value=S.lockedFiles||[],j.value=!0,console.log("配置信息加载完成"),_.value}catch(M){return console.error("加载配置失败:",M),n.error(`加载配置失败: ${M.message}`),null}finally{u.value=!1}}async function Z(B){try{const S=await(await fetch("/api/config/saveDefaultMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({defaultCommitMessage:B})})).json();return S.success?(q.value=B,n.success("默认提交信息已保存"),!0):(n.error(`保存失败: ${S.error}`),!1)}catch(M){return n.error(`保存失败: ${M.message}`),!1}}async function E(B,M){try{const Q=await(await fetch("/api/config/save-template",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({template:B,type:M})})).json();return Q.success?(M==="description"?b.value.includes(B)||b.value.push(B):M==="scope"?o.value.includes(B)||o.value.push(B):M==="message"&&(i.value.includes(B)||i.value.push(B)),n.success("模板已保存"),!0):(n.error(`保存模板失败: ${Q.error}`),!1)}catch(S){return n.error(`保存模板失败: ${S.message}`),!1}}async function V(B,M){try{const Q=await(await fetch("/api/config/delete-template",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({template:B,type:M})})).json();return Q.success?(M==="description"?b.value=b.value.filter(se=>se!==B):M==="scope"?o.value=o.value.filter(se=>se!==B):M==="message"&&(i.value=i.value.filter(se=>se!==B)),n.success("模板已删除"),!0):(n.error(`删除模板失败: ${Q.error}`),!1)}catch(S){return n.error(`删除模板失败: ${S.message}`),!1}}async function h(B,M,S){try{const se=await(await fetch("/api/config/update-template",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldTemplate:B,newTemplate:M,type:S})})).json();if(se.success){if(S==="description"){const D=b.value.indexOf(B);D!==-1&&(b.value[D]=M)}else if(S==="scope"){const D=o.value.indexOf(B);D!==-1&&(o.value[D]=M)}else if(S==="message"){const D=i.value.indexOf(B);D!==-1&&(i.value[D]=M)}return n.success("模板已更新"),!0}else return n.error(`更新模板失败: ${se.error}`),!1}catch(Q){return n.error(`更新模板失败: ${Q.message}`),!1}}async function U(){try{const M=await(await fetch("/api/locked-files")).json();return M.success?(v.value=M.lockedFiles||[],M.lockedFiles):(n.error(`加载锁定文件列表失败: ${M.error}`),[])}catch(B){return console.error("加载锁定文件列表失败:",B),n.error(`加载锁定文件列表失败: ${B.message}`),[]}}async function k(B){try{const S=await(await fetch("/api/lock-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:B})})).json();return S.success?(await U(),n.success(`文件已锁定: ${B}`),!0):(n.error(`锁定文件失败: ${S.error}`),!1)}catch(M){return console.error("锁定文件失败:",M),n.error(`锁定文件失败: ${M.message}`),!1}}async function J(B){try{const S=await(await fetch("/api/unlock-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:B})})).json();return S.success?(await U(),n.success(`文件已解锁: ${B}`),!0):(n.error(`解锁文件失败: ${S.error}`),!1)}catch(M){return console.error("解锁文件失败:",M),n.error(`解锁文件失败: ${M.message}`),!1}}async function O(B){try{const S=await(await fetch("/api/check-file-lock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:B})})).json();return S.success?S.isLocked:(console.error("检查文件锁定状态失败:",S.error),!1)}catch(M){return console.error("检查文件锁定状态失败:",M),!1}}return{defaultCommitMessage:q,descriptionTemplates:b,scopeTemplates:o,messageTemplates:i,lockedFiles:v,isLoading:u,isLoaded:j,config:_,loadConfig:R,saveDefaultMessage:Z,saveTemplate:E,deleteTemplate:V,updateTemplate:h,loadLockedFiles:U,lockFile:k,unlockFile:J,isFileLocked:O}}),Xt=800;function Eo(){const q=window.location.port||"80";if(q==="5173"||q==="4173"||q==="5544"){const o="3001";return console.log(`开发环境：从环境变量读取后端端口 ${o}`),parseInt(o,10)}const b=parseInt(q,10);return console.log(`生产环境：使用当前页面端口 ${b}`),b}const Io=Eo(),ot=_s("git",()=>{const q=rt(),b=d(""),o=d([]),i=d(""),v=d(""),u=d(!1),j=d(!1),_=d(!1),R=d(0),Z=d(""),E=d(!1),V=d(!1),h=d(!1),U=d(!1),k=d(!1),J=d(0),O=d(0),B=d(!1),M=d(""),S=d(0),Q=d(0),se=d(!0),D=d(null),ve=d(""),te=d(""),y=d([]),P=d({staged:[],unstaged:[],untracked:[]}),H=d([]),ce=d(!1),fe=d(!1),me=d(!1),ge=d(!1),W=d(!1),le=d([]),ue=d(!1),De=d(!1),z=d(!1),F=d(!1);function ie(){b.value="",o.value=[],i.value="",v.value="",u.value=!1,j.value=!1,_.value=!1,R.value=0,J.value=0,O.value=0,B.value=!1,M.value="",S.value=0,Q.value=0,V.value=!1,h.value=!1,U.value=!1,k.value=!1,Z.value="",E.value=!1,y.value=[],P.value={staged:[],unstaged:[],untracked:[]},H.value=[],ce.value=!1,fe.value=!1,me.value=!1,ge.value=!1,W.value=!1}async function ae(f=!1,m=!1){if(!_.value)return;const L=Date.now();if(!f&&!m&&L-S.value<3e4){console.log("使用缓存的分支状态");return}try{console.log("获取分支状态...");let C="/api/branch-status";const re=[];f&&re.push("force=true"),m&&re.push("countOnly=true"),re.length>0&&(C+="?"+re.join("&"));const He=await(await fetch(C)).json();He&&(J.value=He.ahead||0,O.value=He.behind||0,B.value=He.hasUpstream||!1,M.value=He.upstreamBranch||"",S.value=L,console.log(`分支状态更新：领先 ${J.value} 个提交，落后 ${O.value} 个提交，上游分支：${B.value?M.value:"无"}`))}catch(C){console.error("获取分支状态失败:",C),J.value=0,O.value=0,B.value=!1,M.value=""}}async function Ce(){const f=Date.now();if(f-R.value<1e3)return console.log("使用缓存的Git仓库状态:",_.value?"是":"不是"),_.value;try{const L=await(await fetch("/api/current_directory")).json();return _.value=L.isGitRepo===!0,R.value=f,console.log(`当前目录${_.value?"是":"不是"}Git仓库`),_.value}catch(m){return console.error("检查Git仓库状态失败:",m),_.value=!1,R.value=f,!1}}async function Se(f=!1){try{const C=await(await fetch(f?"/api/branch?force=true":"/api/branch")).json();C.branch&&(b.value=C.branch,console.log(`当前分支更新为: ${C.branch}${f?" (强制刷新)":""}`))}catch(m){console.error("获取分支信息失败:",m)}}async function Oe(){if(_.value)try{console.log("获取所有分支...");const m=await(await fetch("/api/branches")).json();m.branches&&Array.isArray(m.branches)&&(o.value=m.branches,Q.value=Date.now(),console.log(`获取到${m.branches.length}个分支`))}catch(f){console.error("获取所有分支信息失败:",f)}}async function we(f){console.log("切换到分支:",f);try{u.value=!0;const L=await(await fetch("/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch:f})})).json();return L.success?(n({message:`已切换到分支: ${f}`,type:"success"}),await Se(!0),await ae(!0),!0):(n({message:`切换分支失败: ${L.error}`,type:"error"}),!1)}catch(m){return n({message:`切换分支失败: ${m.message}`,type:"error"}),!1}finally{u.value=!1}}async function ne(){try{const m=await(await fetch("/api/user-info")).json();m.name&&m.email&&(i.value=m.name,v.value=m.email)}catch(f){console.error("获取用户信息失败:",f)}}async function Le(f,m){if(!f.trim())return n({message:"分支名称不能为空",type:"warning"}),!1;try{j.value=!0;const C=await(await fetch("/api/create-branch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newBranchName:f,baseBranch:m||b.value})})).json();return C.success?(n({message:`已创建并切换到分支: ${f}`,type:"success"}),await Se(!0),await ae(!0),await Oe(),!0):(n({message:`创建分支失败: ${C.error}`,type:"error"}),!1)}catch(L){return n({message:`创建分支失败: ${L.message}`,type:"error"}),!1}finally{j.value=!1}}async function Me(){try{const m=await(await fetch("/api/clear-user-config",{method:"POST"})).json();return m.success?(i.value="",v.value="",n({message:"已清除Git用户配置",type:"success"}),!0):(n({message:`清除配置失败: ${m.error}`,type:"error"}),!1)}catch(f){return n({message:`清除配置失败: ${f.message}`,type:"error"}),!1}}async function et(f,m){try{const C=await(await fetch("/api/restore-user-config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:f,email:m})})).json();return C.success?(i.value=f,v.value=m,n({message:"已恢复Git用户配置",type:"success"}),!0):(n({message:`恢复配置失败: ${C.error}`,type:"error"}),!1)}catch(L){return n({message:`恢复配置失败: ${L.message}`,type:"error"}),!1}}async function lt(){if(!_.value)return n({message:"当前目录不是Git仓库",type:"warning"}),!1;try{h.value=!0;const m=await(await fetch("/api/pull",{method:"POST"})).json();return m.success?(n({message:"拉取成功",type:"success"}),await ae(),!0):(m.needsMerge?n({message:`需要合并更改: ${m.pullOutput||"存在冲突需要手动解决"}`,type:"warning",duration:5e3}):n({message:`拉取失败: ${m.error}`,type:"error"}),!1)}catch(f){return n({message:`拉取失败: ${f.message}`,type:"error"}),!1}finally{h.value=!1}}async function Qe(){if(!_.value)return n({message:"当前目录不是Git仓库",type:"warning"}),!1;try{U.value=!0;const m=await(await fetch("/api/fetch-all",{method:"POST"})).json();return m.success?(n({message:"获取所有远程分支信息成功",type:"success"}),await ae(),!0):(n({message:`获取远程分支信息失败: ${m.error}`,type:"error"}),!1)}catch(f){return n({message:`获取远程分支信息失败: ${f.message}`,type:"error"}),!1}finally{U.value=!1}}async function at(){D.value&&D.value.disconnect();try{const f=`http://localhost:${Io}`;if(console.log("尝试连接Socket.IO服务器:",f),D.value=co(f,{reconnectionDelayMax:1e4,reconnection:!0,reconnectionAttempts:10,reconnectionDelay:1e3,timeout:2e4,autoConnect:!0,forceNew:!0,transports:["websocket","polling"]}),!D.value){console.error("Socket.IO初始化失败: socket为null");return}console.log("Socket.IO客户端已创建，开始注册事件监听器..."),D.value.on("connect",()=>{var m;console.log("✅ Socket.IO连接成功，事件监听器已生效，Socket ID:",(m=D.value)==null?void 0:m.id),se.value&&D.value&&D.value.emit("start_monitoring")}),D.value.on("project_info",m=>{ve.value=m.projectPath,te.value=m.projectRoomId,console.log(`当前项目: ${m.projectPath}`),console.log(`房间ID: ${m.projectRoomId}`)}),D.value.on("project_changed",m=>{console.log(`项目已切换: ${m.oldProjectPath} -> ${m.newProjectPath}`),ve.value=m.newProjectPath,te.value=m.newProjectRoomId,D.value&&D.value.emit("join_room",m.newProjectRoomId),console.log(`已加入新项目房间: ${m.newProjectRoomId}`)}),D.value.on("disconnect",m=>{console.log("与Socket.IO服务器断开连接:",m)}),D.value.on("git_status_update",m=>{if(se.value){if(console.log("✅ 成功监听到 git_status_update 事件:",new Date().toLocaleTimeString()),console.log("git_status_update data ==>",m),console.log("currentProjectPath.value ==>",ve.value),console.log("data.projectPath ==>",m.projectPath),m.projectPath&&ve.value&&m.projectPath!==ve.value){console.log(`忽略不同项目的状态更新: ${m.projectPath}`);return}console.log("正在更新 Git 文件状态..."),m.porcelain!==void 0&&Ae(m.porcelain)}}),D.value.on("monitoring_status",m=>{console.log("文件监控状态:",m.active?"已启动":"已停止")}),D.value.on("connect_error",m=>{console.error("Socket连接错误:",m.message)}),D.value.on("connect_timeout",()=>{console.error("Socket连接超时")}),D.value.on("reconnect",m=>{var L;console.log(`Socket重连成功，尝试次数: ${m}`),se.value&&(console.log("重连后重新发送start_monitoring请求"),(L=D.value)==null||L.emit("start_monitoring"))}),D.value.on("reconnect_attempt",m=>{console.log(`Socket尝试重连，第 ${m} 次尝试`)}),D.value.on("reconnect_error",m=>{console.error("Socket重连错误:",m.message)}),D.value.on("reconnect_failed",()=>{console.error("Socket重连失败，已达到最大重试次数")}),console.log("Socket.IO事件监听器注册完成：connect, project_info, project_changed, git_status_update, monitoring_status"),D.value&&!D.value.connected&&(console.log("Socket未连接，尝试手动连接..."),D.value.connect())}catch(f){console.error("Socket.IO连接初始化失败:",f)}}function nt(){if(console.log("toggleAutoUpdate调用，当前值:",se.value),!D.value){console.error("无法切换自动更新状态: socket连接不存在"),n.error("无法连接到服务器，自动更新可能不会生效"),console.log("尝试重新建立socket连接..."),at(),localStorage.setItem("zen-gitsync-auto-update",se.value.toString());return}try{se.value?(console.log("发送start_monitoring命令..."),D.value.emit("start_monitoring"),n.success("自动更新已启用")):(console.log("发送stop_monitoring命令..."),D.value.emit("stop_monitoring"),n.info("自动更新已禁用")),localStorage.setItem("zen-gitsync-auto-update",se.value.toString()),console.log("已保存自动更新设置到本地存储:",se.value)}catch(f){console.error("切换自动更新状态时出错:",f),n.error(`切换自动更新失败: ${f.message}`)}}function Ae(f){if(f===void 0||f===""){H.value=[];return}const m=f.split(`
`),L=[];for(const C of m){const re=C.match(/^([ MADRCU\?]{2})\s+(.+)$/);if(re){let Pe="";const He=re[1],qe=He.charAt(0),Mt=He.charAt(1);qe==="A"||qe==="M"||qe==="D"||qe==="R"?Pe="added":qe===" "&&Mt==="M"?Pe="modified":qe===" "&&Mt==="D"?Pe="deleted":He==="??"?Pe="untracked":Pe="other",L.push({path:re[2],type:Pe})}}H.value=L}async function We(f=!0){if(!_.value){console.log("当前目录不是Git仓库，跳过加载提交历史");return}try{ce.value=!0,console.log("开始加载提交历史...");const m=new Date().getTime(),C=await(await fetch(`/api/log?page=1&_t=${m}`)).json();C&&C.data&&Array.isArray(C.data)?(y.value=[...C.data],console.log(`提交历史加载完成，共 ${y.value.length} 条记录`)):(console.warn("API返回的提交历史格式不正确:",C),y.value=[])}catch(m){console.error("获取提交历史失败:",m),f&&n({message:`获取提交历史失败: ${m.message}`,type:"error"})}finally{ce.value=!1}}async function T(){if(!_.value){console.log("当前目录不是Git仓库，跳过加载Git状态");return}try{fe.value=!0,await r()}catch(f){console.error("获取Git状态失败:",f),n({message:`获取Git状态失败: ${f.message}`,type:"error"})}finally{fe.value=!1}}async function r(){if(console.log("开始获取Git状态(porcelain格式)..."),!_.value){console.log("当前目录不是Git仓库，跳过加载Git状态");return}try{const m=await(await fetch("/api/status_porcelain")).json();m.status!==void 0?Ae(m.status):H.value=[]}catch(f){console.error("获取Git状态(porcelain)失败:",f),n({message:`获取Git状态(porcelain)失败: ${f.message}`,type:"error"}),H.value=[]}}async function X(){if(!_.value)return n.warning("当前目录不是Git仓库"),!1;try{me.value=!0;const f=H.value.filter(m=>{const L=m.path.replace(/\\/g,"/");return!q.lockedFiles.some(re=>{const Pe=re.replace(/\\/g,"/");return L===Pe})});if(f.length===0)return n({message:"没有需要暂存的文件（所有文件都被锁定）",type:"warning"}),!1;if(f.length===H.value.length){const L=await(await fetch("/api/add",{method:"POST"})).json();return L.success?(n({message:"文件已添加到暂存区",type:"success"}),!0):(n({message:`添加文件失败: ${L.error}`,type:"error"}),!1)}else{const L=await(await fetch("/api/add-filtered",{method:"POST"})).json();if(L.success){const C=H.value.length-f.length;let re=`已添加 ${f.length} 个文件到暂存区`;return C>0&&(re+=`，跳过 ${C} 个锁定文件`),n({message:re,type:"success"}),!0}else return n({message:`添加文件失败: ${L.error}`,type:"error"}),!1}}catch(f){return n({message:`添加文件失败: ${f.message}`,type:"error"}),!1}finally{me.value=!1}}async function de(){if(!_.value)return n.warning("当前目录不是Git仓库"),!1;try{me.value=!0;const m=await(await fetch("/api/add-all",{method:"POST"})).json();return m.success?(n({message:"所有文件已添加到暂存区",type:"success"}),!0):(n({message:`添加文件失败: ${m.error}`,type:"error"}),!1)}catch(f){return n({message:`添加文件失败: ${f.message}`,type:"error"}),!1}finally{me.value=!1}}async function Te(f){if(!_.value)return n.warning("当前目录不是Git仓库"),!1;try{me.value=!0;const L=await(await fetch("/api/add-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:f})})).json();return L.success?(n({message:"文件已暂存",type:"success"}),T(),!0):(n({message:`暂存文件失败: ${L.error}`,type:"error"}),!1)}catch(m){return n({message:`暂存文件失败: ${m.message}`,type:"error"}),!1}finally{me.value=!1}}async function Ne(f){if(!_.value)return n.warning("当前目录不是Git仓库"),!1;try{W.value=!0;const L=await(await fetch("/api/unstage-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:f})})).json();return L.success?(n({message:"已取消暂存文件",type:"success"}),T(),!0):(n({message:`取消暂存失败: ${L.error}`,type:"error"}),!1)}catch(m){return n({message:`取消暂存失败: ${m.message}`,type:"error"}),!1}finally{W.value=!1}}function be(f){return new Promise(m=>setTimeout(m,f))}async function he(f,m=!1){if(!_.value)return n.warning("当前目录不是Git仓库"),!1;try{ge.value=!0;const C=await(await fetch("/api/commit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:f,hasNewlines:f.includes(`
`),noVerify:m})})).json();return C.success?(n({message:"提交成功",type:"success"}),!0):(n({message:`commitChanges 提交失败: ${C.error}`,type:"error"}),!1)}catch(L){return n({message:`提交失败: ${L.message}`,type:"error"}),!1}finally{ge.value=!1}}async function Ue(){if(!_.value)return n.warning("当前目录不是Git仓库"),!1;try{V.value=!0;const m=await(await fetch("/api/push",{method:"POST"})).json();return m.success?(J.value=0,O.value=0,await Promise.all([T(),We()]),console.log("推送成功，分支状态已设置为同步 (ahead=0, behind=0)"),!0):(n({message:`推送失败: ${m.error}`,type:"error"}),!1)}catch(f){return n({message:`推送失败: ${f.message}`,type:"error"}),!1}finally{V.value=!1}}async function Ve(f,m={}){if(!_.value)return n({message:"当前目录不是Git仓库",type:"warning"}),!1;if(!f)return n({message:"请选择要合并的分支",type:"warning"}),!1;if(f===b.value)return n({message:"不能合并当前分支到自身",type:"warning"}),!1;try{k.value=!0;const L=await fetch("/api/merge",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch:f,...m})}),C=await L.json();return L.status===409?(n({message:"合并分支时发生冲突，请手动解决",type:"warning",duration:5e3}),!1):C.success?(n({message:`成功合并分支 ${f} 到 ${b.value}`,type:"success"}),await T(),await ae(),!0):(n({message:`合并分支失败: ${C.error}`,type:"error"}),!1)}catch(L){return n({message:`合并分支失败: ${L.message}`,type:"error"}),!1}finally{k.value=!1}}async function ye(f,m=!1){if(console.log("开始暂存并提交操作..."),!await X())return!1;console.log("暂存完成，等待Git操作完成..."),await be(Xt),console.log("开始提交更改...");const C=await he(f,m);return console.log("暂存并提交操作完成"),C}async function oe(f,m=!1){try{if(console.log("开始暂存文件..."),!await X()||(console.log("暂存完成，等待Git操作完成..."),await be(Xt),console.log("开始提交更改..."),!await he(f,m)))return!1;console.log("提交完成，等待Git操作完成..."),await be(Xt),console.log("开始推送到远程...");const re=await Ue();return console.log("一键推送操作完成，状态已统一刷新"),re}catch(L){console.error("一键推送操作失败:",L);try{(await(await fetch("/api/remove-lock",{method:"POST"})).json()).success&&n({message:"检测到Git锁定文件冲突，已自动清理，请重试操作",type:"warning"})}catch(C){console.error("清理锁定文件失败:",C)}n({message:`操作失败: ${L.message}`,type:"error"});try{await Promise.all([T(),We(),ae()])}catch(C){console.error("刷新状态失败:",C)}return!1}}async function Je(){if(!_.value)return n.warning("当前目录不是Git仓库"),!1;try{W.value=!0;const m=await(await fetch("/api/reset-head",{method:"POST"})).json();return m.success?(n({message:"已重置暂存区",type:"success"}),T(),!0):(n({message:`重置暂存区失败: ${m.error}`,type:"error"}),!1)}catch(f){return n({message:`重置暂存区失败: ${f.message}`,type:"error"}),!1}finally{W.value=!1}}async function mt(f){if(!_.value)return n.warning("当前目录不是Git仓库"),!1;try{W.value=!0;const L=await(await fetch("/api/reset-to-remote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({branch:f})})).json();return L.success?(n({message:`已重置分支 ${f} 到远程状态`,type:"success"}),T(),We(),!0):(n({message:`重置分支失败: ${L.error}`,type:"error"}),!1)}catch(m){return n({message:`重置分支失败: ${m.message}`,type:"error"}),!1}finally{W.value=!1}}async function kt(){if(_.value)try{E.value=!0,console.log("获取远程仓库地址...");const m=await(await fetch("/api/remote-url")).json();m.success?(Z.value=m.url||"",console.log(`获取到远程仓库地址: ${Z.value}`)):(console.warn("获取远程仓库地址失败:",m.error),Z.value="")}catch(f){console.error("获取远程仓库地址失败:",f),Z.value=""}finally{E.value=!1}}async function $t(){if(!Z.value)return n({message:"没有可复制的远程仓库地址",type:"warning"}),!1;try{return await navigator.clipboard.writeText(Z.value),n({message:"已复制远程仓库地址",type:"success"}),!0}catch(f){return console.error("复制远程仓库地址失败:",f),n({message:`复制失败: ${f.message}`,type:"error"}),!1}}pt(()=>{const f=localStorage.getItem("zen-gitsync-auto-update");f!==null&&(se.value=f==="true"),at()});function it(){D.value&&(D.value.disconnect(),D.value=null)}ws(()=>{it()});async function Ee(){if(!_.value)return n.warning("当前目录不是Git仓库"),[];try{ue.value=!0;const m=await(await fetch("/api/stash-list")).json();return m.success?(le.value=m.stashes,m.stashes):(n.error(`获取stash列表失败: ${m.error}`),[])}catch(f){return console.error("获取stash列表失败:",f),n.error(`获取stash列表失败: ${f.message}`),[]}finally{ue.value=!1}}async function Ct(f,m=!1,L=!0){if(!_.value)return n.warning("当前目录不是Git仓库"),!1;try{F.value=!0;const re=await(await fetch("/api/stash-save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:f,includeUntracked:m,excludeLocked:L})})).json();return re.success?(n.success(re.message),await Ee(),await T(),!0):(n.warning(re.message),!1)}catch(C){return console.error("保存stash失败:",C),n.error(`保存stash失败: ${C.message}`),!1}finally{F.value=!1}}async function $(f,m=!1){if(!_.value)return n.warning("当前目录不是Git仓库"),!1;try{De.value=!0;const L=await fetch("/api/stash-apply",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({stashId:f,pop:m})}),C=await L.json();return L.status===409?(n.warning("应用stash时发生冲突，请手动解决"),!1):C.success?(n.success(C.message),await Ee(),await T(),!0):(n.error(`应用stash失败: ${C.error}`),!1)}catch(L){return console.error("应用stash失败:",L),n.error(`应用stash失败: ${L.message}`),!1}finally{De.value=!1}}async function g(f){if(!_.value)return n.warning("当前目录不是Git仓库"),!1;try{z.value=!0;const L=await(await fetch("/api/stash-drop",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({stashId:f})})).json();return L.success?(n.success(L.message),await Ee(),!0):(n.error(`删除stash失败: ${L.error}`),!1)}catch(m){return console.error("删除stash失败:",m),n.error(`删除stash失败: ${m.message}`),!1}finally{z.value=!1}}async function ee(){if(!_.value)return n.warning("当前目录不是Git仓库"),!1;try{z.value=!0;const m=await(await fetch("/api/stash-clear",{method:"POST"})).json();return m.success?(n.success(m.message),le.value=[],!0):(n.error(`清空stash失败: ${m.error}`),!1)}catch(f){return console.error("清空stash失败:",f),n.error(`清空stash失败: ${f.message}`),!1}finally{z.value=!1}}return{currentBranch:b,allBranches:o,userName:i,userEmail:v,isChangingBranch:u,isCreatingBranch:j,isGitRepo:_,lastCheckedTime:R,branchAhead:J,branchBehind:O,hasUpstream:B,upstreamBranch:M,lastBranchStatusTime:S,lastBranchesTime:Q,remoteUrl:Z,isLoadingRemoteUrl:E,stashes:le,isLoadingStashes:ue,isApplyingStash:De,isDroppingStash:z,isSavingStash:F,log:y,status:P,fileList:H,isLoadingLog:ce,isLoadingStatus:fe,isAddingFiles:me,isCommiting:ge,isResetting:W,autoUpdateEnabled:se,isPushing:V,isGitPulling:h,isGitFetching:U,isGitMerging:k,$reset:ie,checkGitRepo:Ce,getCurrentBranch:Se,getAllBranches:Oe,changeBranch:we,getUserInfo:ne,createBranch:Le,clearUserConfig:Me,restoreUserConfig:et,getBranchStatus:ae,gitPull:lt,gitFetchAll:Qe,initSocketConnection:at,toggleAutoUpdate:nt,parseStatusPorcelain:Ae,fetchLog:We,fetchStatus:T,fetchStatusPorcelain:r,addToStage:X,addAllToStage:de,addFileToStage:Te,unstageFile:Ne,commitChanges:he,pushToRemote:Ue,addAndCommit:ye,addCommitAndPush:oe,resetHead:Je,resetToRemote:mt,getRemoteUrl:kt,copyRemoteUrl:$t,mergeBranch:Ve,getStashList:Ee,saveStash:Ct,applyStash:$,dropStash:g,clearAllStashes:ee,socket:D,disconnectSocket:it}});function No(q){return q.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function Ho(q){return q?q.split(`
`).map(o=>{const i=No(o);return o.startsWith("diff --git")||o.startsWith("diff --cc")||o.startsWith("diff --combined")?`<div class="diff-header">${i}</div>`:o.startsWith("---")?`<div class="diff-old-file">${i}</div>`:o.startsWith("+++")?`<div class="diff-new-file">${i}</div>`:o.startsWith("@@")?`<div class="diff-hunk-header">${i}</div>`:o.startsWith("+")?`<div class="diff-added">${i}</div>`:o.startsWith("-")?`<div class="diff-removed">${i}</div>`:`<div class="diff-context">${i}</div>`}).join(""):""}function Jo(q){return q?q.trim():"(无提交信息)"}function Wo(q){if(!q)return"";const b=/^(feat|fix|docs|style|refactor|perf|test|chore|build|ci|revert)(\([^)]+\))?\s*:\s*(.+)$/s,o=q.match(b);return o?o[3].trim():q.trim()}const qo="/assets/vscode-twqwGmNt.webp",Ko={key:0,class:"files-panel"},Yo={class:"panel-header"},Qo={key:0,class:"file-count"},Xo={class:"files-list"},Zo=["onClick"],ea={class:"file-name"},ta={class:"panel-header"},sa={class:"header-right"},oa={class:"selected-file"},aa={class:"path-dir"},la={class:"path-name"},na={key:1,class:"action-buttons"},ia=["src"],ra={class:"diff-content"},ca=["innerHTML"],ua=Be({__name:"FileDiffViewer",props:{files:{},emptyText:{default:"没有找到变更文件"},diffContent:{default:""},selectedFile:{default:""},height:{default:"100%"},showFileList:{type:Boolean,default:!0},context:{default:"git-status"},showOpenButton:{type:Boolean,default:!0}},emits:["file-select","open-file","open-with-vscode"],setup(q,{emit:b}){const o=q,i=b,v=d(""),u=K(()=>o.selectedFile||v.value),j=K(()=>o.files.map(k=>({...k,displayName:k.name||k.path.split("/").pop()||k.path}))),_=K(()=>o.diffContent&&o.diffContent.trim()!==""),R=K(()=>{if(!u.value)return"";const k=u.value.split("/");return k.slice(0,-1).join("/")+(k.length>1?"/":"")}),Z=K(()=>{if(!u.value)return"";const k=u.value.split("/");return k[k.length-1]||u.value});function E(k){v.value=k,i("file-select",k)}function V(){if(!u.value){n.warning("请先选择一个文件");return}i("open-file",u.value,o.context)}function h(){if(!u.value){n.warning("请先选择一个文件");return}i("open-with-vscode",u.value,o.context)}const U=K(()=>{switch(o.context){case"git-status":return"在系统默认编辑器中打开文件";case"commit-detail":return"打开该提交时的文件版本";case"stash-detail":return"打开该stash中的文件版本";default:return"打开文件"}});return Ge(()=>o.selectedFile,k=>{k!==void 0&&(v.value=k)}),Ge(()=>o.files,k=>{if(k.length>0&&!u.value){const J=k[0];E(J.path)}},{immediate:!0}),(k,J)=>(c(),w("div",{class:"file-diff-viewer",style:bt({height:k.height})},[k.showFileList?(c(),w("div",Ko,[e("div",Yo,[J[0]||(J[0]=e("h4",null,"变更文件",-1)),k.files.length>0?(c(),w("span",Qo,"("+G(k.files.length)+")",1)):I("",!0)]),e("div",Xo,[t(a(uo),{height:"100%"},{default:s(()=>[k.files.length===0?(c(),N(a(zt),{key:0,description:k.emptyText,"image-size":60},null,8,["description"])):I("",!0),(c(!0),w($e,null,Re(j.value,O=>(c(),w("div",{key:O.path,class:pe(["file-item",{active:O.path===u.value,[`file-type-${O.type}`]:O.type,"is-locked":O.locked}]),onClick:B=>E(O.path)},[t(a(Ze),{class:"file-icon"},{default:s(()=>[t(a(Wt))]),_:1}),t(a(je),{content:O.path,placement:"top",disabled:O.displayName.length<=35,"hide-after":1e3,"show-after":200},{default:s(()=>[e("span",ea,G(O.displayName),1)]),_:2},1032,["content","disabled"]),O.locked?(c(),N(a(je),{key:0,content:"该文件已被锁定，提交时会被跳过",placement:"top","hide-after":1e3,"show-after":200},{default:s(()=>[t(a(Ze),{class:"lock-icon",color:"#E6A23C"},{default:s(()=>[t(a(Pt))]),_:1})]),_:1})):I("",!0)],10,Zo))),128))]),_:1})])])):I("",!0),e("div",{class:pe(["diff-panel",{"full-width":!k.showFileList}])},[e("div",ta,[J[1]||(J[1]=e("h4",null,"文件差异",-1)),e("div",sa,[u.value?(c(),N(a(je),{key:0,content:u.value,placement:"top",effect:"light","hide-after":1e3,"show-after":200},{default:s(()=>[e("span",oa,[e("span",aa,G(R.value),1),e("span",la,G(Z.value),1)])]),_:1},8,["content"])):I("",!0),k.showOpenButton&&u.value?(c(),w("div",na,[t(a(je),{content:U.value,placement:"top",effect:"light"},{default:s(()=>[t(a(ke),{type:"primary",size:"small",icon:a(fo),onClick:V,class:"open-file-btn"},null,8,["icon"])]),_:1},8,["content"]),t(a(je),{content:"用VSCode打开文件",placement:"top",effect:"light"},{default:s(()=>[t(a(ke),{type:"success",size:"small",onClick:h,class:"vscode-btn"},{default:s(()=>[e("img",{src:a(qo),alt:"VSCode",class:"vscode-icon"},null,8,ia)]),_:1})]),_:1})])):I("",!0)])]),e("div",ra,[_.value?(c(),w("div",{key:1,class:"diff-text",innerHTML:a(Ho)(k.diffContent)},null,8,ca)):(c(),N(a(zt),{key:0,description:u.value?"该文件没有差异内容":"请选择文件查看差异","image-size":80},null,8,["description"]))])],2)],4))}}),ze=(q,b)=>{const o=q.__vccOpts||q;for(const[i,v]of b)o[i]=v;return o},rs=ze(ua,[["__scopeId","data-v-454a45f7"]]),da={class:"common-dialog__footer"},fa=Be({__name:"CommonDialog",props:{modelValue:{type:Boolean},title:{},size:{default:"medium"},type:{default:"default"},width:{},height:{},top:{default:"50px"},closeOnClickModal:{type:Boolean,default:!1},closeOnPressEscape:{type:Boolean,default:!0},destroyOnClose:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},customClass:{},appendToBody:{type:Boolean,default:!1},lockScroll:{type:Boolean,default:!0},heightMode:{default:"max"},heightOffset:{default:"100px"},showFooter:{type:Boolean,default:!1},confirmText:{default:"确定"},cancelText:{default:"取消"},showCancel:{type:Boolean,default:!0},confirmLoading:{type:Boolean,default:!1}},emits:["update:modelValue","confirm","cancel","close","opened","closed"],setup(q,{emit:b}){const o=q,i=b,v=K(()=>{if(o.width)return o.width;switch(o.size){case"small":return"30%";case"medium":return"50%";case"large":return"80%";case"extra-large":return"90%";default:return"50%"}}),u=K(()=>{const h=[];return o.customClass&&h.push(o.customClass),o.type==="flex"&&h.push("common-dialog--flex"),o.type==="full-height"&&h.push("common-dialog--full-height"),h.join(" ")}),j=K(()=>{const h=`calc(100% - ${o.heightOffset})`;return o.heightMode==="fixed"?{height:h}:{maxHeight:h}});function _(){i("update:modelValue",!1),i("close")}function R(){i("confirm")}function Z(){i("cancel"),_()}function E(){i("opened")}function V(){i("closed")}return(h,U)=>{const k=ke;return c(),N(a(bs),{"model-value":h.modelValue,title:h.title,width:v.value,top:h.top,style:bt(j.value),"close-on-click-modal":h.closeOnClickModal,"close-on-press-escape":h.closeOnPressEscape,"destroy-on-close":h.destroyOnClose,draggable:h.draggable,class:pe(u.value),"append-to-body":h.appendToBody,"lock-scroll":h.lockScroll,onClose:_,onOpened:E,onClosed:V},po({default:s(()=>[ut(h.$slots,"default",{},void 0,!0)]),_:2},[h.showFooter||h.$slots.footer?{name:"footer",fn:s(()=>[ut(h.$slots,"footer",{},()=>[e("div",da,[h.showCancel?(c(),N(k,{key:0,onClick:Z},{default:s(()=>[A(G(h.cancelText),1)]),_:1})):I("",!0),t(k,{type:"primary",loading:h.confirmLoading,onClick:R},{default:s(()=>[A(G(h.confirmText),1)]),_:1},8,["loading"])])],!0)]),key:"0"}:void 0]),1032,["model-value","title","width","top","style","close-on-click-modal","close-on-press-escape","destroy-on-close","draggable","class","append-to-body","lock-scroll"])}}}),Ke=ze(fa,[["__scopeId","data-v-0f9dd475"]]),pa={key:0,class:"file-group"},ma={class:"file-list"},va=["onClick"],ga={class:"file-info"},ha={class:"file-name-section"},ya=["title"],_a={class:"file-directory"},wa={class:"file-actions"},ba={key:1,style:{"font-size":"16px","font-weight":"bold"}},ka=Be({__name:"FileGroup",props:{files:{},title:{},groupKey:{},collapsedGroups:{},isFileLocked:{type:Function},isLocking:{type:Function},getFileName:{type:Function},getFileDirectory:{type:Function}},emits:["toggleCollapse","fileClick","toggleFileLock","stageFile","unstageFile","revertFileChanges"],setup(q,{emit:b}){const o=q,i=b,v=K(()=>o.files.length>0),u=K(()=>o.collapsedGroups[o.groupKey]);function j(){i("toggleCollapse",o.groupKey)}function _(k){i("fileClick",k)}function R(k,J){J.stopPropagation(),i("toggleFileLock",k)}function Z(k,J){J.stopPropagation(),i("stageFile",k)}function E(k,J){J.stopPropagation(),i("unstageFile",k)}function V(k,J){J.stopPropagation(),i("revertFileChanges",k)}function h(k){switch(k){case"added":return[{type:"unstage",tooltip:"取消暂存",buttonType:"warning",icon:"-",handler:E}];case"modified":case"deleted":return[{type:"stage",tooltip:"添加到暂存区",buttonType:"success",icon:"+",handler:Z},{type:"revert",tooltip:"撤回修改",buttonType:"danger",icon:ns,handler:V}];case"untracked":return[{type:"stage",tooltip:"添加到暂存区",buttonType:"success",icon:"+",handler:Z},{type:"delete",tooltip:"删除文件",buttonType:"danger",icon:ls,handler:V}];default:return[]}}function U(k){switch(k){case"added":return"A";case"modified":return"M";case"deleted":return"D";case"untracked":return"U";default:return""}}return(k,J)=>{const O=Ze,B=je,M=ke;return v.value?(c(),w("div",pa,[e("div",{class:"file-group-header",onClick:j},[t(O,{class:pe(["collapse-icon",{collapsed:u.value}])},{default:s(()=>[t(a(yt))]),_:1},8,["class"]),e("span",null,G(k.title),1)]),st(e("div",ma,[(c(!0),w($e,null,Re(k.files,S=>(c(),w("div",{key:S.path,class:pe(["file-item",{"is-loading":o.isLocking(S.path)}]),onClick:Q=>_(S)},[e("div",ga,[e("div",{class:pe(["file-status-indicator",[S.type,{locked:o.isFileLocked(S.path)}]])},G(U(S.type)),3),e("div",ha,[t(B,{content:o.getFileName(S.path),placement:"top",disabled:o.getFileName(S.path).length<=25,"hide-after":1e3,"show-after":200},{default:s(()=>[e("span",{class:pe(["file-name",{"locked-file-name":o.isFileLocked(S.path),"deleted-file-name":S.type==="deleted"}])},[A(G(o.getFileName(S.path))+" ",1),o.isFileLocked(S.path)?(c(),N(O,{key:0,class:"lock-indicator"},{default:s(()=>[t(a(Pt))]),_:1})):I("",!0)],2)]),_:2},1032,["content","disabled"])]),e("div",{class:"file-path-section",title:o.getFileDirectory(S.path)},[t(B,{content:o.getFileDirectory(S.path),placement:"top",disabled:o.getFileDirectory(S.path).length<=30,"hide-after":1e3,"show-after":200},{default:s(()=>[e("span",_a,G(o.getFileDirectory(S.path)),1)]),_:2},1032,["content","disabled"])],8,ya)]),e("div",wa,[t(B,{content:o.isLocking(S.path)?"处理中...":o.isFileLocked(S.path)?"解锁文件":"锁定文件",placement:"top","hide-after":1e3,"show-after":200},{default:s(()=>[t(M,{type:o.isFileLocked(S.path)?"danger":"info",size:"small",text:"",loading:o.isLocking(S.path),disabled:o.isLocking(S.path),onClick:Q=>R(S.path,Q),class:"file-action-btn"},{default:s(()=>[o.isLocking(S.path)?I("",!0):(c(),N(O,{key:0,size:"16"},{default:s(()=>[(c(),N(Lt(o.isFileLocked(S.path)?a(Pt):a(ks))))]),_:2},1024))]),_:2},1032,["type","loading","disabled","onClick"])]),_:2},1032,["content"]),o.isFileLocked(S.path)?I("",!0):(c(!0),w($e,{key:0},Re(h(S.type),Q=>(c(),N(B,{key:Q.type,content:Q.tooltip,placement:"top","hide-after":1e3,"show-after":200},{default:s(()=>[t(M,{type:Q.buttonType,size:"small",text:"",onClick:se=>Q.handler(S.path,se),class:"file-action-btn"},{default:s(()=>[typeof Q.icon!="string"?(c(),N(O,{key:0,size:"16"},{default:s(()=>[(c(),N(Lt(Q.icon)))]),_:2},1024)):(c(),w("span",ba,G(Q.icon),1))]),_:2},1032,["type","onClick"])]),_:2},1032,["content"]))),128))])],10,va))),128))],512),[[_t,!u.value]])])):I("",!0)}}}),Zt=ze(ka,[["__scopeId","data-v-c1bab876"]]),$a={class:"card git-status-card flex flex-col"},Ca={class:"status-header"},Sa={class:"header-actions"},Ta=["element-loading-text"],Va={key:0,class:"status-box"},xa={key:1,class:"status-box-wrap"},Fa={key:0,class:"branch-status-info"},La={class:"branch-sync-status"},Ba={class:"sync-status-content"},za={class:"status-badges"},Pa={class:"badge-content"},ja={class:"badge-content"},Da={key:1,class:"file-list-container"},Oa={key:2,class:"empty-status"},Ma={class:"empty-icon"},Ra={class:"lock-feature-description"},Ga={class:"description-header"},Aa={key:0,class:"empty-locked-files"},Ua={class:"empty-icon"},Ea={key:1,class:"locked-files-list"},Ia={class:"locked-files-header"},Na={class:"locked-file-items"},Ha={class:"file-info"},Ja={class:"file-path-container"},Wa={class:"file-name"},qa={class:"file-directory"},Ka={class:"file-actions"},Ya=Be({__name:"GitStatus",props:{initialDirectory:{type:String,default:""}},setup(q,{expose:b}){const o=q,i=ot(),v=rt(),u=K(()=>i.isLoadingStatus),j=d(""),_=d(""),R=d(!1),Z=d(!1),E=d(-1),V=d({});function h(z){return!!V.value[z]}const U=K(()=>i.fileList.map(z=>({path:z.path,name:z.path.split("/").pop()||z.path,type:z.type,locked:le(z.path)})));async function k(z){await ve(z)}async function J(z,F){try{const ae=await(await fetch("/api/open-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:z,context:F})})).json();ae.success?n.success(ae.message):n.error(ae.error||"打开文件失败")}catch(ie){n.error(`打开文件失败: ${ie.message}`)}}async function O(z,F){try{const ae=await(await fetch("/api/open-with-vscode",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:z,context:F})})).json();ae.success?n.success(ae.message):n.error(ae.error||"用VSCode打开文件失败")}catch(ie){n.error(`用VSCode打开文件失败: ${ie.message}`)}}const B=d(!1),M=d({staged:!1,unstaged:!1,untracked:!1}),S=d(o.initialDirectory||"");async function Q(){try{if(!S.value){const F=await(await fetch("/api/current_directory")).json();S.value=F.directory||"未知目录"}if(!i.isGitRepo)return;await i.fetchStatus(),await i.getBranchStatus(),n({message:"Git 状态已刷新",type:"success"})}catch(z){n({message:"刷新失败: "+z.message,type:"error"})}}async function se(z){try{await Ye.confirm(`确认解锁该文件？
${z}`,"确认解锁",{type:"warning",confirmButtonText:"解锁",cancelButtonText:"取消"}),await v.unlockFile(z)}catch{}}async function D(){if(v.lockedFiles.length)try{await Ye.confirm(`确认解锁所有已锁定文件？共 ${v.lockedFiles.length} 个。`,"清空全部锁定",{type:"warning",confirmButtonText:"全部解锁",cancelButtonText:"取消"});const z=[...v.lockedFiles];await Promise.all(z.map(F=>v.unlockFile(F))),await v.loadLockedFiles(),n.success("已清空所有文件锁定")}catch{}}async function ve(z){try{Z.value=!0,j.value=z,E.value=i.fileList.findIndex(ie=>ie.path===z);const F=i.fileList[E.value];if(F&&F.type==="untracked")try{const ae=await(await fetch(`/api/file-content?file=${encodeURIComponent(z)}`)).json();ae.success&&ae.content?_.value=`diff --git a/${z} b/${z}
新文件: ${z}
--- /dev/null
+++ b/${z}
@@ -0,0 +1,${ae.content.split(`
`).length} @@
`+ae.content.split(`
`).map(Ce=>`+${Ce}`).join(`
`):_.value=`这是一个新文件，尚未被Git跟踪。
添加到暂存区后可以提交该文件。`}catch(ie){console.error("获取未跟踪文件内容失败:",ie),_.value=`这是一个新文件，尚未被Git跟踪。
添加到暂存区后可以提交该文件。`}else if(F&&F.type==="added"){const ae=await(await fetch(`/api/diff-cached?file=${encodeURIComponent(z)}`)).json();_.value=ae.diff||"没有变更"}else{const ae=await(await fetch(`/api/diff?file=${encodeURIComponent(z)}`)).json();_.value=ae.diff||"没有变更"}}catch(F){n({message:"获取文件差异失败: "+F.message,type:"error"}),_.value="获取差异失败: "+F.message}finally{Z.value=!1}}function te(z){if(R.value=!0,i.fileList.length>0){const F=i.fileList.find(ie=>ie.path===z.path)||i.fileList[0];ve(F.path)}}async function y(z){await i.addFileToStage(z)}async function P(z){await i.unstageFile(z)}async function H(){try{if(!i.isGitRepo)return;await i.fetchStatus(),await i.getBranchStatus(!0),n.success("Git 状态已刷新")}catch(z){n.error("刷新失败: "+z.message)}}async function ce(){try{await i.gitPull(),await Q()}catch(z){console.error("拉取操作发生错误:",z)}}async function fe(){try{await i.gitFetchAll(),await Q()}catch(z){console.error("获取远程分支信息操作发生错误:",z)}}async function me(z){try{await Ye.confirm(`确定要撤回文件 "${z}" 的所有修改吗？此操作无法撤销。`,"撤回修改",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const ie=await(await fetch("/api/revert_file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:z})})).json();ie.success?(n.success("已撤回文件修改"),await Q()):n.error(ie.error?`撤回失败: ${ie.error}`:"撤回文件修改失败，请重试")}catch(F){if(F==="cancel"||F.message==="cancel")return;const ie=F.message||"未知错误";ie!=="undefined"?n.error(`撤回文件修改失败: ${ie}`):n.error("撤回文件修改失败，请重试")}}function ge(z){const F=z.split("/");return F[F.length-1]}function W(z){const F=z.split("/");return F.length<=1?"":F.slice(0,-1).join("/")}function le(z){const F=z.replace(/\\/g,"/");return v.lockedFiles.some(ae=>{const Ce=ae.replace(/\\/g,"/");return F===Ce})}async function ue(z){if(!V.value[z]){V.value[z]=!0;try{le(z)?await v.unlockFile(z):await v.lockFile(z)}finally{delete V.value[z]}}}function De(z){M.value[z]=!M.value[z]}return pt(()=>{Q(),v.loadConfig(),v.loadLockedFiles()}),Ge(()=>i.autoUpdateEnabled,(z,F)=>{console.log(`自动更新状态变更: ${F} -> ${z}`),i.toggleAutoUpdate()},{immediate:!1}),b({refreshStatus:H}),(z,F)=>{const ie=$s,ae=je,Ce=ke,Se=Ze,Oe=Dt,we=is;return c(),w($e,null,[e("div",$a,[e("div",Ca,[F[4]||(F[4]=e("h2",null,"Git 状态",-1)),e("div",Sa,[t(ae,{content:a(i).autoUpdateEnabled?"禁用自动更新文件状态":"启用自动更新文件状态",placement:"top","hide-after":1e3,"show-after":200},{default:s(()=>[t(ie,{modelValue:a(i).autoUpdateEnabled,"onUpdate:modelValue":F[0]||(F[0]=ne=>a(i).autoUpdateEnabled=ne),style:{"--el-switch-on-color":"#67C23A","--el-switch-off-color":"#909399","margin-right":"8px"},"inline-prompt":"","active-icon":a(ft),"inactive-icon":a(ls),class:"auto-update-switch"},null,8,["modelValue","active-icon","inactive-icon"])]),_:1},8,["content"]),t(ae,{content:"Git Pull (拉取远程更新)",placement:"top","hide-after":1e3,"show-after":200},{default:s(()=>[t(Ce,{type:"primary",icon:a(os),circle:"",size:"small",onClick:ce,loading:a(i).isGitPulling,disabled:!a(i).hasUpstream},null,8,["icon","loading","disabled"])]),_:1}),t(ae,{content:"Git Fetch All (获取所有远程分支)",placement:"top","hide-after":1e3,"show-after":200},{default:s(()=>[st(t(Ce,{type:"primary",icon:a(gt),circle:"",size:"small",onClick:fe,loading:a(i).isGitFetching},null,8,["icon","loading"]),[[_t,!1]])]),_:1}),a(v).lockedFiles.length>0?(c(),N(ae,{key:0,content:"管理锁定文件",placement:"top","hide-after":1e3,"show-after":200},{default:s(()=>[t(Ce,{type:"warning",circle:"",size:"small",onClick:F[1]||(F[1]=ne=>B.value=!0)},{default:s(()=>[t(Se,null,{default:s(()=>[t(a(Pt))]),_:1})]),_:1})]),_:1})):I("",!0),t(ae,{content:"刷新状态",placement:"top","hide-after":1e3,"show-after":200},{default:s(()=>[t(Ce,{type:"primary",icon:a(mo),circle:"",size:"small",onClick:H,loading:u.value},null,8,["icon","loading"])]),_:1})])]),st((c(),w("div",{class:"card-content","element-loading-text":a(i).isGitPulling?"正在拉取代码...":"正在获取远程分支信息..."},[a(i).isGitRepo?(c(),w("div",xa,[a(i).hasUpstream&&(a(i).branchAhead>0||a(i).branchBehind>0)?(c(),w("div",Fa,[e("div",La,[e("div",Ba,[t(ae,{content:"本地分支与远程分支的状态对比",placement:"top","show-after":200},{default:s(()=>[e("div",za,[a(i).branchAhead>0?(c(),N(Oe,{key:0,size:"small",type:"warning",class:"status-badge"},{default:s(()=>[e("span",Pa,[t(Se,null,{default:s(()=>[t(a(Cs))]),_:1}),A(" 你的分支领先 'origin/"+G(a(i).currentBranch)+"' "+G(a(i).branchAhead)+" 个提交 ",1)])]),_:1})):I("",!0),a(i).branchBehind>0?(c(),N(Oe,{key:1,size:"small",type:"info",class:"status-badge"},{default:s(()=>[e("span",ja,[t(Se,null,{default:s(()=>[t(a(yt))]),_:1}),A(" 你的分支落后 'origin/"+G(a(i).currentBranch)+"' "+G(a(i).branchBehind)+" 个提交 ",1)])]),_:1})):I("",!0)])]),_:1})])])])):I("",!0),a(i).fileList.length?(c(),w("div",Da,[t(Zt,{files:a(i).fileList.filter(ne=>ne.type==="added"),title:"已暂存的更改","group-key":"staged","collapsed-groups":M.value,"is-file-locked":le,"is-locking":h,"get-file-name":ge,"get-file-directory":W,onToggleCollapse:De,onFileClick:te,onToggleFileLock:ue,onUnstageFile:P},null,8,["files","collapsed-groups"]),t(Zt,{files:a(i).fileList.filter(ne=>ne.type==="modified"||ne.type==="deleted"),title:"未暂存的更改","group-key":"unstaged","collapsed-groups":M.value,"is-file-locked":le,"is-locking":h,"get-file-name":ge,"get-file-directory":W,onToggleCollapse:De,onFileClick:te,onToggleFileLock:ue,onStageFile:y,onRevertFileChanges:me},null,8,["files","collapsed-groups"]),t(Zt,{files:a(i).fileList.filter(ne=>ne.type==="untracked"),title:"未跟踪的文件","group-key":"untracked","collapsed-groups":M.value,"is-file-locked":le,"is-locking":h,"get-file-name":ge,"get-file-directory":W,onToggleCollapse:De,onFileClick:te,onToggleFileLock:ue,onStageFile:y,onRevertFileChanges:me},null,8,["files","collapsed-groups"])])):a(i).isGitRepo?(c(),w("div",Oa,[e("div",Ma,[t(Se,null,{default:s(()=>[t(a(Wt))]),_:1})]),F[6]||(F[6]=e("div",{class:"empty-text"},"没有检测到任何更改",-1)),F[7]||(F[7]=e("div",{class:"empty-subtext"},"工作区是干净的",-1))])):I("",!0)])):(c(),w("div",Va,F[5]||(F[5]=[e("div",{class:"empty-status"},[e("p",null,"当前目录不是Git仓库")],-1)])))],8,Ta)),[[we,a(i).isGitPulling||a(i).isGitFetching]])]),t(Ke,{modelValue:R.value,"onUpdate:modelValue":F[2]||(F[2]=ne=>R.value=ne),title:"文件差异","custom-class":"file-diff-dialog",size:"extra-large",type:"flex","destroy-on-close":""},{default:s(()=>[t(rs,{files:U.value,diffContent:_.value,selectedFile:j.value,context:"git-status",emptyText:"选择文件查看差异",onFileSelect:k,onOpenFile:J,onOpenWithVscode:O},null,8,["files","diffContent","selectedFile"])]),_:1},8,["modelValue"]),t(Ke,{modelValue:B.value,"onUpdate:modelValue":F[3]||(F[3]=ne=>B.value=ne),title:"锁定文件管理",size:"large","destroy-on-close":""},{default:s(()=>[e("div",Ra,[e("div",Ga,[t(Se,{class:"description-icon"},{default:s(()=>[t(a(as))]),_:1}),F[8]||(F[8]=e("span",{class:"description-title"},"文件锁定功能说明",-1))]),F[9]||(F[9]=e("div",{class:"description-content"},[e("ul",null,[e("li",null,"锁定的文件在执行 Git 提交时会被自动跳过，不会被添加到暂存区")])],-1))]),a(v).lockedFiles.length===0?(c(),w("div",Aa,[e("div",Ua,[t(Se,null,{default:s(()=>[t(a(Pt))]),_:1})]),F[10]||(F[10]=e("p",null,"当前没有锁定的文件",-1)),F[11]||(F[11]=e("p",{class:"empty-tip"},"您可以在文件列表中点击锁定按钮来锁定文件",-1))])):(c(),w("div",Ea,[e("div",Ia,[e("span",null,"🔒 已锁定 "+G(a(v).lockedFiles.length)+" 个文件",1),t(ae,{content:"这些文件在提交时会被自动跳过",placement:"top"},{default:s(()=>[t(Se,{class:"info-icon"},{default:s(()=>[t(a(as))]),_:1})]),_:1}),F[13]||(F[13]=e("div",{style:{flex:"1"}},null,-1)),t(Ce,{type:"danger",size:"small",plain:"",disabled:!a(v).lockedFiles.length,onClick:D},{default:s(()=>F[12]||(F[12]=[A(" 清空全部锁定 ")])),_:1},8,["disabled"])]),e("div",Na,[(c(!0),w($e,null,Re(a(v).lockedFiles,ne=>(c(),w("div",{key:ne,class:"locked-file-item"},[e("div",Ha,[F[14]||(F[14]=e("div",{class:"file-status-indicator locked"},null,-1)),e("div",Ja,[e("span",Wa,G(ge(ne)),1),e("span",qa,G(W(ne)),1)])]),e("div",Ka,[t(ae,{content:"解锁文件",placement:"top","hide-after":1e3},{default:s(()=>[t(Ce,{type:"danger",size:"small",circle:"",class:"file-action-btn",icon:a(ks),"aria-label":"解锁",onClick:Le=>se(ne)},null,8,["icon","onClick"])]),_:2},1024)])]))),128))])]))]),_:1},8,["modelValue"])],64)}}}),Qa=ze(Ya,[["__scopeId","data-v-d8e565de"]]),Xa={class:"loading-container"},Za={class:"loading-text"},el={key:0,class:"loading-progress"},tl=Be({__name:"GlobalLoading",props:{visible:{type:Boolean,default:!1},text:{default:"加载中..."},showProgress:{type:Boolean,default:!1},progress:{default:0},mock:{type:Boolean,default:!1}},setup(q){return(b,o)=>(c(),N(Ss,{to:"body"},[t(jt,{name:"loading-fade"},{default:s(()=>[b.visible||b.mock?(c(),w("div",{key:0,class:"global-loading-overlay",onClick:o[0]||(o[0]=wt(()=>{},["stop"]))},[e("div",Xa,[o[1]||(o[1]=e("div",{class:"loading-spinner"},[e("div",{class:"spinner-ring"}),e("div",{class:"spinner-ring"}),e("div",{class:"spinner-ring"})],-1)),e("div",Za,G(b.text),1),b.showProgress||b.mock?(c(),w("div",el,[e("div",{class:pe(["progress-bar",{"is-mock":b.mock&&!b.showProgress}]),style:bt(b.showProgress?{width:b.progress+"%"}:void 0)},null,6)])):I("",!0)])])):I("",!0)]),_:1})]))}}),sl=ze(tl,[["__scopeId","data-v-6ac6414b"]]),ol={class:"success-container"},al={class:"success-text"},ll={key:0,class:"success-description"},nl=Be({__name:"SuccessModal",props:{visible:{type:Boolean,default:!1},text:{default:"操作成功！"},description:{default:""}},setup(q){return(b,o)=>(c(),N(Ss,{to:"body"},[t(jt,{name:"success-fade"},{default:s(()=>[b.visible?(c(),w("div",{key:0,class:"success-overlay",onClick:o[0]||(o[0]=wt(()=>{},["stop"]))},[e("div",ol,[o[1]||(o[1]=e("div",{class:"success-icon"},[e("svg",{viewBox:"0 0 52 52",class:"success-svg"},[e("circle",{class:"success-circle",cx:"26",cy:"26",r:"25",fill:"none"}),e("path",{class:"success-check",fill:"none",d:"m14.1 27.2l7.1 7.2 16.7-16.8"})])],-1)),e("div",al,G(b.text),1),b.description?(c(),w("div",ll,G(b.description),1)):I("",!0)])])):I("",!0)]),_:1})]))}}),il=ze(nl,[["__scopeId","data-v-cca06f4a"]]),tt=Ts({visible:!1,text:"加载中...",showProgress:!1,progress:0});function rl(){return{loadingState:tt,show:u=>{tt.visible=!0,tt.text=(u==null?void 0:u.text)||"加载中...",tt.showProgress=(u==null?void 0:u.showProgress)||!1,tt.progress=(u==null?void 0:u.progress)||0},hide:()=>{tt.visible=!1},updateProgress:u=>{tt.progress=Math.max(0,Math.min(100,u))},updateText:u=>{tt.text=u},setText:u=>{tt.visible&&(tt.text=u)}}}const xt=Ts({visible:!1,text:"操作成功！",description:""});function cl(){const q=o=>{xt.visible=!0,xt.text=(o==null?void 0:o.text)||"操作成功！",xt.description=(o==null?void 0:o.description)||"";const i=(o==null?void 0:o.duration)||2e3;setTimeout(()=>{b()},i)},b=()=>{xt.visible=!1};return{successState:xt,show:q,hide:b}}const ul={class:"template-form"},dl={class:"template-form-buttons"},fl={key:0,class:"template-list"},pl={key:1,class:"template-list-scroll"},ml={class:"template-content"},vl={class:"template-actions"},gl={key:1,class:"templates-container"},hl={class:"message-templates-list"},yl={class:"templates-scroll-area"},_l={class:"template-content"},wl={class:"template-actions"},bl={key:0,class:"current-default-message"},kl={class:"default-message-content"},$l={key:2,class:"message-help-text"},Cl=Be({__name:"TemplateManager",props:{visible:{type:Boolean},type:{},title:{},placeholder:{default:"输入新模板内容"},editPlaceholder:{default:"编辑模板内容"},emptyDescription:{default:"暂无保存的模板"},showDefaultSection:{type:Boolean,default:!1},showHelpText:{type:Boolean,default:!1}},emits:["update:visible","use-template","set-default"],setup(q,{expose:b,emit:o}){const i=q,v=o,u=rt(),j=d(""),_=d(!1),R=d(""),Z=d(-1),E=d(!1),V=d(!1),h=K(()=>{switch(i.type){case"description":return u.descriptionTemplates||[];case"scope":return u.scopeTemplates||[];case"message":return u.messageTemplates||[];default:return[]}}),U=K(()=>i.type==="message"?u.defaultCommitMessage:""),k=K(()=>_.value?i.editPlaceholder:i.placeholder),J=K(()=>_.value?"更新模板":"添加模板"),O=K({get:()=>i.visible,set:te=>v("update:visible",te)});Ge(O,te=>{te||B()});function B(){j.value="",_.value=!1,R.value="",Z.value=-1}async function M(){if(!j.value.trim()){n.warning("模板内容不能为空");return}try{E.value=!0,_.value?await u.updateTemplate(R.value,j.value,i.type)&&B():await u.saveTemplate(j.value,i.type)&&(j.value="")}catch(te){n.error(`模板保存失败: ${te.message}`)}finally{E.value=!1}}function S(te){v("use-template",te),i.type!=="message"&&(O.value=!1)}function Q(te,y){_.value=!0,R.value=te,j.value=te,Z.value=y}function se(){B()}async function D(te){try{const y=await u.deleteTemplate(te,i.type)}catch(y){n.error(`模板删除失败: ${y.message}`)}}async function ve(){if(!(i.type!=="message"||!j.value.trim()))try{V.value=!0,await u.saveDefaultMessage(j.value)&&v("set-default",j.value)}catch(te){n.error(`设置默认提交信息失败: ${te.message}`)}finally{V.value=!1}}return b({resetForm:B}),(te,y)=>{const P=Ot,H=ke,ce=zt,fe=vo,me=xs,ge=Dt;return c(),N(Ke,{modelValue:O.value,"onUpdate:modelValue":y[1]||(y[1]=W=>O.value=W),title:te.title,"close-on-click-modal":!1,"custom-class":te.type==="message"?"message-template-dialog":"template-dialog"},{default:s(()=>[e("div",{class:pe(["template-container",{"message-template-container":te.type==="message"}])},[e("div",ul,[t(P,{modelValue:j.value,"onUpdate:modelValue":y[0]||(y[0]=W=>j.value=W),placeholder:k.value,class:"template-input",clearable:"",onKeyup:Vs(M,["enter"])},null,8,["modelValue","placeholder"]),e("div",dl,[_.value?(c(),N(H,{key:0,onClick:se},{default:s(()=>y[2]||(y[2]=[A("取消")])),_:1})):I("",!0),t(H,{type:"primary",onClick:M,disabled:!j.value.trim()||E.value,loading:E.value},{default:s(()=>[A(G(J.value),1)]),_:1},8,["disabled","loading"]),te.type==="message"?(c(),N(H,{key:1,type:"success",onClick:ve,disabled:!j.value.trim()||V.value,loading:V.value,plain:""},{default:s(()=>y[3]||(y[3]=[A(" 设为默认提交信息 ")])),_:1},8,["disabled","loading"])):I("",!0)])]),te.type!=="message"?(c(),w("div",fl,[e("h3",null,"已保存"+G(te.type==="description"?"模板":"作用域"),1),h.value.length===0?(c(),N(ce,{key:0,description:te.emptyDescription},null,8,["description"])):(c(),w("div",pl,[(c(!0),w($e,null,Re(h.value,(W,le)=>(c(),N(me,{key:le,class:"template-item"},{default:s(()=>[t(fe,{justify:"space-between",align:"middle",style:{width:"100%"}},{default:s(()=>[e("div",ml,G(W),1),e("div",vl,[t(H,{type:"primary",size:"small",onClick:ue=>S(W)},{default:s(()=>y[4]||(y[4]=[A("使用")])),_:2},1032,["onClick"]),t(H,{type:"warning",size:"small",icon:a(dt),onClick:ue=>Q(W,le)},{default:s(()=>y[5]||(y[5]=[A(" 编辑 ")])),_:2},1032,["icon","onClick"]),t(H,{type:"danger",size:"small",onClick:ue=>D(W)},{default:s(()=>y[6]||(y[6]=[A("删除")])),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]))])):(c(),w("div",gl,[e("div",hl,[y[10]||(y[10]=e("h3",null,"已保存模板",-1)),e("div",yl,[h.value.length===0?(c(),N(ce,{key:0,description:te.emptyDescription},null,8,["description"])):I("",!0),(c(!0),w($e,null,Re(h.value,(W,le)=>(c(),N(me,{key:le,class:"template-item"},{default:s(()=>[t(fe,{justify:"space-between",align:"middle",style:{width:"100%"}},{default:s(()=>[e("div",_l,G(W),1),e("div",wl,[t(H,{type:"primary",size:"small",onClick:ue=>S(W)},{default:s(()=>y[7]||(y[7]=[A("使用")])),_:2},1032,["onClick"]),t(H,{type:"warning",size:"small",icon:a(dt),onClick:ue=>Q(W,le)},{default:s(()=>y[8]||(y[8]=[A(" 编辑 ")])),_:2},1032,["icon","onClick"]),t(H,{type:"danger",size:"small",onClick:ue=>D(W)},{default:s(()=>y[9]||(y[9]=[A("删除")])),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))])]),te.showDefaultSection?(c(),w("div",bl,[y[18]||(y[18]=e("h3",null,"当前默认提交信息",-1)),U.value?(c(),N(me,{key:0,class:"default-message-card"},{default:s(()=>[e("div",kl,G(U.value),1)]),_:1})):(c(),N(ce,{key:1,description:"尚未设置默认提交信息","image-size":100})),te.showHelpText?(c(),w("div",$l,[y[16]||(y[16]=e("h4",null,"关于默认提交信息",-1)),y[17]||(y[17]=e("p",null,"默认提交信息将在未输入提交信息时自动使用。",-1)),e("p",null,[y[13]||(y[13]=A("你可以通过点击左侧模板的")),t(ge,{size:"small",type:"primary"},{default:s(()=>y[11]||(y[11]=[A("使用")])),_:1}),y[14]||(y[14]=A("按钮先选择喜欢的模板，然后点击上方")),t(ge,{size:"small",type:"success"},{default:s(()=>y[12]||(y[12]=[A("设为默认提交信息")])),_:1}),y[15]||(y[15]=A("按钮保存。"))])])):I("",!0)])):I("",!0)]))],2)]),_:1},8,["modelValue","title","custom-class"])}}}),es=ze(Cl,[["__scopeId","data-v-30972b5b"]]),Sl={class:"git-command-preview"},Tl={class:"preview-container"},Vl={class:"preview-title"},xl={class:"preview-content code-command"},Fl=Be({__name:"GitCommandPreview",props:{command:{},title:{default:"Git命令预览："},copyButtonText:{default:"复制命令"},placeholder:{default:"<命令内容>"}},setup(q){const b=q,o=K(()=>b.command||b.placeholder);async function i(){if(!b.command){n.warning("没有可复制的命令内容");return}try{await navigator.clipboard.writeText(b.command),n.success("命令已复制到剪贴板")}catch(v){n.error(`复制失败: ${v.message}`)}}return(v,u)=>{const j=Ze,_=je;return c(),w("div",Sl,[e("div",Tl,[e("div",Vl,G(v.title),1),e("div",xl,G(o.value),1),t(_,{content:v.copyButtonText,placement:"bottom",effect:"dark","open-delay":300},{default:s(()=>[e("button",{class:"modern-btn copy-command-btn",onClick:i},[t(j,{class:"btn-icon"},{default:s(()=>[t(a(ht))]),_:1})])]),_:1},8,["content"])])])}}}),Ll=ze(Fl,[["__scopeId","data-v-9066ce64"]]),Bl={class:"one-push-content"},zl={class:"one-push-text"},Pl={key:0,class:"one-push-desc"},jl=Be({__name:"QuickPushButton",props:{from:{default:"form"},hasUserCommitMessage:{type:Boolean,default:!1},finalCommitMessage:{default:""},skipHooks:{type:Boolean,default:!1}},emits:["beforePush","afterPush","clearFields"],setup(q,{emit:b}){const o=ot(),i=rt(),v=q,u=b;function j(h){const U=h.replace(/\\/g,"/");return i.lockedFiles.some(k=>{const J=k.replace(/\\/g,"/");return U===J})}const _=K(()=>o.fileList.some(h=>!j(h.path))),R=K(()=>!_.value||!v.hasUserCommitMessage||!o.hasUpstream),Z=K(()=>o.isAddingFiles||o.isCommiting||o.isPushing),E=K(()=>_.value?v.hasUserCommitMessage?o.hasUpstream?"一键完成：暂存所有更改 → 提交 → 推送到远程仓库":"当前分支没有上游分支":"请输入提交信息":"没有需要提交的更改");async function V(){u("beforePush");try{const h=await o.addCommitAndPush(v.finalCommitMessage,v.skipHooks);h&&u("clearFields"),u("afterPush",h)}catch(h){console.error("一键推送失败:",h),u("afterPush",!1)}}return(h,U)=>{const k=Ze,J=ke;return c(),N(a(je),{content:E.value,placement:"top","show-after":200},{default:s(()=>[t(J,{type:"success",onClick:V,loading:Z.value,disabled:R.value,class:pe([h.from,"one-push-button"])},{default:s(()=>[e("div",Bl,[t(k,{class:"one-push-icon"},{default:s(()=>[t(a(go))]),_:1}),e("div",zl,[U[0]||(U[0]=e("span",{class:"one-push-title"},"一键推送所有",-1)),h.from==="form"?(c(),w("span",Pl,"暂存 + 提交 + 推送")):I("",!0)])])]),_:1},8,["loading","disabled","class"])]),_:1},8,["content"])}}}),Os=ze(jl,[["__scopeId","data-v-58e155b2"]]),Dl={key:0},Ol=Be({__name:"StageButton",props:{from:{default:"form"}},emits:["click"],setup(q,{emit:b}){const o=b,i=ot(),v=rt();function u(h){const U=h.replace(/\\/g,"/");return v.lockedFiles.some(k=>{const J=k.replace(/\\/g,"/");return U===J})}function j(){return v.lockedFiles.length===0?!1:i.fileList.some(h=>["modified","deleted","untracked"].includes(h.type)?u(h.path):!1)}const _=K(()=>i.fileList.filter(h=>["modified","deleted","untracked"].includes(h.type)&&!u(h.path)).length),R=K(()=>i.fileList.some(h=>["modified","deleted","untracked"].includes(h.type)&&!u(h.path))),Z=K(()=>!R.value),E=K(()=>R.value?j()?`暂存${_.value}个未暂存文件（逐个添加）`:"暂存所有更改（git add .）":"没有需要暂存的更改");async function V(){o("click");try{let h;j()?h=await i.addToStage():h=await i.addAllToStage(),h&&i.fetchStatus()}catch(h){console.error("添加文件失败:",h)}}return(h,U)=>{const k=ke,J=je;return c(),N(J,{content:E.value,placement:"top"},{default:s(()=>[t(k,{type:"primary",onClick:V,loading:a(i).isAddingFiles,disabled:Z.value,class:pe(["stage-button",`from-${h.from}`])},{default:s(()=>[U[0]||(U[0]=A(" 暂存更改 ")),_.value>0?(c(),w("span",Dl,"("+G(_.value)+")",1)):I("",!0)]),_:1},8,["loading","disabled","class"])]),_:1},8,["content"])}}}),Ms=ze(Ol,[["__scopeId","data-v-01b0a8bc"]]),Ml={key:0},Rl=Be({__name:"CommitButton",props:{from:{default:"form"},hasUserCommitMessage:{type:Boolean,default:!1},finalCommitMessage:{default:""},skipHooks:{type:Boolean,default:!1}},emits:["click","beforeCommit","afterCommit"],setup(q,{emit:b}){const o=q,i=b,v=ot(),u=rt();function j(h){const U=h.replace(/\\/g,"/");return u.lockedFiles.some(k=>{const J=k.replace(/\\/g,"/");return U===J})}const _=K(()=>v.fileList.filter(h=>h.type==="added"&&!j(h.path)).length),R=K(()=>_.value>0),Z=K(()=>!R.value||!o.hasUserCommitMessage),E=K(()=>R.value?o.hasUserCommitMessage?`提交${_.value}个已暂存文件`:"请输入提交信息":"没有已暂存的更改");async function V(){if(o.finalCommitMessage.trim()){i("beforeCommit"),i("click");try{const h=await v.commitChanges(o.finalCommitMessage,o.skipHooks);h&&(v.fetchStatus(),v.fetchLog(),v.getBranchStatus(!0)),i("afterCommit",h)}catch(h){console.error("提交失败:",h),i("afterCommit",!1)}}}return(h,U)=>{const k=ke,J=je;return c(),N(J,{content:E.value,placement:"top"},{default:s(()=>[t(k,{type:"primary",onClick:V,loading:a(v).isLoadingStatus,disabled:Z.value,class:pe(["commit-button",`from-${h.from}`])},{default:s(()=>[U[0]||(U[0]=A(" 提交 ")),_.value>0?(c(),w("span",Ml,"("+G(_.value)+")",1)):I("",!0)]),_:1},8,["loading","disabled","class"])]),_:1},8,["content"])}}}),Rs=ze(Rl,[["__scopeId","data-v-d171a315"]]),Gl={key:0},Al=Be({__name:"PushButton",props:{from:{default:"form"}},emits:["click","beforePush","afterPush"],setup(q,{emit:b}){const o=b,i=ot(),v=K(()=>i.branchAhead>0),u=K(()=>i.fileList.some(V=>V.type==="added")),j=K(()=>i.hasUpstream&&v.value&&!u.value),_=K(()=>!j.value),R=K(()=>i.hasUpstream?v.value?u.value?"有未提交的暂存更改，请先提交":`推送${i.branchAhead}个本地提交`:"没有需要推送的提交":"当前分支没有上游分支"),Z=K(()=>j.value?{backgroundColor:"#67c23a",borderColor:"#67c23a"}:{});async function E(){o("beforePush"),o("click");try{const V=await i.pushToRemote();V&&await new Promise(h=>setTimeout(h,200)),o("afterPush",V)}catch(V){console.error("推送失败:",V),o("afterPush",!1)}}return(V,h)=>{const U=ke,k=je;return c(),N(k,{content:R.value,placement:"top"},{default:s(()=>[t(U,{type:"primary",icon:a(ho),onClick:E,loading:a(i).isPushing,disabled:_.value,style:bt(Z.value),class:pe(["push-button",`from-${V.from}`])},{default:s(()=>[h[0]||(h[0]=A(" 推送 ")),v.value?(c(),w("span",Gl,"("+G(a(i).branchAhead)+")",1)):I("",!0)]),_:1},8,["icon","loading","disabled","style","class"])]),_:1},8,["content"])}}}),Gs=ze(Al,[["__scopeId","data-v-1c347c7f"]]),Ul={class:"form-bottom-actions"},El={class:"actions-flex-container"},Il={class:"left-actions"},Nl={class:"button-grid"},Hl={class:"right-actions"},Jl=Be({__name:"GitActionButtons",props:{hasUserCommitMessage:{type:Boolean,default:!1},finalCommitMessage:{default:""},skipHooks:{type:Boolean,default:!1},from:{default:"form"}},emits:["afterCommit","afterPush","beforePush","clearFields"],setup(q,{emit:b}){const o=b;function i(_){o("afterCommit",_)}function v(_){o("afterPush",_)}function u(){o("beforePush")}function j(){o("clearFields")}return(_,R)=>(c(),w("div",Ul,[e("div",El,[e("div",Il,[e("div",Nl,[t(Ms,{onClick:()=>{},from:_.from},null,8,["from"]),t(Rs,{"has-user-commit-message":_.hasUserCommitMessage,"final-commit-message":_.finalCommitMessage,"skip-hooks":_.skipHooks,onBeforeCommit:()=>{},onAfterCommit:i,onClick:()=>{},from:_.from},null,8,["has-user-commit-message","final-commit-message","skip-hooks","from"]),t(Gs,{onBeforePush:()=>{},onAfterPush:v,onClick:()=>{},from:_.from},null,8,["from"])])]),e("div",Hl,[t(Os,{from:_.from,"has-user-commit-message":_.hasUserCommitMessage,"final-commit-message":_.finalCommitMessage,"skip-hooks":_.skipHooks,onBeforePush:u,onAfterPush:v,onClearFields:j},null,8,["from","has-user-commit-message","final-commit-message","skip-hooks"])])])]))}}),Wl=ze(Jl,[["__scopeId","data-v-6cf9ea2c"]]),ql={class:"option-header"},Kl={class:"option-info"},Yl={class:"option-title"},Ql=Be({__name:"OptionSwitchCard",props:{modelValue:{type:Boolean},title:{},tooltip:{},activeText:{},inactiveText:{},activeColor:{},iconClass:{},compact:{type:Boolean}},emits:["update:modelValue"],setup(q,{emit:b}){const o=q,i=b;function v(u){i("update:modelValue",u)}return(u,j)=>{const _=$s,R=je;return c(),w("div",{class:pe(["option-card",{compact:o.compact}])},[t(R,{content:u.tooltip,placement:"top","hide-after":1e3,"show-after":200},{default:s(()=>[e("div",ql,[e("div",{class:pe(["option-icon",u.iconClass])},[ut(u.$slots,"icon",{},void 0,!0)],2),e("div",Kl,[e("h4",Yl,G(u.title),1)]),t(_,{class:"option-switch","model-value":u.modelValue,"onUpdate:modelValue":v,"active-text":u.activeText,"inactive-text":u.inactiveText,"active-color":u.activeColor,size:"small"},null,8,["model-value","active-text","inactive-text","active-color"])])]),_:3},8,["content"])],2)}}}),ts=ze(Ql,[["__scopeId","data-v-2f759bee"]]),Xl={class:"console-header"},Zl={class:"header-left"},en={class:"header-actions"},tn={class:"console-content"},sn={class:"console-input-row"},on={class:"prompt",title:"当前路径"},an={key:0,class:"console-output"},ln={class:"cmd-header"},nn={class:"cmd-line"},rn={class:"cmd-text"},cn={class:"ts"},un={key:0,class:"output-content"},dn={key:0,class:"stdout"},fn={key:1,class:"stderr"},pn=Be({__name:"CommandConsole",setup(q){const b=d(""),o=d(""),i=d(!1),v=d([]);let u=0;const j=d(!1),_=d(!1);async function R(){const E=o.value.trim();if(!E||i.value)return;i.value=!0;const V={id:++u,command:E,success:!1,ts:new Date().toLocaleString(),expanded:!0,stdout:"",stderr:""};v.value.unshift(V);try{const U=await(await fetch("/api/exec",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:E})})).json();V.success=!!(U!=null&&U.success),V.stdout=(U==null?void 0:U.stdout)||"",V.stderr=(U==null?void 0:U.error)||(U==null?void 0:U.stderr)||""}catch(h){V.success=!1,V.stderr=(h==null?void 0:h.message)||String(h)}finally{i.value=!1,o.value=""}}function Z(E){const V=v.value.findIndex(h=>h.id===E.id);V!==-1&&(v.value[V].expanded=!v.value[V].expanded)}return pt(async()=>{try{const V=await(await fetch("/api/current_directory")).json();b.value=(V==null?void 0:V.directory)||""}catch{}}),(E,V)=>{const h=Ze,U=ke,k=je,J=Ot;return c(),w("div",{class:pe(["command-console",{fullscreen:_.value}])},[e("div",Xl,[e("div",Zl,[t(h,{class:"title-icon"},{default:s(()=>[t(a(Wt))]),_:1}),V[3]||(V[3]=e("span",{class:"console-title"},"自定义指令执行",-1))]),e("div",en,[t(k,{content:_.value?"退出全屏":"全屏显示",placement:"bottom"},{default:s(()=>[t(U,{text:"",onClick:V[0]||(V[0]=O=>_.value=!_.value),class:"toggle-console-btn"},{default:s(()=>[t(h,null,{default:s(()=>[t(a(Fs))]),_:1})]),_:1})]),_:1},8,["content"]),t(k,{content:j.value?"收起":"展开",placement:"bottom"},{default:s(()=>[t(U,{text:"",onClick:V[1]||(V[1]=O=>j.value=!j.value),class:"toggle-console-btn"},{default:s(()=>[t(h,{class:pe({"rotate-icon":!j.value})},{default:s(()=>[t(a(yt))]),_:1},8,["class"])]),_:1})]),_:1},8,["content"])])]),t(jt,{name:"console-content-slide"},{default:s(()=>[st(e("div",tn,[e("div",sn,[e("span",on,G(b.value)+" >",1),t(J,{modelValue:o.value,"onUpdate:modelValue":V[2]||(V[2]=O=>o.value=O),class:"console-input",placeholder:"输入命令，例如: git status",onKeydown:Vs(wt(R,["prevent"]),["enter"]),disabled:i.value,clearable:""},null,8,["modelValue","onKeydown","disabled"]),t(U,{type:"primary",loading:i.value,onClick:R},{default:s(()=>V[4]||(V[4]=[A("执行")])),_:1},8,["loading"])]),v.value.length?(c(),w("div",an,[(c(!0),w($e,null,Re(v.value,O=>(c(),w("div",{key:O.id,class:"console-record"},[e("div",ln,[e("div",nn,[V[5]||(V[5]=e("span",{class:"cmd-prefix"},">",-1)),e("span",rn,G(O.command),1),e("span",cn,G(O.ts),1)]),t(k,{content:O.stdout||O.stderr?O.expanded?"收起输出":"展开输出":"无输出内容",placement:"left"},{default:s(()=>[t(U,{text:"",size:"small",onClick:B=>Z(O),disabled:!O.stdout&&!O.stderr,class:"toggle-output-btn"},{default:s(()=>[t(h,{class:pe({"rotate-icon":!O.expanded})},{default:s(()=>[t(a(yt))]),_:2},1032,["class"])]),_:2},1032,["onClick","disabled"])]),_:2},1032,["content"])]),t(jt,{name:"output-slide"},{default:s(()=>[O.expanded&&(O.stdout||O.stderr)?(c(),w("div",un,[O.stdout?(c(),w("pre",dn,G(O.stdout),1)):I("",!0),O.stderr?(c(),w("pre",fn,G(O.stderr),1)):I("",!0)])):I("",!0)]),_:2},1024)]))),128))])):I("",!0)],512),[[_t,j.value]])]),_:1})],2)}}}),mn=ze(pn,[["__scopeId","data-v-83d7f852"]]),vn={class:"card-header app-card-header"},gn={key:0,class:"header-switches"},hn={key:1,class:"header-actions"},yn={class:"card-content app-card-content"},_n={class:"layout-container"},wn={key:0,class:"git-config-warning"},bn={key:1,class:"commit-section"},kn={key:0,class:"commit-form"},$n={class:"description-container"},Cn={key:1,class:"standard-commit-form"},Sn={class:"standard-commit-header"},Tn={class:"type-scope-container"},Vn={class:"scope-wrapper"},xn={class:"description-container description-inline"},Fn={class:"advanced-fields"},Ln={class:"actions-section"},Bn={class:"action-groups"},zn={class:"operations-wrapper"},Pn={class:"action-group"},jn={class:"group-buttons"},Dn={key:0},On={class:"action-group"},Mn={class:"group-buttons"},Rn={class:"action-group reset-group"},Gn={class:"group-buttons"},An={key:0},Un={class:"action-group branch-group"},En={class:"group-buttons"},In={class:"action-group"},Nn={class:"group-buttons"},Hn={class:"editor-header"},Jn={class:"editor-info"},Wn={class:"editor-tips"},qn={class:"json-editor-wrapper"},Kn={class:"editor-footer"},Yn={class:"footer-left"},Qn={class:"footer-right"},Xn={class:"config-warning-content"},Zn={class:"warning-message"},ei={class:"dialog-footer"},ti={class:"stash-dialog-content"},si={class:"stash-info-card"},oi={class:"info-icon"},ai={class:"stash-options"},li={class:"options-title"},ni={class:"option-item"},ii={class:"option-item"},ri={key:0,class:"stash-preview"},ci={class:"preview-title"},ui={class:"file-count-info"},di={class:"merge-dialog-content"},fi={class:"merge-intro"},pi={class:"merge-options"},mi={class:"dialog-footer"},vi={class:"stash-list-content"},gi={key:0,class:"stash-header"},hi={class:"stash-stats"},yi={class:"stat-item"},_i={class:"stat-number"},wi={key:0,class:"stash-actions-header"},bi={class:"stash-list-container"},ki={key:0,class:"empty-state"},$i={key:1,class:"stash-cards"},Ci={class:"stash-card-content"},Si={class:"stash-info"},Ti={class:"stash-main-info"},Vi={class:"stash-id-badge"},xi={class:"stash-id-text"},Fi={class:"stash-description"},Li={class:"description-text"},Bi={class:"stash-card-actions"},zi={class:"stash-content"},Pi={key:0,class:"stash-info-row"},ji={class:"stash-id"},Di={class:"stash-id-value"},Oi={class:"stash-description"},Mi={class:"stash-description-value"},Ri={class:"stash-main-content"},Gi={key:0,class:"status-updating-indicator"},Ai=Be({__name:"CommitForm",setup(q,{expose:b}){const o=ot(),i=rt(),v=d(""),{loadingState:u,show:j,hide:_,setText:R}=rl(),{successState:Z,show:E}=cl(),V=d(!1),h=d("输入提交信息..."),U=d(""),k=d(!1),J=d("feat"),O=d(""),B=d(""),M=d(""),S=d(""),Q=d(!1),se=d(""),D=d(!1),ve=d(!1),te=d(""),y=d([]),P=d(!1),H=d(!1),ce=d(""),fe=d({noFf:!1,squash:!1,noCommit:!1,message:""}),me=d([]),ge=d(!1),W=d(!1),le=d(!1),ue=d(!1),De=d(!1),z=[{value:"feat",label:"feat: 新功能"},{value:"fix",label:"fix: 修复bug"},{value:"docs",label:"docs: 文档修改"},{value:"style",label:"style: 样式修改"},{value:"refactor",label:"refactor: 代码重构"},{value:"test",label:"test: 测试代码"},{value:"chore",label:"chore: 构建/工具修改"}],F=d(!1),ie=d(!1),ae=d(""),Ce=d(!1),Se=d(!0),Oe=d(!1),we=d(null),ne=d([]),Le=d(""),Me=d(!1),et=d("");function lt(){ae.value="",Ce.value=!1,Se.value=!qt.value,F.value=!0}async function Qe(){try{const l=await(await fetch("/api/config/check-file-format")).json();let Y="";l.success&&(l.exists?l.isValidJson||(Y=`系统配置文件格式有误：${l.error}
编辑后保存可能会覆盖原文件内容。`):Y="系统配置文件不存在，将使用默认配置。");const _e=i.config;if(se.value=JSON.stringify(_e,null,2),Y){te.value=Y,ve.value=!0;return}Q.value=!0}catch{n.error("加载配置失败")}}async function at(){try{D.value=!0;let p;try{p=JSON.parse(se.value)}catch(_e){n.error(`JSON 解析失败: ${_e.message||_e}`);return}const Y=await(await fetch("/api/config/saveAll",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:p})})).json();if(!Y.success)throw new Error(Y.error||"保存失败");await i.loadConfig(!0);try{await i.loadLockedFiles()}catch{}try{Array.isArray(i.descriptionTemplates)&&(y.value=[...i.descriptionTemplates])}catch{}try{Array.isArray(i.scopeTemplates)&&(me.value=[...i.scopeTemplates])}catch{}try{Array.isArray(i.messageTemplates)&&(Ve.value=[...i.messageTemplates])}catch{}n.success("配置已保存"),Q.value=!1}catch(p){n.error(`保存配置失败: ${p.message||p}`)}finally{D.value=!1}}async function nt(){try{const p=await fetch("/api/config/open-file",{method:"POST"}),l=await p.json();if(!p.ok||!(l!=null&&l.success))throw new Error((l==null?void 0:l.error)||"打开失败");n.success("已用系统程序打开配置文件")}catch(p){n.error(`打开配置文件失败: ${(p==null?void 0:p.message)||p}`)}}function Ae(p){ve.value=!1,p==="continue"?Q.value=!0:p==="open"&&nt()}function We(){o.getStashList(),ie.value=!0}async function T(){try{await o.saveStash(ae.value,Ce.value,Se.value),F.value=!1}catch(p){console.error("储藏失败:",p)}}async function r(p,l=!1){try{await o.applyStash(p,l),l&&await o.getStashList()}catch(Y){console.error("应用储藏失败:",Y)}}async function X(p){Ye.confirm("确定要删除此储藏吗？此操作不可恢复。","删除储藏",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await o.dropStash(p),await o.getStashList()}).catch(()=>{})}async function de(){Ye.confirm("确定要清空所有储藏吗？此操作不可恢复。","清空所有储藏",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await o.clearAllStashes(),await o.getStashList()}).catch(()=>{})}async function Te(p){if(p){we.value=p,Oe.value=!0,Me.value=!0,ne.value=[],Le.value="",et.value="";try{if(!p.id||p.id.length<7){Le.value="无效的stash ID",Me.value=!1;return}const Y=await(await fetch(`/api/stash-files?stashId=${encodeURIComponent(p.id)}`)).json();Y.success&&Array.isArray(Y.files)?(ne.value=Y.files,ne.value.length>0?await Ne(p.id,ne.value[0]):Le.value="该stash没有变更文件"):Le.value=`获取文件列表失败: ${Y.error||"未知错误"}`}catch(l){Le.value=`获取stash详情失败: ${l.message}`}finally{Me.value=!1}}}async function Ne(p,l){Me.value=!0,et.value=l;try{const _e=await(await fetch(`/api/stash-file-diff?stashId=${encodeURIComponent(p)}&file=${encodeURIComponent(l)}`)).json();_e.success?Le.value=_e.diff||"没有变更内容":Le.value=`获取差异失败: ${_e.error||"未知错误"}`}catch(Y){Le.value=`获取差异失败: ${Y.message}`}finally{Me.value=!1}}function be(p){we.value&&Ne(we.value.id,p)}async function he(p,l){try{const _e=await(await fetch("/api/open-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:p,context:l})})).json();_e.success?n.success(_e.message):n.error(_e.error||"打开文件失败")}catch(Y){n.error(`打开文件失败: ${Y.message}`)}}async function Ue(p,l){try{const _e=await(await fetch("/api/open-with-vscode",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:p,context:l})})).json();_e.success?n.success(_e.message):n.error(_e.error||"用VSCode打开文件失败")}catch(Y){n.error(`用VSCode打开文件失败: ${Y.message}`)}}const Ve=d([]);Ge(k,p=>{localStorage.setItem("zen-gitsync-standard-commit",p.toString())}),Ge(le,p=>{localStorage.setItem("zen-gitsync-skip-hooks",p.toString())}),Ge(ue,p=>{localStorage.setItem("zen-gitsync-auto-quick-push",p.toString())});const ye=K(()=>{if(!k.value)return v.value||U.value;let p=`${J.value||""}`;return O.value&&(p+=`(${O.value})`),p+=`: ${B.value}`,M.value&&(p+=`

${M.value}`),S.value&&(p+=`

${S.value}`),p}),oe=K(()=>k.value?J.value.trim()!==""&&B.value.trim()!=="":v.value.trim()!==""),Je=K(()=>{const p=`输入提交信息 (默认: ${U.value})`;return ue.value?`${p}（按回车一键推送）`:p}),mt=K(()=>ue.value?"简短描述（必填，按回车一键推送）":"简短描述（必填）"),kt=K(()=>ne.value.map(p=>({path:p,name:p.split("/").pop()||p}))),$t=K(()=>{let p=`git commit -m "${ye.value}"`;return le.value&&(p+=" --no-verify"),p});function it(){const p=i.config;p&&(h.value=`输入提交信息 (默认: ${p.defaultCommitMessage})`,U.value=p.defaultCommitMessage||"",p.descriptionTemplates&&Array.isArray(p.descriptionTemplates)&&(y.value=p.descriptionTemplates),p.scopeTemplates&&Array.isArray(p.scopeTemplates)&&(me.value=p.scopeTemplates),p.messageTemplates&&Array.isArray(p.messageTemplates)&&(Ve.value=p.messageTemplates))}function Ee(p){B.value=p,P.value=!1}function Ct(p){O.value=p,ge.value=!1}function $(){P.value=!0}function g(){ge.value=!0}function ee(){E({text:"操作成功！",description:"已完成操作",duration:2e3})}async function f(){try{await o.gitPull(),await o.fetchStatus(),await o.fetchLog(!1)}catch(p){console.error("拉取操作发生错误:",p)}}async function m(){try{await o.gitFetchAll(),await o.fetchStatus(),await o.fetchLog(!1)}catch(p){console.error("获取远程分支信息操作发生错误:",p)}}async function L(){if(!ye.value.trim()){n({message:"提交信息不能为空",type:"warning"});return}try{await o.addAndCommit(ye.value,le.value),re(),o.fetchStatus(),o.fetchLog()}catch(p){n({message:`暂存并提交失败: ${p.message}`,type:"error"})}}async function C(){try{await Ye.confirm(`确定要重置当前分支 "${o.currentBranch}" 到远程状态吗？这将丢失所有未推送的提交和本地更改。`,"重置到远程分支",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await o.resetToRemote(o.currentBranch)&&(o.fetchStatus(),o.fetchLog())}catch(p){p!=="cancel"&&n({message:`重置到远程分支失败: ${p.message}`,type:"error"})}}function re(){v.value="",B.value="",M.value="",S.value=""}function Pe(){j({text:"正在暂存文件...",showProgress:!1})}function He(p){if(_(),p){V.value=!0;try{setTimeout(async()=>{try{console.log("推送成功，状态已更新")}catch(l){console.error("一键推送后处理失败:",l)}finally{V.value=!1}},1e3)}catch(l){console.error("一键推送后处理失败:",l),V.value=!1}}}function qe(p){const l=p.replace(/\\/g,"/");return i.lockedFiles.some(Y=>{const _e=Y.replace(/\\/g,"/");return l===_e})}const Mt=K(()=>o.fileList.some(p=>["modified","deleted","untracked"].includes(p.type)&&!qe(p.path))),Rt=K(()=>o.fileList.filter(p=>p.type==="added"&&!qe(p.path)).length),Us=K(()=>Rt.value>0),Es=K(()=>o.fileList.some(p=>!qe(p.path))),Is=K(()=>o.fileList.length>0),qt=K(()=>o.fileList.length>0&&o.fileList.every(p=>qe(p.path))),Ns=K(()=>o.branchAhead>0),Kt=K(()=>o.branchBehind>0),cs=K(()=>Us.value),Hs=K(()=>o.hasUpstream&&(Ns.value||Kt.value||Es.value));function Js(p){v.value=p,W.value=!1}async function us(p){if(!(!ue.value||!oe.value||!o.fileList.some(Y=>!qe(Y.path))||!oe.value||!o.hasUpstream)&&p.key==="Enter"&&!p.shiftKey){p.preventDefault();try{Pe();const Y=await o.addCommitAndPush(ye.value,le.value);Y&&re(),He(Y)}catch(Y){console.error("回车自动一键提交失败:",Y),He(!1)}}}async function Ws(p){try{await i.saveDefaultMessage(p)&&n.success("默认提交信息设置成功")}catch(l){n.error(`设置默认提交信息失败: ${l.message}`)}}Ge(()=>o.isAddingFiles,p=>{p&&u.visible&&R("正在暂存文件...")}),Ge(()=>o.isCommiting,p=>{p&&u.visible&&R("正在提交更改...")}),Ge(()=>o.isPushing,p=>{p&&u.visible&&R("正在推送...")}),pt(async()=>{const p=localStorage.getItem("zen-gitsync-standard-commit");p!==null&&(k.value=p==="true");const l=localStorage.getItem("zen-gitsync-skip-hooks");l!==null&&(le.value=l==="true");const Y=localStorage.getItem("zen-gitsync-auto-quick-push");Y!==null&&(ue.value=Y==="true"),Ge(()=>i.config,it,{immediate:!0}),i.config||await i.loadConfig()});function qs(){ce.value="",fe.value={noFf:!1,squash:!1,noCommit:!1,message:""},vt.value="all",H.value=!0,o.allBranches.length===0&&o.getAllBranches()}const vt=d("all"),Ks=K(()=>{const p=o.allBranches.filter(l=>l!==o.currentBranch);if(console.log("筛选分支列表:",{allBranches:o.allBranches,currentBranch:o.currentBranch,branchTypeFilter:vt.value,filteredBranches:p}),vt.value==="local"){const l=p.filter(Y=>!Y.includes("origin/"));return console.log("本地分支:",l),l}else if(vt.value==="remote"){const l=p.filter(Y=>Y.includes("origin/"));return console.log("远程分支:",l),l}else return console.log("所有分支:",p),p});async function Ys(){if(!ce.value){n({message:"请选择要合并的分支",type:"warning"});return}try{await o.mergeBranch(ce.value,fe.value)&&(H.value=!1,await o.fetchStatus(),await o.fetchLog(!1))}catch(p){console.error("合并分支操作发生错误:",p)}}const Gt=d(!1);function Qs(){Gt.value=!Gt.value}b({openConfigEditor:Qe,toggleGitOperationsDrawer:Qs});function Xs(p,l){const _e=[...p?y.value.filter(xe=>xe.toLowerCase().includes(p.toLowerCase())).map(xe=>({value:xe})):y.value.map(xe=>({value:xe})),{value:"⚙️ 管理模板...",isSettings:!0}];l(_e)}function Zs(p,l){const _e=[...p?me.value.filter(xe=>xe.toLowerCase().includes(p.toLowerCase())).map(xe=>({value:xe})):me.value.map(xe=>({value:xe})),{value:"⚙️ 管理模板...",isSettings:!0}];l(_e)}function eo(p){p.isSettings?($(),B.value=""):B.value=p.value}function to(p){p.isSettings?(g(),O.value=""):O.value=p.value}function so(p,l){const _e=[...p?Ve.value.filter(xe=>xe.toLowerCase().includes(p.toLowerCase())).map(xe=>({value:xe})):Ve.value.map(xe=>({value:xe})),{value:"⚙️ 管理模板...",isSettings:!0}];l(_e)}function oo(p){p.isSettings?(W.value=!0,v.value=""):v.value=p.value}return(p,l)=>{const Y=Ze,_e=Ls,xe=_o,ds=Ht,fs=Jt,St=Ot,Fe=ke,Xe=je,ao=bo,At=Dt,ps=bs,Tt=zs,Vt=$o,lo=yo("Document"),ms=Bs,Yt=So,no=Co,io=zt,ro=is;return c(),w($e,null,[e("div",{class:pe(["card app-card",{"is-pushing":a(o).isPushing}])},[e("div",vn,[l[38]||(l[38]=e("h2",null,"提交更改",-1)),a(o).userName!==""&&a(o).userEmail!==""?(c(),w("div",gn,[t(ts,{modelValue:k.value,"onUpdate:modelValue":l[0]||(l[0]=x=>k.value=x),title:"提交模式",tooltip:"选择传统或标准化提交格式","active-text":"标准化","inactive-text":"普通","active-color":"#409eff",compact:""},{icon:s(()=>[t(Y,null,{default:s(()=>[t(a(dt))]),_:1})]),_:1},8,["modelValue"]),t(ts,{modelValue:le.value,"onUpdate:modelValue":l[1]||(l[1]=x=>le.value=x),title:"跳过钩子检查",tooltip:"添加 --no-verify 参数","active-color":"#f56c6c","icon-class":"warning",compact:""},{icon:s(()=>[t(Y,null,{default:s(()=>[t(a(gs))]),_:1})]),_:1},8,["modelValue"]),t(ts,{modelValue:ue.value,"onUpdate:modelValue":l[2]||(l[2]=x=>ue.value=x),title:"回车自动提交",tooltip:"输入提交信息后按回车直接执行一键推送","active-color":"#67c23a","icon-class":"success",compact:""},{icon:s(()=>[t(Y,null,{default:s(()=>[t(a(ft))]),_:1})]),_:1},8,["modelValue"])])):I("",!0),a(o).userName!==""&&a(o).userEmail!==""?(c(),w("div",hn,[t(Wl,{"has-user-commit-message":oe.value,"final-commit-message":ye.value,"skip-hooks":le.value,from:"form",onAfterCommit:l[3]||(l[3]=x=>{x&&re()}),onAfterPush:He,onBeforePush:Pe,onClearFields:re},null,8,["has-user-commit-message","final-commit-message","skip-hooks"])])):I("",!0)]),e("div",yn,[e("div",_n,[a(o).userName===""||a(o).userEmail===""?(c(),w("div",wn,[t(_e,{title:"Git用户信息未配置",type:"warning",closable:!1,"show-icon":""},{default:s(()=>l[39]||(l[39]=[e("p",null,"您需要配置Git用户名和邮箱才能提交代码。请使用以下命令配置：",-1),e("pre",{class:"config-command"},`git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"`,-1)])),_:1})])):(c(),w("div",bn,[t(Ll,{command:$t.value,title:"提交命令预览：",placeholder:'git commit -m "<提交信息>"'},null,8,["command"]),k.value?(c(),w("div",Cn,[e("div",Sn,[e("div",Tn,[t(fs,{modelValue:J.value,"onUpdate:modelValue":l[5]||(l[5]=x=>J.value=x),placeholder:"提交类型",class:"type-select",clearable:""},{default:s(()=>[(c(),w($e,null,Re(z,x=>t(ds,{key:x.value,label:x.label,value:x.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),e("div",Vn,[t(xe,{modelValue:O.value,"onUpdate:modelValue":l[6]||(l[6]=x=>O.value=x),"fetch-suggestions":Zs,placeholder:"作用域（可选）",class:"scope-input",clearable:"",onSelect:to},null,8,["modelValue"])]),e("div",xn,[t(xe,{modelValue:B.value,"onUpdate:modelValue":l[7]||(l[7]=x=>B.value=x),"fetch-suggestions":Xs,placeholder:mt.value,class:"description-input",clearable:"",onSelect:eo,onKeydown:us},null,8,["modelValue","placeholder"])])])]),e("div",{class:"advanced-options-toggle",onClick:l[8]||(l[8]=x=>De.value=!De.value)},[e("span",null,G(De.value?"收起":"正文及页脚"),1),t(Y,{class:pe(["toggle-icon",{"is-active":De.value}])},{default:s(()=>[t(a(yt))]),_:1},8,["class"])]),st(e("div",Fn,[t(St,{modelValue:M.value,"onUpdate:modelValue":l[9]||(l[9]=x=>M.value=x),type:"textarea",rows:4,placeholder:"正文（可选）：详细描述本次提交的内容和原因",class:"body-input",clearable:""},null,8,["modelValue"]),t(St,{modelValue:S.value,"onUpdate:modelValue":l[10]||(l[10]=x=>S.value=x),placeholder:"页脚（可选）：如 Closes #123",class:"footer-input",clearable:""},null,8,["modelValue"])],512),[[_t,De.value]])])):(c(),w("div",kn,[e("div",$n,[t(xe,{modelValue:v.value,"onUpdate:modelValue":l[4]||(l[4]=x=>v.value=x),"fetch-suggestions":so,placeholder:Je.value,type:"textarea",rows:3,resize:"none",class:"commit-message-input",onSelect:oo,onKeydown:us},null,8,["modelValue","placeholder"])])])),t(mn)]))])])],2),t(ao,{modelValue:Gt.value,"onUpdate:modelValue":l[13]||(l[13]=x=>Gt.value=x),title:"Git 操作",direction:"rtl",size:"362px","with-header":!0,"show-close":!0,"destroy-on-close":!1,class:"git-operations-drawer"},{default:s(()=>[e("div",Ln,[e("div",Bn,[e("div",zn,[e("div",Pn,[l[42]||(l[42]=e("div",{class:"group-title"},"基础操作",-1)),e("div",jn,[t(Ms,{onClick:()=>{},from:"drawer"}),t(Rs,{"has-user-commit-message":oe.value,"final-commit-message":ye.value,"skip-hooks":le.value,onBeforeCommit:()=>{},onAfterCommit:l[11]||(l[11]=x=>{x&&re()}),onClick:()=>{},from:"drawer"},null,8,["has-user-commit-message","final-commit-message","skip-hooks"]),t(Gs,{onBeforePush:()=>{},onAfterPush:l[12]||(l[12]=x=>{x&&ee()}),onClick:()=>{},from:"drawer"}),t(Xe,{content:Kt.value?`拉取${a(o).branchBehind}个远程提交`:"git pull",placement:"top"},{default:s(()=>[t(Fe,{type:"primary",icon:a(os),onClick:f,loading:a(o).isGitPulling,disabled:!a(o).hasUpstream,class:"action-button",style:bt(a(o).hasUpstream?{color:"white",backgroundColor:"#1e90ff",borderColor:"#1e90ff"}:{})},{default:s(()=>[l[40]||(l[40]=A(" 拉取 ")),Kt.value?(c(),w("span",Dn,"("+G(a(o).branchBehind)+")",1)):I("",!0)]),_:1},8,["icon","loading","disabled","style"])]),_:1},8,["content"]),t(Xe,{content:"git fetch --all",placement:"top"},{default:s(()=>[t(Fe,{type:"info",icon:a(gt),onClick:m,loading:a(o).isGitFetching,class:"action-button",style:{color:"white","background-color":"#1e90ff","border-color":"#1e90ff"}},{default:s(()=>l[41]||(l[41]=[A(" 获取所有远程分支 ")])),_:1},8,["icon","loading"])]),_:1})])]),e("div",On,[l[44]||(l[44]=e("div",{class:"group-title"},"组合操作",-1)),e("div",Mn,[t(Xe,{content:"git add + git commit",placement:"top"},{default:s(()=>[t(Fe,{type:"primary",icon:a(dt),onClick:L,loading:a(o).isAddingFiles||a(o).isCommiting,disabled:!Mt.value||!oe.value,class:"action-button"},{default:s(()=>l[43]||(l[43]=[A(" 暂存并提交 ")])),_:1},8,["icon","loading","disabled"])]),_:1}),t(Os,{from:"drawer","has-user-commit-message":oe.value,"final-commit-message":ye.value,"skip-hooks":le.value,onBeforePush:Pe,onAfterPush:He,onClearFields:re},null,8,["has-user-commit-message","final-commit-message","skip-hooks"])])])]),e("div",Rn,[l[47]||(l[47]=e("div",{class:"group-title"},"重置操作",-1)),e("div",Gn,[t(Xe,{content:cs.value?`撤销${Rt.value}个已暂存文件`:"git reset HEAD",placement:"top"},{default:s(()=>[t(Fe,{type:"warning",icon:a(ns),onClick:a(o).resetHead,loading:a(o).isResetting,disabled:!cs.value,class:"action-button reset-button"},{default:s(()=>[l[45]||(l[45]=A(" 重置暂存区 ")),Rt.value>0?(c(),w("span",An,"("+G(Rt.value)+")",1)):I("",!0)]),_:1},8,["icon","onClick","loading","disabled"])]),_:1},8,["content"]),t(Xe,{content:"git reset --hard origin/branch",placement:"top"},{default:s(()=>[t(Fe,{type:"danger",icon:a(Bt),onClick:C,loading:a(o).isResetting,disabled:!Hs.value,class:"action-button danger-button"},{default:s(()=>l[46]||(l[46]=[A(" 重置到远程 ")])),_:1},8,["icon","loading","disabled"])]),_:1})])]),e("div",Un,[l[49]||(l[49]=e("div",{class:"group-title"},"分支操作",-1)),e("div",En,[t(Xe,{content:"合并其他分支到当前分支",placement:"top"},{default:s(()=>[t(Fe,{type:"primary",icon:a(wo),onClick:qs,loading:a(o).isGitMerging,class:"action-button merge-button"},{default:s(()=>l[48]||(l[48]=[A(" 合并分支 ")])),_:1},8,["icon","loading"])]),_:1})])]),e("div",In,[l[52]||(l[52]=e("div",{class:"group-title"},"储藏操作",-1)),e("div",Nn,[t(Xe,{content:"将工作区更改储藏起来",placement:"top"},{default:s(()=>[t(Fe,{type:"warning",onClick:lt,loading:a(o).isSavingStash,disabled:!Is.value,class:"action-button"},{default:s(()=>l[50]||(l[50]=[A(" 储藏更改 ")])),_:1},8,["loading","disabled"])]),_:1}),t(Xe,{content:"查看和管理所有储藏记录",placement:"top"},{default:s(()=>[t(Fe,{type:"info",onClick:We,class:"action-button"},{default:s(()=>l[51]||(l[51]=[A(" 储藏列表 ")])),_:1})]),_:1})])])])])]),_:1},8,["modelValue"]),t(Ke,{modelValue:Q.value,"onUpdate:modelValue":l[16]||(l[16]=x=>Q.value=x),title:"编辑配置 JSON",size:"large","height-mode":"fixed","custom-class":"config-editor-dialog","show-footer":!1},{default:s(()=>[e("div",Hn,[e("div",Jn,[t(Y,{class:"info-icon"},{default:s(()=>[t(a(dt))]),_:1}),l[53]||(l[53]=e("span",{class:"info-text"},"编辑当前项目的配置文件",-1))]),e("div",Wn,[t(At,{size:"small",type:"info"},{default:s(()=>l[54]||(l[54]=[A("支持JSON格式")])),_:1})])]),e("div",qn,[t(St,{modelValue:se.value,"onUpdate:modelValue":l[14]||(l[14]=x=>se.value=x),type:"textarea",spellcheck:"false",autocomplete:"off",placeholder:"在此编辑当前项目配置的 JSON...",class:"json-editor"},null,8,["modelValue"])]),e("div",Kn,[e("div",Yn,[t(Fe,{icon:a(gt),onClick:nt,class:"system-config-btn"},{default:s(()=>l[55]||(l[55]=[A(" 打开系统配置文件 ")])),_:1},8,["icon"])]),e("div",Qn,[t(Fe,{onClick:l[15]||(l[15]=x=>Q.value=!1)},{default:s(()=>l[56]||(l[56]=[A("取消")])),_:1}),t(Fe,{type:"primary",loading:D.value,icon:a(ft),onClick:at,class:"save-btn"},{default:s(()=>l[57]||(l[57]=[A(" 保存配置 ")])),_:1},8,["loading","icon"])])])]),_:1},8,["modelValue"]),t(ps,{modelValue:ve.value,"onUpdate:modelValue":l[20]||(l[20]=x=>ve.value=x),title:"配置文件格式提示",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{footer:s(()=>[e("span",ei,[t(Fe,{onClick:l[17]||(l[17]=x=>Ae("cancel"))},{default:s(()=>l[58]||(l[58]=[A("取消")])),_:1}),t(Fe,{type:"info",onClick:l[18]||(l[18]=x=>Ae("open"))},{default:s(()=>l[59]||(l[59]=[A("打开系统配置文件")])),_:1}),t(Fe,{type:"primary",onClick:l[19]||(l[19]=x=>Ae("continue"))},{default:s(()=>l[60]||(l[60]=[A("继续编辑")])),_:1})])]),default:s(()=>[e("div",Xn,[t(Y,{class:"warning-icon",color:"#f56c6c",size:"24"},{default:s(()=>[t(a(gs))]),_:1}),e("p",Zn,G(te.value),1)])]),_:1},8,["modelValue"]),t(es,{visible:P.value,"onUpdate:visible":l[21]||(l[21]=x=>P.value=x),type:"description",title:"简短描述模板设置",placeholder:"输入新模板内容","edit-placeholder":"编辑模板内容","empty-description":"暂无保存的模板",onUseTemplate:Ee},null,8,["visible"]),t(es,{visible:ge.value,"onUpdate:visible":l[22]||(l[22]=x=>ge.value=x),type:"scope",title:"作用域模板设置",placeholder:"输入新作用域模板","edit-placeholder":"编辑作用域模板内容","empty-description":"暂无保存的作用域",onUseTemplate:Ct},null,8,["visible"]),t(es,{visible:W.value,"onUpdate:visible":l[23]||(l[23]=x=>W.value=x),type:"message",title:"默认提交信息设置",placeholder:"输入新模板内容","edit-placeholder":"编辑模板内容","empty-description":"暂无保存的模板","show-default-section":!0,"show-help-text":!0,onUseTemplate:Js,onSetDefault:Ws},null,8,["visible"]),t(Ke,{modelValue:F.value,"onUpdate:modelValue":l[27]||(l[27]=x=>F.value=x),title:"储藏更改 (Git Stash)",size:"medium","close-on-click-modal":!1,"show-footer":"","confirm-text":"储藏","cancel-text":"取消","confirm-loading":a(o).isSavingStash,"custom-class":"stash-dialog",onConfirm:T},{default:s(()=>[e("div",ti,[e("div",si,[e("div",oi,[t(Y,null,{default:s(()=>[t(a(ko))]),_:1})]),l[61]||(l[61]=e("div",{class:"info-content"},[e("h4",null,"储藏工作区更改"),e("p",null,"将当前工作区的更改临时保存，稍后可以重新应用到任何分支")],-1))]),t(ms,{"label-position":"top",class:"stash-form"},{default:s(()=>[t(Tt,{label:"储藏说明"},{default:s(()=>[t(St,{modelValue:ae.value,"onUpdate:modelValue":l[24]||(l[24]=x=>ae.value=x),placeholder:"为这次储藏添加描述信息（可选）",clearable:"",rows:2,type:"textarea",resize:"none",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),e("div",ai,[e("h5",li,[t(Y,null,{default:s(()=>[t(a(Ps))]),_:1}),l[62]||(l[62]=A(" 储藏选项 "))]),e("div",ni,[t(Vt,{modelValue:Ce.value,"onUpdate:modelValue":l[25]||(l[25]=x=>Ce.value=x),size:"large"},{default:s(()=>l[63]||(l[63]=[e("span",{class:"option-label"},"包含未跟踪文件",-1)])),_:1},8,["modelValue"]),l[64]||(l[64]=e("p",{class:"option-desc"},"同时储藏新建但未添加到Git的文件 (--include-untracked)",-1))]),e("div",ii,[t(Vt,{modelValue:Se.value,"onUpdate:modelValue":l[26]||(l[26]=x=>Se.value=x),disabled:qt.value,size:"large"},{default:s(()=>l[65]||(l[65]=[e("span",{class:"option-label"},"排除锁定文件",-1)])),_:1},8,["modelValue","disabled"]),e("p",{class:pe(["option-desc",{disabled:qt.value}])}," 不储藏被锁定的文件，保持其当前状态 ",2)])]),a(o).status.staged.length>0||a(o).status.unstaged.length>0?(c(),w("div",ri,[e("h5",ci,[t(Y,null,{default:s(()=>[t(lo)]),_:1}),l[66]||(l[66]=A(" 将要储藏的文件 "))]),e("div",ui,[a(o).status.staged.length>0?(c(),N(At,{key:0,type:"success"},{default:s(()=>[A(" 已暂存: "+G(a(o).status.staged.length)+" 个文件 ",1)]),_:1})):I("",!0),a(o).status.unstaged.length>0?(c(),N(At,{key:1,type:"warning"},{default:s(()=>[A(" 未暂存: "+G(a(o).status.unstaged.length)+" 个文件 ",1)]),_:1})):I("",!0)])])):I("",!0)]),_:1})])]),_:1},8,["modelValue","confirm-loading"]),t(ps,{title:"合并分支",modelValue:H.value,"onUpdate:modelValue":l[35]||(l[35]=x=>H.value=x),width:"500px","close-on-click-modal":!1,class:"merge-dialog"},{footer:s(()=>[e("div",mi,[t(Fe,{onClick:l[34]||(l[34]=x=>H.value=!1)},{default:s(()=>l[73]||(l[73]=[A("取消")])),_:1}),t(Fe,{type:"primary",onClick:Ys,loading:a(o).isGitMerging,disabled:!ce.value,class:"merge-confirm-btn"},{default:s(()=>l[74]||(l[74]=[A(" 合并 ")])),_:1},8,["loading","disabled"])])]),default:s(()=>[e("div",di,[e("p",fi,"选择要合并到当前分支 ("+G(a(o).currentBranch)+") 的分支:",1),t(ms,{"label-position":"top"},{default:s(()=>[t(Tt,{label:"分支类型"},{default:s(()=>[t(no,{modelValue:vt.value,"onUpdate:modelValue":l[28]||(l[28]=x=>vt.value=x),size:"small"},{default:s(()=>[t(Yt,{label:"all"},{default:s(()=>l[67]||(l[67]=[A("所有分支")])),_:1}),t(Yt,{label:"local"},{default:s(()=>l[68]||(l[68]=[A("本地分支")])),_:1}),t(Yt,{label:"remote"},{default:s(()=>l[69]||(l[69]=[A("远程分支")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(Tt,{label:"选择分支"},{default:s(()=>[t(fs,{modelValue:ce.value,"onUpdate:modelValue":l[29]||(l[29]=x=>ce.value=x),placeholder:"选择要合并的分支",style:{width:"100%"},filterable:""},{default:s(()=>[(c(!0),w($e,null,Re(Ks.value,x=>(c(),N(ds,{key:x,label:x,value:x},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(Tt,{label:"合并选项"},{default:s(()=>[e("div",pi,[t(Vt,{modelValue:fe.value.noFf,"onUpdate:modelValue":l[30]||(l[30]=x=>fe.value.noFf=x)},{default:s(()=>[t(Xe,{content:"创建合并提交，即使可以使用快进合并",placement:"top"},{default:s(()=>l[70]||(l[70]=[e("span",null,"禁用快进合并 (--no-ff)",-1)])),_:1})]),_:1},8,["modelValue"]),t(Vt,{modelValue:fe.value.squash,"onUpdate:modelValue":l[31]||(l[31]=x=>fe.value.squash=x)},{default:s(()=>[t(Xe,{content:"将多个提交压缩为一个提交",placement:"top"},{default:s(()=>l[71]||(l[71]=[e("span",null,"压缩提交 (--squash)",-1)])),_:1})]),_:1},8,["modelValue"]),t(Vt,{modelValue:fe.value.noCommit,"onUpdate:modelValue":l[32]||(l[32]=x=>fe.value.noCommit=x)},{default:s(()=>[t(Xe,{content:"执行合并但不自动创建提交",placement:"top"},{default:s(()=>l[72]||(l[72]=[e("span",null,"不自动提交 (--no-commit)",-1)])),_:1})]),_:1},8,["modelValue"])])]),_:1}),fe.value.noFf&&!fe.value.noCommit?(c(),N(Tt,{key:0,label:"合并提交信息 (可选)"},{default:s(()=>[t(St,{modelValue:fe.value.message,"onUpdate:modelValue":l[33]||(l[33]=x=>fe.value.message=x),type:"textarea",rows:3,placeholder:"输入自定义合并提交信息"},null,8,["modelValue"])]),_:1})):I("",!0)]),_:1})])]),_:1},8,["modelValue"]),t(Ke,{modelValue:ie.value,"onUpdate:modelValue":l[36]||(l[36]=x=>ie.value=x),title:"储藏列表 (Git Stash)",size:"large","show-footer":!1,"custom-class":"stash-list-dialog"},{default:s(()=>[e("div",vi,[a(o).isLoadingStashes?I("",!0):(c(),w("div",gi,[e("div",hi,[e("div",yi,[t(Y,{class:"stat-icon"},{default:s(()=>[t(a(gt))]),_:1}),e("span",_i,G(a(o).stashes.length),1),l[75]||(l[75]=e("span",{class:"stat-label"},"个储藏",-1))])]),a(o).stashes.length>0?(c(),w("div",wi,[t(Fe,{type:"danger",size:"small",icon:a(Bt),onClick:de,loading:a(o).isDroppingStash,class:"clear-all-btn"},{default:s(()=>l[76]||(l[76]=[A(" 清空所有储藏 ")])),_:1},8,["icon","loading"])])):I("",!0)])),st((c(),w("div",bi,[a(o).stashes.length===0&&!a(o).isLoadingStashes?(c(),w("div",ki,[t(io,{description:"暂无储藏记录","image-size":120},{image:s(()=>[t(Y,{class:"empty-icon"},{default:s(()=>[t(a(gt))]),_:1})]),description:s(()=>l[77]||(l[77]=[e("p",{class:"empty-text"},"还没有任何储藏记录",-1),e("p",{class:"empty-hint"},"使用 git stash 可以临时保存工作进度",-1)])),_:1})])):(c(),w("div",$i,[(c(!0),w($e,null,Re(a(o).stashes,(x,vs)=>(c(),w("div",{key:x.id,class:pe(["stash-card",{"stash-card-latest":vs===0}])},[e("div",Ci,[e("div",Si,[e("div",Ti,[e("div",Vi,[t(Y,{class:"badge-icon"},{default:s(()=>[t(a(gt))]),_:1}),e("span",xi,G(x.id),1),vs===0?(c(),N(At,{key:0,size:"small",type:"success",class:"latest-tag"},{default:s(()=>l[78]||(l[78]=[A("最新")])),_:1})):I("",!0)]),e("div",Fi,[e("span",Li,G(x.description),1)])])]),e("div",Bi,[t(Fe,{size:"small",type:"info",icon:a(dt),onClick:Qt=>Te(x),loading:Me.value,class:"action-btn view-btn"},{default:s(()=>l[79]||(l[79]=[A(" 查看 ")])),_:2},1032,["icon","onClick","loading"]),t(Fe,{size:"small",type:"success",icon:a(os),onClick:Qt=>r(x.id,!1),loading:a(o).isApplyingStash,class:"action-btn apply-btn"},{default:s(()=>l[80]||(l[80]=[A(" 应用 ")])),_:2},1032,["icon","onClick","loading"]),t(Fe,{size:"small",type:"primary",icon:a(ft),onClick:Qt=>r(x.id,!0),loading:a(o).isApplyingStash,class:"action-btn apply-pop-btn"},{default:s(()=>l[81]||(l[81]=[A(" 应用并删除 ")])),_:2},1032,["icon","onClick","loading"]),t(Fe,{size:"small",type:"danger",icon:a(Bt),onClick:Qt=>X(x.id),loading:a(o).isDroppingStash,class:"action-btn delete-btn"},{default:s(()=>l[82]||(l[82]=[A(" 删除 ")])),_:2},1032,["icon","onClick","loading"])])])],2))),128))]))])),[[ro,a(o).isLoadingStashes]])])]),_:1},8,["modelValue"]),t(Ke,{modelValue:Oe.value,"onUpdate:modelValue":l[37]||(l[37]=x=>Oe.value=x),title:"储藏详情","custom-class":"stash-detail-dialog",size:"extra-large",type:"flex","close-on-click-modal":!1},{default:s(()=>[e("div",zi,[we.value?(c(),w("div",Pi,[e("div",ji,[l[83]||(l[83]=e("span",{class:"info-label"},"Stash ID:",-1)),e("code",Di,G(we.value.id),1)]),e("div",Oi,[l[84]||(l[84]=e("span",{class:"info-label"},"描述:",-1)),e("span",Mi,G(we.value.description),1)])])):I("",!0),e("div",Ri,[t(rs,{files:kt.value,diffContent:Le.value,selectedFile:et.value,context:"stash-detail",emptyText:"该stash没有变更文件",onFileSelect:be,onOpenFile:he,onOpenWithVscode:Ue},null,8,["files","diffContent","selectedFile"])])])]),_:1},8,["modelValue"]),t(jt,{name:"el-fade-in-linear"},{default:s(()=>[V.value?(c(),w("div",Gi,[t(Y,{class:"is-loading"},{default:s(()=>[t(a(js))]),_:1}),l[85]||(l[85]=e("span",null,"更新状态中...",-1))])):I("",!0)]),_:1}),t(sl,{visible:a(u).visible,text:a(u).text,"show-progress":a(u).showProgress,progress:a(u).progress},null,8,["visible","text","show-progress","progress"]),t(il,{visible:a(Z).visible,text:a(Z).text,description:a(Z).description},null,8,["visible","text","description"])],64)}}}),Ui=ze(Ai,[["__scopeId","data-v-3859ad8a"]]),Ei={class:"log-header"},Ii={class:"log-actions"},Ni={key:0,class:"filter-panel-header"},Hi={class:"filter-form"},Ji={class:"filter-item"},Wi={class:"filter-item"},qi={class:"filter-item"},Ki={class:"filter-item"},Yi={class:"filter-actions"},Qi={key:0},Xi={key:1,class:"content-area-content"},Zi={key:0,class:"graph-view"},er={class:"graph-controls"},tr={class:"zoom-controls"},sr={class:"scale-info"},or={key:1,class:"table-view-container"},ar=["onClick"],lr={class:"commit-message-cell"},nr={class:"message-content"},ir={key:0,class:"branch-container"},rr={class:"message-text"},cr={class:"author-name"};const ur={class:"commit-detail-container"},dr={key:0,class:"commit-info"},fr={class:"commit-info-row"},pr={class:"info-item date-item"},mr={class:"info-value"},vr={class:"info-item message-item"},gr=["innerHTML"],Ft=.5,It=1.5,ss=.1,hr=Be({__name:"LogList",setup(q,{expose:b}){const o=ot();let i=[];const v=d(i),u=d(""),j=d(!1),_=K(()=>o.isLoadingLog||j.value),R=d(!1),Z=d(0),E=d(!1),V=d(null),h=d(1),U=d(!0),k=d(!1),J=d(null),O=d(!1),B=d(null),M=d([]),S=d(""),Q=d(!1),se=d(""),D=d(1),ve=d(!1),te=d(!1),y=d([]),P=d(""),H=d(null),ce=d([]),fe=d([]),me=d([]),ge=d(!1),W=d(0),le=d(0),ue=d(null),De=K(()=>v.value),z=K(()=>M.value.map($=>({path:$,name:$.split("/").pop()||$})));async function F($=!1,g=1){if(!ot().isGitRepo){u.value="当前目录不是Git仓库";return}try{g>1?k.value=!0:j.value=!0;const f=new URLSearchParams;f.append("page",g.toString()),f.append("all",$.toString()),f.append("with_parents","true"),y.value.length>0&&f.append("author",y.value.join(",")),fe.value.length>0&&f.append("branch",fe.value.join(",")),P.value&&f.append("message",P.value),H.value&&Array.isArray(H.value)&&H.value.length===2&&(f.append("dateFrom",H.value[0]),f.append("dateTo",H.value[1])),f.append("_t",Date.now().toString());const L=await(await fetch(`/api/log?${f.toString()}`)).json();if(!L||!L.data||!Array.isArray(L.data)){u.value="加载提交历史失败: 服务器返回数据格式不正确";return}const C=g>1;C?L.data.forEach(re=>i.push(re)):(i.length=0,L.data.forEach(re=>i.push(re))),v.value=[...i],h.value=g,Z.value=L.total||i.length,U.value=L.hasMore===!0,C||(ve.value=!0,setTimeout(()=>{ve.value=!1},2e3)),!C&&E.value?setTimeout(ie,0):!C&&!E.value&&!$&&ct(()=>{Me(),setTimeout(it,200)}),u.value=""}catch(f){u.value="加载提交历史失败: "+(f instanceof Error?f.message:String(f)),g>1&&(U.value=!1)}finally{g>1?k.value=!1:j.value=!1}}async function ie(){if(V.value&&i.length!==0)try{V.value.innerHTML="";const $=Oo(V.value,{orientation:"vertical-reverse",template:"metro",author:"提交者 <committer@example.com>"}),g={},ee=$.branch(o.currentBranch||"main");g[o.currentBranch||"main"]=ee,i.forEach(f=>{let m=ee;if(f.branch){const L=Se(f.branch.split(",")[0]);g[L]||(g[L]=$.branch(L)),m=g[L]}m.commit({hash:f.hash,subject:f.message,author:`${f.author} <${f.email}>`})}),setTimeout(()=>{We()},100)}catch($){u.value="渲染图表失败: "+($ instanceof Error?$.message:String($))}}function ae(){E.value=!E.value,E.value&&i.length>0&&setTimeout(ie,0)}function Ce(){R.value=!R.value,R.value||(U.value=!0),h.value=1,F(R.value),ct(()=>{setTimeout(()=>{!E.value&&!R.value&&(Me(),it())},300)})}function Se($){return $.includes("HEAD -> ")?$.replace("HEAD -> ",""):$.includes("origin/")?$:$.trim()}function Oe($){return $.includes("HEAD")?"success":$.includes("origin/")?"warning":"info"}const we=d(null),ne=d(null);function Le($){if(E.value||!U.value||k.value||_.value)return;const g=$.target,{scrollTop:ee,scrollHeight:f,clientHeight:m}=g;f-ee-m<=20&&be()}function Me(){if(!we.value)return;const $=we.value.$el.querySelector(".el-table__body-wrapper");$&&(ne.value=$,ne.value&&(ne.value.removeEventListener("scroll",Le,!0),ne.value.addEventListener("scroll",Le,!0)))}function et(){ne.value&&(ne.value.removeEventListener("scroll",Le,!0),ne.value=null)}function lt($){$.key==="Escape"&&Ee.value&&(Ee.value=!1)}pt(()=>{o.isGitRepo?(o.log.length>0?(i.length=0,o.log.forEach($=>i.push($)),Z.value=o.log.length,E.value&&setTimeout(()=>{ie()},100)):F(),Ve()):u.value="当前目录不是Git仓库",ct(()=>{setTimeout(()=>{Me()},500)}),Ge(()=>we.value,$=>{$&&!E.value&&!R.value&&ct(()=>{Me()})}),window.addEventListener("keydown",lt)}),Ge(()=>o.allBranches,$=>{$&&$.length>0?me.value=[...$].sort():me.value=[]},{immediate:!0}),To(()=>{et(),J.value!==null&&(window.clearInterval(J.value),J.value=null),window.removeEventListener("keydown",lt)});async function Qe(){await o.fetchLog(!0),i.length=0,o.log.forEach($=>i.push($)),v.value=[...i],Z.value=o.log.length,h.value=1,U.value=!1,ve.value=!0,setTimeout(()=>{ve.value=!1},2e3),E.value&&(await ct(),ie())}Ge(()=>o.log,$=>{try{i.length=0,Array.isArray($)&&$.forEach(g=>g&&i.push(g)),Z.value=i.length,h.value=1,v.value=[...i],ve.value=!0,setTimeout(()=>{ve.value=!1},2e3),E.value&&i.length>0&&setTimeout(ie,0)}catch{}},{immediate:!0}),b({refreshLog:Qe});function at(){D.value<It&&(D.value=Math.min(It,D.value+ss),Ae())}function nt(){D.value>Ft&&(D.value=Math.max(Ft,D.value-ss),Ae())}function Ae(){if(!V.value)return;const $=V.value.querySelector("svg");$&&($.style.transform=`scale(${D.value})`,$.style.transformOrigin="top left")}function We(){if(!V.value)return;const $=V.value.querySelector("svg");if(!$)return;const g=$.getBoundingClientRect().width/D.value,ee=V.value.clientWidth;g>ee?D.value=Math.max(Ft,ee/g):D.value=1,Ae()}async function T($){if($){B.value=$,O.value=!0,Q.value=!0,M.value=[],S.value="",se.value="";try{if(!$.hash||$.hash.length<7){S.value="无效的提交哈希值",Q.value=!1;return}const ee=await(await fetch(`/api/commit-files?hash=${$.hash}`)).json();ee.success&&Array.isArray(ee.files)?(M.value=ee.files,M.value.length>0?await r($.hash,M.value[0]):S.value="该提交没有变更文件"):S.value=`获取文件列表失败: ${ee.error||"未知错误"}`}catch(g){S.value=`获取提交详情失败: ${g.message}`}finally{Q.value=!1}}}async function r($,g){Q.value=!0,se.value=g;try{const f=await(await fetch(`/api/commit-file-diff?hash=${$}&file=${encodeURIComponent(g)}`)).json();f.success?S.value=f.diff||"没有变更内容":S.value=`获取差异失败: ${f.error||"未知错误"}`}catch(ee){S.value=`获取差异失败: ${ee.message}`}finally{Q.value=!1}}function X($){B.value&&r(B.value.hash,$)}async function de($,g){try{const f=await(await fetch("/api/open-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:$,context:g})})).json();f.success?n.success(f.message):n.error(f.error||"打开文件失败")}catch(ee){n.error(`打开文件失败: ${ee.message}`)}}async function Te($,g){try{const f=await(await fetch("/api/open-with-vscode",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:$,context:g})})).json();f.success?n.success(f.message):n.error(f.error||"用VSCode打开文件失败")}catch(ee){n.error(`用VSCode打开文件失败: ${ee.message}`)}}async function Ne($){try{const g=Wo($);await navigator.clipboard.writeText(g),n.success("提交信息已复制到剪贴板")}catch{n.error("复制失败")}}function be(){!U.value||k.value||_.value||F(R.value,h.value+1)}function he(){y.value=[],fe.value=[],P.value="",H.value=null,h.value=1,F(R.value,1)}function Ue(){h.value=1,F(R.value,1)}async function Ve(){try{const g=await(await fetch("/api/authors")).json();g.success&&Array.isArray(g.authors)?ce.value=g.authors.sort():ye()}catch{ye()}}function ye(){const $=new Set;v.value.forEach(g=>{g.author&&$.add(g.author)}),ce.value=Array.from($).sort()}Ge(()=>v.value,()=>{},{deep:!0});function oe($,g,ee){ee.preventDefault(),W.value=ee.clientY,le.value=ee.clientX,ue.value=$,ge.value=!0;const f=()=>{ge.value=!1,document.removeEventListener("click",f)};setTimeout(()=>{document.addEventListener("click",f)},0)}async function Je($){if($)try{await Ye.confirm(`确定要撤销提交 ${$.hash.substring(0,7)} 吗？这将创建一个新的提交来撤销这次提交的更改。`,"撤销提交确认",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const ee=await(await fetch("/api/revert-commit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hash:$.hash})})).json();ee.success?(n.success(ee.message||"已成功撤销提交"),Qe(),o.fetchStatus(),o.getBranchStatus()):n.error(ee.error||"撤销提交失败")}catch(g){g!=="cancel"&&n.error("撤销提交失败: "+(g.message||g))}}async function mt($){if($)try{await Ye.confirm(`确定要将提交 ${$.hash.substring(0,7)} Cherry-Pick 到当前分支吗？`,"Cherry-Pick确认",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const ee=await(await fetch("/api/cherry-pick-commit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hash:$.hash})})).json();ee.success?(n.success(ee.message||"已成功Cherry-Pick提交"),Qe(),o.fetchStatus(),o.getBranchStatus()):n.error(ee.error||"Cherry-Pick提交失败")}catch(g){g!=="cancel"&&n.error("Cherry-Pick提交失败: "+(g.message||g))}}async function kt($){if($)try{await navigator.clipboard.writeText($.hash),n.success(`已复制提交哈希: ${$.hash.substring(0,7)}`)}catch(g){n.error(`复制提交哈希失败: ${g.message}`)}}async function $t($){if($)try{await Ye.confirm(`确定要将当前分支重置(hard)到提交 ${$.hash.substring(0,7)} 吗？
      
      警告：这将丢失该提交之后的所有更改！`,"重置确认",{confirmButtonText:"确认重置",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0});const ee=await(await fetch("/api/reset-to-commit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hash:$.hash})})).json();ee.success?(n.success(ee.message||"已成功重置到指定提交"),Qe(),o.fetchStatus(),o.getBranchStatus()):n.error(ee.error||"重置到指定提交失败")}catch(g){g!=="cancel"&&n.error("重置到指定提交失败: "+(g.message||g))}}function it(){if(E.value||!U.value||k.value||_.value||R.value)return;if(!ne.value){Me();return}const{scrollTop:$,scrollHeight:g,clientHeight:ee}=ne.value;g-$-ee<=50&&be()}Ge(()=>E.value,$=>{!$&&!R.value&&ct(()=>{Me(),setTimeout(it,200)})});const Ee=d(!1);function Ct(){Ee.value=!Ee.value,ct(()=>{E.value&&V.value&&ie()})}return($,g)=>{var L;const ee=Ze,f=je,m=is;return c(),w($e,null,[e("div",{class:pe(["card",{"fullscreen-mode":Ee.value}])},[e("div",Ei,[g[14]||(g[14]=e("div",{class:"header-left"},[e("h2",null,"提交历史")],-1)),e("div",Ii,[E.value?I("",!0):(c(),N(a(ke),{key:0,type:te.value?"primary":"default",size:"small",onClick:g[0]||(g[0]=C=>te.value=!te.value),class:pe(["action-button filter-button icon-only-button",{"active-filter":te.value}])},{icon:s(()=>[t(ee,null,{default:s(()=>[t(a(Vo))]),_:1})]),_:1},8,["type","class"])),t(a(ke),{type:"primary",size:"small",onClick:ae,class:pe(["action-button view-mode-button icon-only-button",{"active-view":E.value}])},{icon:s(()=>[t(ee,null,{default:s(()=>[(c(),N(Lt(E.value?a(Wt):a(xo))))]),_:1})]),_:1},8,["class"]),st(t(a(ke),{type:"success",size:"small",onClick:Ce,loading:_.value,class:pe(["action-button commit-display-button",{"active-commits":R.value}])},{icon:s(()=>[t(ee,null,{default:s(()=>[(c(),N(Lt(R.value?a(Fo):a(Lo))))]),_:1})]),default:s(()=>[A(" "+G(R.value?"显示分页加载":"显示所有提交"),1)]),_:1},8,["loading","class"]),[[_t,!1]]),t(a(ke),{type:"info",size:"small",onClick:Ct,class:pe(["action-button fullscreen-button icon-only-button",{"active-fullscreen":Ee.value}])},{icon:s(()=>[t(ee,null,{default:s(()=>[(c(),N(Lt(Ee.value?a(ls):a(Fs))))]),_:1})]),_:1},8,["class"]),t(a(ke),{circle:"",size:"small",onClick:g[1]||(g[1]=C=>Qe()),class:pe([{"refresh-button-animated":ve.value},"action-button refresh-button"])},{default:s(()=>[_.value?(c(),N(ee,{key:1},{default:s(()=>[t(a(js))]),_:1})):(c(),N(ee,{key:0},{default:s(()=>[t(a(ns))]),_:1}))]),_:1},8,["class"])])]),te.value&&!E.value?(c(),w("div",Ni,[e("div",Hi,[e("div",Ji,[t(a(Jt),{modelValue:y.value,"onUpdate:modelValue":g[2]||(g[2]=C=>y.value=C),placeholder:"选择作者",multiple:"",clearable:"",filterable:"",class:"filter-input",size:"small"},{prefix:s(()=>g[15]||(g[15]=[e("span",{class:"compact-label"},"作者",-1)])),default:s(()=>[(c(!0),w($e,null,Re(ce.value,C=>(c(),N(a(Ht),{key:C,label:C,value:C},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),e("div",Wi,[t(a(Jt),{modelValue:fe.value,"onUpdate:modelValue":g[3]||(g[3]=C=>fe.value=C),placeholder:"选择分支",multiple:"",clearable:"",filterable:"",class:"filter-input",size:"small"},{prefix:s(()=>g[16]||(g[16]=[e("span",{class:"compact-label"},"分支",-1)])),default:s(()=>[(c(!0),w($e,null,Re(me.value,C=>(c(),N(a(Ht),{key:C,label:C,value:C},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),e("div",qi,[t(a(Ot),{modelValue:P.value,"onUpdate:modelValue":g[4]||(g[4]=C=>P.value=C),placeholder:"提交信息关键词",clearable:"",class:"filter-input",size:"small"},{prefix:s(()=>g[17]||(g[17]=[e("span",{class:"compact-label"},"信息",-1)])),_:1},8,["modelValue"])]),e("div",Ki,[t(a(Bo),{modelValue:H.value,"onUpdate:modelValue":g[5]||(g[5]=C=>H.value=C),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"filter-input date-range",size:"small"},{prefix:s(()=>g[18]||(g[18]=[e("span",{class:"compact-label"},"日期",-1)])),_:1},8,["modelValue"])]),e("div",Yi,[t(a(ke),{type:"primary",size:"small",onClick:Ue,class:"filter-action-button"},{default:s(()=>g[19]||(g[19]=[A("应用")])),_:1}),t(a(ke),{type:"info",size:"small",onClick:he,class:"filter-action-button"},{default:s(()=>g[20]||(g[20]=[A("重置")])),_:1})])])])):I("",!0),e("div",{class:pe(["content-area",{"with-filter":te.value&&!E.value}])},[u.value?(c(),w("div",Qi,G(u.value),1)):(c(),w("div",Xi,[E.value?(c(),w("div",Zi,[e("div",er,[e("div",tr,[t(a(ke),{type:"primary",circle:"",size:"small",onClick:nt,disabled:D.value<=Ft},{default:s(()=>[t(ee,null,{default:s(()=>[t(a(zo))]),_:1})]),_:1},8,["disabled"]),t(a(Po),{modelValue:D.value,"onUpdate:modelValue":g[6]||(g[6]=C=>D.value=C),min:Ft,max:It,step:ss,onChange:Ae,class:"zoom-slider"},null,8,["modelValue"]),t(a(ke),{type:"primary",circle:"",size:"small",onClick:at,disabled:D.value>=It},{default:s(()=>[t(ee,null,{default:s(()=>[t(a(jo))]),_:1})]),_:1},8,["disabled"]),t(a(ke),{type:"primary",size:"small",onClick:We},{default:s(()=>g[21]||(g[21]=[A(" 自适应大小 ")])),_:1})]),e("div",sr," 缩放: "+G(Math.round(D.value*100))+"% ",1)]),e("div",{ref_key:"graphContainer",ref:V,class:"graph-container"},null,512)])):(c(),w("div",or,[st((c(),N(a(Do),{ref_key:"tableRef",ref:we,data:De.value,stripe:"",border:"",class:"log-table","empty-text":_.value?"加载中...":"没有匹配的提交记录",height:"450",onRowContextmenu:oe,onRowClick:g[7]||(g[7]=C=>T(C))},{default:s(()=>[t(a(Ut),{label:"哈希",width:"80",resizable:""},{default:s(C=>[e("span",{class:"commit-hash",onClick:re=>T(C.row)},G(C.row.hash.substring(0,6)),9,ar)]),_:1}),t(a(Ut),{label:"提交信息","min-width":"300"},{default:s(C=>[e("div",lr,[e("div",nr,[C.row.branch?(c(),w("div",ir,[(c(!0),w($e,null,Re(C.row.branch.split(","),(re,Pe)=>(c(),N(a(Dt),{key:Pe,size:"small",type:Oe(re),class:"branch-tag"},{default:s(()=>[A(G(Se(re)),1)]),_:2},1032,["type"]))),128))])):I("",!0),e("span",rr,G(C.row.message),1),t(a(ke),{type:"text",icon:a(ht),size:"small",onClick:wt(re=>Ne(C.row.message),["stop"]),class:"copy-message-btn",title:"复制纯净提交信息（不含类型前缀）"},null,8,["icon","onClick"])])])]),_:1}),t(a(Ut),{prop:"date",label:"日期",width:"150",resizable:""}),t(a(Ut),{label:"作者",width:"100",resizable:""},{default:s(C=>[t(f,{content:C.row.email,placement:"top","hide-after":1e3,"show-after":200},{default:s(()=>[e("span",cr,G(C.row.author),1)]),_:2},1032,["content"])]),_:1})]),_:1},8,["data","empty-text"])),[[m,_.value]]),(R.value,I("",!0))]))]))],2),t(Ke,{modelValue:O.value,"onUpdate:modelValue":g[8]||(g[8]=C=>O.value=C),title:`提交详情: ${(L=B.value)!=null&&L.hash?B.value.hash.substring(0,7):"未知"}`,size:"extra-large",type:"flex","destroy-on-close":"","custom-class":"commit-detail-dialog"},{default:s(()=>[st((c(),w("div",ur,[B.value?(c(),w("div",dr,[e("div",fr,[e("div",pr,[g[25]||(g[25]=e("span",{class:"info-label"},"日期",-1)),e("span",mr,G(B.value.date),1)]),e("div",vr,[g[26]||(g[26]=e("span",{class:"info-label"},"提交信息",-1)),e("div",{class:"info-message",innerHTML:a(Jo)(B.value.message).replace(/\n/g,"<br>")},null,8,gr)])])])):I("",!0),t(rs,{files:z.value,loading:Q.value,diffContent:S.value,selectedFile:se.value,context:"commit-detail",emptyText:"没有找到变更文件",onFileSelect:X,onOpenFile:de,onOpenWithVscode:Te},null,8,["files","loading","diffContent","selectedFile"])])),[[m,Q.value]])]),_:1},8,["modelValue","title"])],2),st(e("div",{class:pe(["context-menu",{"fullscreen-context-menu":Ee.value}]),style:bt({top:W.value+"px",left:le.value+"px"})},[e("div",{class:"context-menu-item",onClick:g[9]||(g[9]=C=>T(ue.value))},g[27]||(g[27]=[e("i",{class:"el-icon-view"},null,-1),A(" 查看详情 ")])),e("div",{class:"context-menu-item",onClick:g[10]||(g[10]=C=>kt(ue.value))},g[28]||(g[28]=[e("i",{class:"el-icon-document-copy"},null,-1),A(" 复制提交哈希 ")])),e("div",{class:"context-menu-item",onClick:g[11]||(g[11]=C=>$t(ue.value))},g[29]||(g[29]=[e("i",{class:"el-icon-refresh-right"},null,-1),A(" 重置到该提交(hard) ")])),e("div",{class:"context-menu-item",onClick:g[12]||(g[12]=C=>Je(ue.value))},g[30]||(g[30]=[e("i",{class:"el-icon-delete"},null,-1),A(" 撤销提交 (Revert) ")])),e("div",{class:"context-menu-item",onClick:g[13]||(g[13]=C=>mt(ue.value))},g[31]||(g[31]=[e("i",{class:"el-icon-edit"},null,-1),A(" Cherry-Pick 到当前分支 ")]))],6),[[_t,ge.value]])],64)}}}),yr=ze(hr,[["__scopeId","data-v-850d6212"]]),_r={class:"dialog-toolbar"},wr=["disabled"],br=["disabled"],kr=["disabled"],$r={class:"history-scroll"},Cr={key:0,class:"loading-state"},Sr={key:2,class:"history-list"},Tr=["onClick"],Vr={class:"command-info"},xr={class:"command-text"},Fr={class:"command-meta"},Lr={class:"timestamp"},Br={class:"duration"},zr={class:"item-actions"},Pr=["onClick"],jr=["onClick"],Dr={key:0,class:"item-details"},Or={key:0,class:"output-section"},Mr={class:"output-header"},Rr=["onClick"],Gr={class:"output-content"},Ar={key:0,class:"truncation-notice"},Ur={class:"output-header"},Er={class:"output-content"},Ir={key:0,class:"truncation-notice"},Nr={key:2,class:"output-section error"},Hr={class:"output-content"},Jr=Be({__name:"CommandHistory",setup(q){const b=ot(),o=d([]),i=d(!1),v=d(!1),u=d(!1),j=d(!1),_=d(new Set),R=d(!1),Z=d(!1);function E(){Z.value=!0,o.value.length===0&&V()}async function V(){try{if(i.value=!0,b.socket&&b.socket.connected)b.socket.emit("request_full_history");else{const P=await(await fetch("/api/command-history")).json();P.success?o.value=P.history:n.error(`加载命令历史失败: ${P.error}`)}}catch(y){n.error(`加载命令历史失败: ${y.message}`)}finally{i.value=!1}}async function h(){if(o.value.length===0){n.warning("没有可复制的命令历史");return}try{u.value=!0;const y=o.value.map(P=>{let H=`# ${J(P.timestamp)} (耗时: ${O(P.executionTime)}) - ${P.success?"成功":"失败"}
`;if(H+=`${P.command}
`,P.stdout&&(H+=`
# 输出:
${P.stdout}
`),P.stderr){const ce=se(P.command)?"输出信息":"错误输出";H+=`
# ${ce}:
${P.stderr}
`}return P.error&&(H+=`
# 错误信息:
${P.error}
`),H}).join(`
---

`);await navigator.clipboard.writeText(y),n({message:"命令历史已复制到剪贴板",type:"success",zIndex:1e5})}catch(y){n.error(`复制失败: ${y.message}`)}finally{u.value=!1}}async function U(){if(o.value.length===0){n.warning("没有可复制的命令");return}try{R.value=!0;const y=o.value.map(P=>P.command).join(`
`);await navigator.clipboard.writeText(y),n({message:"命令列表已复制到剪贴板",type:"success",zIndex:1e5})}catch(y){n.error(`复制失败: ${y.message}`)}finally{R.value=!1}}async function k(){try{if(await Ye.confirm("确定要清空所有命令历史记录吗？此操作不可恢复。","清空命令历史",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),v.value=!0,b.socket&&b.socket.connected)b.socket.emit("clear_command_history");else{const P=await(await fetch("/api/clear-command-history",{method:"POST",headers:{"Content-Type":"application/json"}})).json();P.success?(o.value=[],n.success("命令历史已清空")):n.error(`清空命令历史失败: ${P.error}`)}}catch(y){y!=="cancel"&&y.toString()!=="Error: cancel"&&n.error(`清空命令历史失败: ${y.message}`)}finally{v.value=!1}}function J(y){return new Date(y).toLocaleString()}function O(y){return y<1e3?`${y}ms`:`${(y/1e3).toFixed(2)}s`}function B(y){_.value.has(y)?_.value.delete(y):_.value.add(y)}function M(y){return _.value.has(y)}async function S(y){try{await navigator.clipboard.writeText(y),n({message:"命令已复制到剪贴板",type:"success",zIndex:1e5})}catch(P){n.error(`复制失败: ${P.message}`)}}function Q(y){return y.includes("git push")||y.includes("git-push")}function se(y){return!!Q(y)}async function D(y){try{let P="";if(y.stdout&&(P+=`标准输出:
${y.stdout}

`),y.stderr){const H=se(y.command)?"输出信息":"错误输出";P+=`${H}:
${y.stderr}

`}y.error&&(P+=`错误信息:
${y.error}`),await navigator.clipboard.writeText(P.trim()),n({message:"输出已复制到剪贴板",type:"success",zIndex:1e5})}catch(P){n.error(`复制失败: ${P.message}`)}}function ve(){if(!b.socket){console.error("Socket实例不可用");return}b.socket.on("initial_command_history",y=>{o.value=y.history,j.value=!0}),b.socket.on("command_history_update",y=>{o.value.unshift(y.newCommand),o.value.length>100&&o.value.pop(),j.value=!0}),b.socket.on("full_command_history",y=>{o.value=y.history,i.value=!1,j.value=!0}),b.socket.on("command_history_cleared",y=>{y.success&&(o.value=[],n.success("命令历史已清空")),v.value=!1}),b.socket.on("connect",()=>{j.value=!0,n.success("已连接到实时命令历史")}),b.socket.on("disconnect",()=>{j.value=!1,n.warning("实时命令历史连接已断开")})}function te(){b.socket&&(b.socket.off("initial_command_history"),b.socket.off("command_history_update"),b.socket.off("full_command_history"),b.socket.off("command_history_cleared"))}return pt(()=>{ve(),b.socket||(console.log("尝试初始化Socket连接"),b.initSocketConnection())}),ws(()=>{te()}),(y,P)=>{const H=Ze,ce=je,fe=Dt,me=zt,ge=Ls;return c(),w($e,null,[t(ce,{content:"查看Git命令历史",placement:"bottom",effect:"dark","open-delay":500},{default:s(()=>[e("button",{class:"modern-btn command-history-button",onClick:E},[t(H,{class:"btn-icon"},{default:s(()=>[t(a(Ds))]),_:1})])]),_:1}),t(Ke,{modelValue:Z.value,"onUpdate:modelValue":P[0]||(P[0]=W=>Z.value=W),title:"Git 命令历史","destroy-on-close":"","custom-class":"command-history-dialog","append-to-body":!0},{default:s(()=>[e("div",_r,[t(fe,{type:j.value?"success":"danger",size:"small",effect:"dark",class:"socket-status"},{default:s(()=>[A(G(j.value?"实时更新":"未连接"),1)]),_:1},8,["type"]),t(ce,{content:"只复制命令列表（不含输出）",placement:"bottom",effect:"dark","open-delay":300},{default:s(()=>[e("button",{class:"modern-btn copy-commands-button enhanced-btn",onClick:U,disabled:o.value.length===0||R.value},[R.value?(c(),N(H,{key:1,class:"btn-icon is-loading"},{default:s(()=>P[1]||(P[1]=[e("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[e("path",{fill:"currentColor",d:"M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32zm0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32zm448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32zm-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32z"})],-1)])),_:1})):(c(),N(H,{key:0,class:"btn-icon"},{default:s(()=>[t(a(ht))]),_:1})),P[2]||(P[2]=e("span",{class:"btn-text"},"命令",-1))],8,wr)]),_:1}),t(ce,{content:"复制完整命令历史（含输出）",placement:"bottom",effect:"dark","open-delay":300},{default:s(()=>[e("button",{class:"modern-btn copy-all-button enhanced-btn",onClick:h,disabled:o.value.length===0||u.value},[u.value?(c(),N(H,{key:1,class:"btn-icon is-loading"},{default:s(()=>P[3]||(P[3]=[e("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[e("path",{fill:"currentColor",d:"M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32zm0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32zm448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32zm-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32z"})],-1)])),_:1})):(c(),N(H,{key:0,class:"btn-icon"},{default:s(()=>[t(a(ht))]),_:1})),P[4]||(P[4]=e("span",{class:"btn-text"},"全部",-1))],8,br)]),_:1}),t(ce,{content:"清空命令历史",placement:"bottom",effect:"dark","open-delay":300},{default:s(()=>[e("button",{class:"modern-btn clear-button enhanced-btn danger-btn",onClick:k,disabled:o.value.length===0||v.value},[v.value?(c(),N(H,{key:1,class:"btn-icon is-loading"},{default:s(()=>P[5]||(P[5]=[e("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[e("path",{fill:"currentColor",d:"M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32zm0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32zm448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32zm-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32z"})],-1)])),_:1})):(c(),N(H,{key:0,class:"btn-icon"},{default:s(()=>[t(a(Bt))]),_:1})),P[6]||(P[6]=e("span",{class:"btn-text"},"清空",-1))],8,kr)]),_:1})]),e("div",$r,[i.value&&o.value.length===0?(c(),w("div",Cr,[t(H,{class:"loading-icon is-loading"},{default:s(()=>P[7]||(P[7]=[e("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[e("path",{fill:"currentColor",d:"M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32zm0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32zm448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32zm-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32zM195.2 195.2a32 32 0 0 1 45.248 0L376.32 331.008a32 32 0 0 1-45.248 45.248L195.2 240.448a32 32 0 0 1 0-45.248zm452.544 452.544a32 32 0 0 1 45.248 0L828.8 783.552a32 32 0 0 1-45.248 45.248L647.744 692.992a32 32 0 0 1 0-45.248zM828.8 195.264a32 32 0 0 1 0 45.184L692.992 376.32a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0zm-452.544 452.48a32 32 0 0 1 0 45.248L240.448 828.8a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0z"})],-1)])),_:1}),P[8]||(P[8]=e("div",{class:"loading-text"},"加载命令历史...",-1))])):o.value.length===0?(c(),N(me,{key:1,description:"暂无命令历史"})):(c(),w("div",Sr,[(c(!0),w($e,null,Re(o.value,(W,le)=>(c(),w("div",{key:le,class:pe(["history-item",{"is-error":!W.success}])},[e("div",{class:"item-header",onClick:ue=>B(le)},[e("div",Vr,[e("div",xr,[t(fe,{size:"small",type:W.success?"success":"danger",effect:"dark",class:"status-tag"},{default:s(()=>[A(G(W.success?"成功":"失败"),1)]),_:2},1032,["type"]),e("code",null,G(W.command),1)]),e("div",Fr,[e("span",Lr,G(J(W.timestamp)),1),e("span",Br,"耗时: "+G(O(W.executionTime)),1)])]),e("div",zr,[t(ce,{content:"复制命令",placement:"bottom",effect:"dark","open-delay":300},{default:s(()=>[e("button",{class:"modern-btn item-copy-button enhanced-btn",onClick:wt(ue=>S(W.command),["stop"])},[t(H,{class:"btn-icon"},{default:s(()=>[t(a(ht))]),_:1})],8,Pr)]),_:2},1024),t(ce,{content:"展开/收起",placement:"bottom",effect:"dark","open-delay":300},{default:s(()=>[e("button",{class:pe(["modern-btn expand-button enhanced-btn",{"is-expanded":M(le)}]),onClick:wt(ue=>B(le),["stop"])},[t(H,{class:"btn-icon"},{default:s(()=>[M(le)?(c(),N(a(Cs),{key:0})):(c(),N(a(yt),{key:1}))]),_:2},1024)],10,jr)]),_:2},1024)])],8,Tr),M(le)?(c(),w("div",Dr,[W.stdout?(c(),w("div",Or,[e("div",Mr,[P[9]||(P[9]=e("h4",null,"标准输出",-1)),t(ce,{content:"复制输出",placement:"bottom",effect:"dark","open-delay":300},{default:s(()=>[e("button",{class:"modern-btn output-copy-button enhanced-btn",onClick:ue=>D(W)},[t(H,{class:"btn-icon"},{default:s(()=>[t(a(ht))]),_:1})],8,Rr)]),_:2},1024)]),e("pre",Gr,G(W.stdout),1),W.isStdoutTruncated?(c(),w("div",Ar,[t(ge,{type:"info",closable:!1,"show-icon":""},{default:s(()=>P[10]||(P[10]=[A(" 输出内容过长已被截断，请直接执行命令查看完整输出 ")])),_:1})])):I("",!0)])):I("",!0),W.stderr?(c(),w("div",{key:1,class:pe(["output-section",se(W.command)?"":"error"])},[e("div",Ur,[e("h4",null,G(se(W.command)?"输出信息":"错误输出"),1)]),e("pre",Er,G(W.stderr),1),W.isStderrTruncated?(c(),w("div",Ir,[t(ge,{type:"info",closable:!1,"show-icon":""},{default:s(()=>[A(G(se(W.command)?"输出信息":"错误输出")+"内容过长已被截断，请直接执行命令查看完整输出 ",1)]),_:2},1024)])):I("",!0)],2)):I("",!0),W.error?(c(),w("div",Nr,[P[11]||(P[11]=e("div",{class:"output-header"},[e("h4",null,"错误信息")],-1)),e("pre",Hr,G(W.error),1)])):I("",!0)])):I("",!0)],2))),128))]))])]),_:1},8,["modelValue"])],64)}}}),Wr=ze(Jr,[["__scopeId","data-v-dcb134c8"]]),qr={class:"inline-card"},Kr={key:0,class:"inline-card__icon"},Yr={class:"inline-card__content"},Qr={class:"inline-card__actions"},Xr=Be({__name:"InlineCard",setup(q){const b=Mo(),o=K(()=>{var v;const i=(v=b.icon)==null?void 0:v.call(b);return Array.isArray(i)?i.length>0:!!i});return(i,v)=>(c(),w("div",qr,[o.value?(c(),w("div",Kr,[ut(i.$slots,"icon",{},void 0,!0)])):I("",!0),e("div",Yr,[ut(i.$slots,"content",{},()=>[ut(i.$slots,"default",{},void 0,!0)],!0)]),e("div",Qr,[ut(i.$slots,"actions",{},void 0,!0)])]))}}),Nt=ze(Xr,[["__scopeId","data-v-3b762b22"]]),Zr="data:image/svg+xml,%3csvg%20width='200'%20height='200'%20viewBox='0%200%20200%20200'%20xmlns='http://www.w3.org/2000/svg'%3e%3c!--%20主分支%20--%3e%3cline%20x1='40'%20y1='40'%20x2='40'%20y2='160'%20stroke='%2334495e'%20stroke-width='8'%20stroke-linecap='round'%20/%3e%3c!--%20特性分支%20--%3e%3cpath%20d='M40,70%20C60,70%2080,90%2080,110%20L80,130'%20stroke='%233498db'%20stroke-width='8'%20stroke-linecap='round'%20stroke-linejoin='round'%20fill='none'%20/%3e%3c!--%20开发分支%20--%3e%3cpath%20d='M40,100%20C60,100%20100,110%20100,130%20L100,160'%20stroke='%232ecc71'%20stroke-width='8'%20stroke-linecap='round'%20stroke-linejoin='round'%20fill='none'%20/%3e%3c!--%20修复分支%20--%3e%3cpath%20d='M40,130%20C60,130%20120,140%20120,160'%20stroke='%23e74c3c'%20stroke-width='8'%20stroke-linecap='round'%20stroke-linejoin='round'%20fill='none'%20/%3e%3c!--%20合并点%20--%3e%3cpath%20d='M80,130%20C80,145%2060,145%2040,145'%20stroke='%233498db'%20stroke-width='8'%20stroke-linecap='round'%20stroke-linejoin='round'%20fill='none'%20/%3e%3c!--%20节点%20--%3e%3ccircle%20cx='40'%20cy='40'%20r='10'%20fill='%2334495e'%20/%3e%3ccircle%20cx='40'%20cy='70'%20r='10'%20fill='%2334495e'%20/%3e%3ccircle%20cx='40'%20cy='100'%20r='10'%20fill='%2334495e'%20/%3e%3ccircle%20cx='40'%20cy='130'%20r='10'%20fill='%2334495e'%20/%3e%3ccircle%20cx='40'%20cy='145'%20r='10'%20fill='%2334495e'%20/%3e%3ccircle%20cx='40'%20cy='160'%20r='10'%20fill='%2334495e'%20/%3e%3ccircle%20cx='80'%20cy='130'%20r='10'%20fill='%233498db'%20/%3e%3ccircle%20cx='100'%20cy='160'%20r='10'%20fill='%232ecc71'%20/%3e%3ccircle%20cx='120'%20cy='160'%20r='10'%20fill='%23e74c3c'%20/%3e%3c/svg%3e",ec={class:"main-header app-header"},tc={class:"header-left"},sc=["src"],oc={class:"header-info"},ac={class:"user-name"},lc={class:"user-email"},nc={class:"directory-icon"},ic={class:"directory-display"},rc=["title"],cc={class:"directory-actions"},uc={key:0,class:"header-actions"},dc={key:0,class:"command-history-section"},fc={key:0,viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},pc={key:1,viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},mc={class:"main-container"},vc={key:0,class:"loading-container"},gc={class:"loading-spinner"},hc={key:1,class:"grid-layout"},yc={class:"git-status-panel"},_c={key:0,class:"commit-form-panel"},wc={class:"tips"},bc={key:1,class:"commit-form-panel"},kc={key:2,class:"log-list-panel"},$c={class:"create-branch-content"},Cc={class:"form-label"},Sc={class:"form-label"},Tc={class:"create-branch-footer"},Vc={class:"footer-actions"},xc=["disabled"],Fc={class:"main-footer app-footer p-4"},Lc={key:0,class:"branch-info"},Bc={key:1},zc={class:"repo-url"},Pc={class:"user-settings-content"},jc={class:"form-group"},Dc={class:"form-label"},Oc={class:"form-group"},Mc={class:"form-label"},Rc={class:"info-section"},Gc={class:"info-card"},Ac={class:"info-icon"},Uc={class:"user-settings-footer"},Ec={class:"footer-actions"},Ic={class:"directory-content"},Nc={class:"form-label"},Hc={class:"directory-input-group"},Jc={class:"form-label"},Wc={class:"recent-directories"},qc=["onClick"],Kc=["title"],Yc={class:"directory-footer"},Qc={class:"footer-actions"},Xc=["disabled"],Zc=Be({__name:"App",setup(q){const b=d(""),o=d(null),i=d(null),v=d(null),u=ot(),j=rt(),_=d(!1),R=d(""),Z=d(!1);function E(){Z.value=!Z.value;const T=document.documentElement;Z.value?(T.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")):(T.removeAttribute("data-theme"),localStorage.setItem("theme","light"))}function V(){const T=localStorage.getItem("theme"),r=window.matchMedia("(prefers-color-scheme: dark)").matches;(T==="dark"||!T&&r)&&(Z.value=!0,document.documentElement.setAttribute("data-theme","dark"))}function h(){j.config&&(b.value=`默认提交信息: ${j.config.defaultCommitMessage}`)}async function U(){try{const r=await(await fetch("/api/current_directory")).json();return R.value=r.directory||"未知目录",r}catch(T){return console.error("获取当前目录失败:",T),{directory:"未知目录",isGitRepo:!1}}}pt(async()=>{console.log("---------- 页面初始化开始 ----------"),V();try{const T=await U();j.isLoaded||await j.loadConfig(),h(),u.isGitRepo=T.isGitRepo===!0,u.lastCheckedTime=Date.now(),u.isGitRepo?await Promise.all([u.getCurrentBranch(!0),u.getAllBranches(),u.getUserInfo(),u.getRemoteUrl(),u.getBranchStatus(!0)]):n.warning("当前目录不是Git仓库，部分功能将不可用")}catch(T){console.error("初始化失败:",T)}finally{_.value=!0,console.log("---------- 页面初始化完成 ----------"),setTimeout(()=>{De()},100)}});const k=d(!1),J=d(""),O=d("");async function B(){await u.createBranch(J.value,O.value)&&(k.value=!1,J.value="",i.value&&i.value.refreshStatus(),o.value&&o.value.refreshLog())}function M(){O.value=u.currentBranch,k.value=!0}async function S(T){await u.changeBranch(T)&&(i.value&&i.value.refreshStatus(),o.value&&o.value.refreshLog())}const Q=d(!1),se=d(""),D=d("");function ve(){se.value=u.userName,D.value=u.userEmail,Q.value=!0}async function te(){if(!se.value||!D.value){n.warning("用户名和邮箱不能为空");return}await u.restoreUserConfig(se.value,D.value)&&(Q.value=!1)}async function y(){await u.clearUserConfig()&&(se.value="",D.value="")}let P=!1,H=!1,ce=!1,fe=0,me=0,ge="",W="",le=null;function ue(){const T=document.querySelector(".grid-layout");if(!T)return;const r=getComputedStyle(T).gridTemplateColumns.split(" "),X=getComputedStyle(T).gridTemplateRows.split(" ");if(r.length>=3&&X.length>=3){const de=parseFloat(r[0]),Te=parseFloat(r[2]),Ne=de+Te,be=de/Ne,he=parseFloat(X[0]),Ue=parseFloat(X[2]),Ve=he+Ue,ye=he/Ve;localStorage.setItem("zen-gitsync-layout-left-ratio",be.toString()),localStorage.setItem("zen-gitsync-layout-top-ratio",ye.toString()),console.log(`布局比例已保存 - 左侧: ${(be*100).toFixed(0)}%, 上方: ${(ye*100).toFixed(0)}%`),localStorage.setItem("zen-gitsync-layout-bottom-left-ratio",be.toString()),console.log(`底部布局比例已保存 - 左侧: ${(be*100).toFixed(0)}%`)}}function De(){const T=document.querySelector(".grid-layout");if(!T)return;const r=localStorage.getItem("zen-gitsync-layout-left-ratio"),X=localStorage.getItem("zen-gitsync-layout-top-ratio");if(r){const de=parseFloat(r),Te=1-de;T.style.gridTemplateColumns=`${de}fr 8px ${Te}fr`,console.log(`已恢复左侧比例: ${(de*100).toFixed(0)}%`)}else T.style.gridTemplateColumns="1fr 8px 3fr";if(X){const de=parseFloat(X),Te=1-de;T.style.gridTemplateRows=`${de}fr 8px ${Te}fr`,console.log(`已恢复上方比例: ${(de*100).toFixed(0)}%`)}}function z(T){var de;const r=T.currentTarget;if(!r||!r.id)return;le=r.id,le==="v-resizer"?P=!0:le==="v-resizer-bottom"&&(H=!0),fe=T.clientX;const X=document.querySelector(".grid-layout");ge=getComputedStyle(X).gridTemplateColumns,(de=document.getElementById(le))==null||de.classList.add("active"),document.addEventListener("mousemove",F),document.addEventListener("mouseup",ie),T.preventDefault()}function F(T){if(!P&&!H)return;const r=document.querySelector(".grid-layout"),X=T.clientX-fe,de=ge.split(" ");if(de.length>=3){const Te=parseFloat(de[0]),Ne=parseFloat(de[2]),be=Te+Ne,he=(Te+X/r.clientWidth*be)/be,Ue=1-he,Ve=.1,ye=.5;he<Ve?r.style.gridTemplateColumns=`${Ve}fr 8px ${1-Ve}fr`:he>ye?r.style.gridTemplateColumns=`${ye}fr 8px ${1-ye}fr`:r.style.gridTemplateColumns=`${he}fr 8px ${Ue}fr`}}function ie(){var T,r;P=!1,H=!1,(T=document.getElementById("v-resizer"))==null||T.classList.remove("active"),(r=document.getElementById("v-resizer-bottom"))==null||r.classList.remove("active"),document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",ie),ue()}function ae(T){var X;ce=!0,me=T.clientY;const r=document.querySelector(".grid-layout");W=getComputedStyle(r).gridTemplateRows,(X=document.getElementById("h-resizer"))==null||X.classList.add("active"),document.addEventListener("mousemove",Ce),document.addEventListener("mouseup",Se),T.preventDefault()}function Ce(T){if(!ce)return;const r=document.querySelector(".grid-layout"),X=T.clientY-me,de=W.split(" ");if(de.length>=3){const Te=parseFloat(de[0]),Ne=parseFloat(de[2]),be=Te+Ne,he=(Te+X/r.clientHeight*be)/be,Ue=1-he,Ve=.2,ye=.8;he<Ve?r.style.gridTemplateRows=`${Ve}fr 8px ${1-Ve}fr`:he>ye?r.style.gridTemplateRows=`${ye}fr 8px ${1-ye}fr`:r.style.gridTemplateRows=`${he}fr 8px ${Ue}fr`}}function Se(){var T;ce=!1,(T=document.getElementById("h-resizer"))==null||T.classList.remove("active"),document.removeEventListener("mousemove",Ce),document.removeEventListener("mouseup",Se),ue()}const Oe=d(!1),we=d(""),ne=d(!1),Le=d([]);function Me(){we.value=R.value,Oe.value=!0,et()}async function et(){try{const r=await(await fetch("/api/recent_directories")).json();r.success&&Array.isArray(r.directories)&&(Le.value=r.directories)}catch(T){console.error("获取最近目录失败:",T)}}async function lt(){if(!we.value){n.warning("目录路径不能为空");return}try{ne.value=!0;const r=await(await fetch("/api/change_directory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:we.value})})).json();r.success?(n.success("已切换工作目录"),R.value=r.directory,Oe.value=!1,await Qe(r.directory),await et(),u.isGitRepo=r.isGitRepo,await j.loadConfig(!0),r.isGitRepo?(await Promise.all([u.getCurrentBranch(),u.getAllBranches(),u.getUserInfo(),u.getRemoteUrl()]),i.value&&i.value.refreshStatus(),o.value&&o.value.refreshLog()):(n.warning("当前目录不是Git仓库，部分功能将不可用"),u.$reset())):n.error(r.error||"切换目录失败")}catch(T){n.error(`切换目录失败: ${T.message}`)}finally{ne.value=!1}}async function Qe(T){try{await fetch("/api/save_recent_directory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:T})})}catch(r){console.error("保存最近目录失败:",r)}}async function at(){try{if(!R.value){n.warning("当前目录路径为空");return}const r=await(await fetch("/api/open_directory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:R.value})})).json();r.success?n.success("已在文件管理器中打开目录"):r.error&&n.error(r.error)}catch(T){console.error("打开目录失败:",T),n.error(`打开目录失败: ${T.message}`)}}async function nt(){try{const r=await(await fetch("/api/browse_directory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPath:we.value||R.value})})).json();r.success?Ae(r):r.error&&n.error(r.error)}catch(T){console.error("浏览目录失败:",T),n.error(`浏览目录失败: ${T.message}`)}}function Ae(T){!T||!T.items||Ye.alert(Ie("div",{class:"directory-browser"},[Ie("div",{class:"current-path"},[Ie("span",{class:"path-label"},"当前路径: "),Ie("span",{class:"path-value"},T.path)]),Ie("div",{class:"directory-list"},[T.parentPath?Ie("div",{class:"directory-item parent-dir",onClick:()=>{We(T.parentPath)}},[Ie("span",{class:"dir-icon"},Ie("svg",{class:"folder-icon",viewBox:"0 0 24 24",width:"20",height:"20",style:{fill:"#E6A23C"}},[Ie("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"})])),Ie("span",{class:"dir-name"},"返回上级目录")]):null,...T.items.map(r=>Ie("div",{class:"directory-item",onClick:()=>{We(r.path)}},[Ie("span",{class:"dir-icon"},Ie("svg",{class:"folder-icon",viewBox:"0 0 24 24",width:"20",height:"20",style:{fill:"#409EFF"}},[Ie("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"})])),Ie("span",{class:"dir-name"},r.name)]))])]),"浏览并选择目录",{confirmButtonText:"使用当前目录",customClass:"directory-browser-dialog",callback:r=>{r==="confirm"&&(we.value=T.path)}})}async function We(T){try{Ye.close(),setTimeout(async()=>{try{const X=await(await fetch("/api/browse_directory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPath:T})})).json();X.success?Ae(X):X.error&&n.error(X.error)}catch(r){console.error("浏览目录失败:",r),n.error(`浏览目录失败: ${r.message}`)}},100)}catch(r){console.error("处理目录选择时出错:",r),n.error(`处理目录选择时出错: ${r.message}`)}}return(T,r)=>{const X=Ze,de=je,Te=xs,Ne=ke,be=Ot,he=zs,Ue=Ht,Ve=Jt,ye=Bs;return c(),w($e,null,[e("header",ec,[e("div",tc,[e("img",{src:a(Zr),alt:"Zen GitSync Logo",class:"logo"},null,8,sc),r[16]||(r[16]=e("h1",null,"Zen GitSync",-1))]),e("div",oc,[t(Nt,{id:"user-info",class:"user-info-card",compact:""},{content:s(()=>[a(u).userName&&a(u).userEmail?(c(),w($e,{key:0},[e("span",ac,G(a(u).userName),1),e("span",lc,"<"+G(a(u).userEmail)+">",1)],64)):(c(),w($e,{key:1},[r[17]||(r[17]=e("span",{class:"user-label"},"用户: ",-1)),r[18]||(r[18]=e("span",{class:"user-warning"},"未配置",-1))],64))]),actions:s(()=>[t(de,{content:"用户设置",placement:"bottom",effect:"dark","open-delay":500},{default:s(()=>[e("button",{class:"modern-btn user-settings-btn",onClick:ve},[t(X,{class:"btn-icon"},{default:s(()=>[t(a(Ps))]),_:1})])]),_:1})]),_:1}),t(Nt,{id:"directory-selector",class:"directory-selector",compact:""},{icon:s(()=>[e("div",nc,[t(X,null,{default:s(()=>[t(a(Et))]),_:1})])]),content:s(()=>[e("div",ic,[e("div",{class:"directory-path",title:R.value},G(R.value),9,rc)])]),actions:s(()=>[e("div",cc,[t(de,{content:"切换目录",placement:"bottom",effect:"dark","open-delay":500},{default:s(()=>[e("button",{class:"modern-btn dir-btn",onClick:Me},[t(X,{class:"btn-icon"},{default:s(()=>r[19]||(r[19]=[e("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[e("path",{fill:"currentColor",d:"M128 192v640h768V320H485.76L357.504 192H128zm-32-64h287.872l128.384 128H928a32 32 0 0 1 32 32v576a32 32 0 0 1-32 32H96a32 32 0 0 1-32-32V160a32 32 0 0 1 32-32z"})],-1)])),_:1})])]),_:1}),t(de,{content:"在资源管理器中打开",placement:"bottom",effect:"dark","open-delay":500},{default:s(()=>[e("button",{class:"modern-btn dir-btn",onClick:at},[t(X,{class:"btn-icon"},{default:s(()=>r[20]||(r[20]=[e("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[e("path",{fill:"currentColor",d:"M928 444H820V330.4c0-17.7-14.3-32-32-32H473L355.7 186.2a8.15 8.15 0 0 0-5.5-2.2H96c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h698c13 0 24.8-7.9 29.7-20l134-332c1.5-3.8 2.3-7.9 2.3-12 0-17.7-14.3-32-32-32zM136 256h188.5l119.6 114.4H748V444H238c-13 0-24.8 7.9-29.7 20L136 643.2V256zm635.3 512H159l103.3-256h612.4L771.3 768z"})],-1)])),_:1})])]),_:1})])]),_:1}),a(u).isGitRepo?(c(),w("div",uc,[a(u).isGitRepo?(c(),w("div",dc,[t(Wr)])):I("",!0),t(de,{content:"编辑项目配置",placement:"bottom",effect:"dark","open-delay":500},{default:s(()=>[e("button",{class:"modern-btn config-btn",onClick:r[0]||(r[0]=oe=>{var Je;return(Je=v.value)==null?void 0:Je.openConfigEditor()})},[t(X,{class:"btn-icon"},{default:s(()=>[t(a(dt))]),_:1})])]),_:1}),t(de,{content:Z.value?"切换到浅色主题":"切换到深色主题",placement:"bottom",effect:"dark","open-delay":500},{default:s(()=>[e("button",{class:"modern-btn theme-toggle-btn",onClick:E},[t(X,{class:"btn-icon"},{default:s(()=>[Z.value?(c(),w("svg",fc,r[21]||(r[21]=[e("path",{fill:"currentColor",d:"M512 128a384 384 0 1 1 0 768 384 384 0 0 1 0-768zm0 64a320 320 0 1 0 0 640 320 320 0 0 0 0-640z"},null,-1),e("path",{fill:"currentColor",d:"M512 64a32 32 0 0 1 32 32v64a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32zm0 768a32 32 0 0 1 32 32v64a32 32 0 1 1-64 0v-64a32 32 0 0 1 32-32zM195.2 195.2a32 32 0 0 1 45.248 0l45.248 45.248a32 32 0 1 1-45.248 45.248L195.2 240.448a32 32 0 0 1 0-45.248zm543.104 543.104a32 32 0 0 1 45.248 0l45.248 45.248a32 32 0 0 1-45.248 45.248l-45.248-45.248a32 32 0 0 1 0-45.248zM64 512a32 32 0 0 1 32-32h64a32 32 0 0 1 0 64H96a32 32 0 0 1-32-32zm768 0a32 32 0 0 1 32-32h64a32 32 0 1 1 0 64h-64a32 32 0 0 1-32-32zM195.2 828.8a32 32 0 0 1 0-45.248l45.248-45.248a32 32 0 0 1 45.248 45.248L240.448 828.8a32 32 0 0 1-45.248 0zm543.104-543.104a32 32 0 0 1 0-45.248l45.248-45.248a32 32 0 0 1 45.248 45.248l-45.248 45.248a32 32 0 0 1-45.248 0z"},null,-1)]))):(c(),w("svg",pc,r[22]||(r[22]=[e("path",{fill:"currentColor",d:"M240.448 240.448a384 384 0 1 0 559.424 525.696 448 448 0 0 1-542.016-542.08 390.592 390.592 0 0 0-17.408 16.384zm181.056 362.048a384 384 0 0 0 525.632 16.384A448 448 0 1 1 405.056 76.8a384 384 0 0 0 16.448 525.696z"},null,-1)])))]),_:1})])]),_:1},8,["content"]),t(de,{content:"Git 操作",placement:"bottom",effect:"dark","open-delay":500},{default:s(()=>[e("button",{class:"modern-btn drawer-btn",onClick:r[1]||(r[1]=oe=>{var Je;return(Je=v.value)==null?void 0:Je.toggleGitOperationsDrawer()})},[t(X,{class:"btn-icon"},{default:s(()=>[t(a(hs))]),_:1})])]),_:1})])):I("",!0)])]),e("main",mc,[_.value?(c(),w("div",hc,[e("div",yc,[t(Qa,{ref_key:"gitStatusRef",ref:i,"initial-directory":R.value},null,8,["initial-directory"])]),e("div",{class:"vertical-resizer",id:"v-resizer",onMousedown:z},null,32),a(u).isGitRepo?(c(),w("div",_c,[!a(u).userName||!a(u).userEmail?(c(),N(Te,{key:0,shadow:"hover"},{header:s(()=>r[25]||(r[25]=[e("h2",null,"Git用户未配置",-1)])),default:s(()=>[r[29]||(r[29]=e("p",null,"请先配置Git用户信息才能进行提交操作。",-1)),e("div",wc,[r[27]||(r[27]=e("h3",null,"您可以通过以下方式配置：",-1)),r[28]||(r[28]=e("ol",null,[e("li",null,"点击右上角的设置按钮，配置用户名和邮箱"),e("li",null,"或者使用命令行配置："),e("div",{class:"code-block"},[A(' git config --global user.name "您的用户名"'),e("br"),A(' git config --global user.email "您的邮箱" ')])],-1)),t(Ne,{type:"primary",onClick:ve},{default:s(()=>r[26]||(r[26]=[A(" 立即配置 ")])),_:1})])]),_:1})):(c(),N(Ui,{key:1,ref_key:"commitFormRef",ref:v},null,512))])):(c(),w("div",bc,[t(Te,{shadow:"hover"},{header:s(()=>r[30]||(r[30]=[e("h2",null,"Git仓库初始化",-1)])),default:s(()=>[r[31]||(r[31]=e("p",null,"当前目录不是Git仓库，请先初始化Git仓库或切换到Git仓库目录。",-1)),r[32]||(r[32]=e("div",{class:"tips"},[e("h3",null,"可以使用以下命令初始化仓库："),e("div",{class:"code-block"},"git init")],-1))]),_:1})])),e("div",{class:"horizontal-resizer",id:"h-resizer",onMousedown:ae},null,32),a(u).isGitRepo?(c(),w("div",kc,[t(yr,{ref_key:"logListRef",ref:o},null,512)])):I("",!0),t(Ke,{modelValue:k.value,"onUpdate:modelValue":r[5]||(r[5]=oe=>k.value=oe),title:"创建新分支",size:"small","destroy-on-close":!0,"custom-class":"create-branch-dialog"},{footer:s(()=>[e("div",Tc,[e("div",Vc,[e("button",{type:"button",class:"footer-btn cancel-btn",onClick:r[4]||(r[4]=oe=>k.value=!1)}," 取消 "),e("button",{type:"button",class:"footer-btn primary-btn",onClick:B,disabled:a(u).isCreatingBranch},[a(u).isCreatingBranch?(c(),N(X,{key:1,class:"is-loading"},{default:s(()=>r[35]||(r[35]=[e("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[e("path",{fill:"currentColor",d:"M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32zm0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32zm448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32zm-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32z"})],-1)])),_:1})):(c(),N(X,{key:0},{default:s(()=>[t(a(ft))]),_:1})),r[36]||(r[36]=e("span",null,"创建",-1))],8,xc)])])]),default:s(()=>[e("div",$c,[t(ye,{model:{newBranchName:J.value,selectedBaseBranch:O.value},"label-position":"top"},{default:s(()=>[t(he,null,{label:s(()=>[e("div",Cc,[t(X,{class:"label-icon"},{default:s(()=>[t(a(ys))]),_:1}),r[33]||(r[33]=e("span",null,"新分支名称",-1))])]),default:s(()=>[t(be,{modelValue:J.value,"onUpdate:modelValue":r[2]||(r[2]=oe=>J.value=oe),placeholder:"请输入新分支名称",class:"modern-input",size:"large"},null,8,["modelValue"])]),_:1}),t(he,null,{label:s(()=>[e("div",Sc,[t(X,{class:"label-icon"},{default:s(()=>[t(a(hs))]),_:1}),r[34]||(r[34]=e("span",null,"基于分支",-1))])]),default:s(()=>[t(Ve,{modelValue:O.value,"onUpdate:modelValue":r[3]||(r[3]=oe=>O.value=oe),placeholder:"选择基础分支",class:"modern-select",size:"large",style:{width:"100%"}},{default:s(()=>[(c(!0),w($e,null,Re(a(u).allBranches,oe=>(c(),N(Ue,{key:oe,label:oe,value:oe},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"])])):(c(),w("div",vc,[t(Te,{class:"loading-card"},{default:s(()=>[e("div",gc,[t(X,{class:"is-loading"},{default:s(()=>r[23]||(r[23]=[e("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[e("path",{fill:"currentColor",d:"M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32zm0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32zm448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32zm-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32zM195.2 195.2a32 32 0 0 1 45.248 0L376.32 331.008a32 32 0 0 1-45.248 45.248L195.2 240.448a32 32 0 0 1 0-45.248zm452.544 452.544a32 32 0 0 1 45.248 0L828.8 783.552a32 32 0 0 1-45.248 45.248L647.744 692.992a32 32 0 0 1 0-45.248zM828.8 195.264a32 32 0 0 1 0 45.184L692.992 376.32a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0zm-452.544 452.48a32 32 0 0 1 0 45.248L240.448 828.8a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0z"})],-1)])),_:1})]),r[24]||(r[24]=e("div",{class:"loading-text"},"加载中...",-1))]),_:1})]))]),e("footer",Fc,[a(u).currentBranch?(c(),w("div",Lc,[t(Nt,{class:"branch-wrapper",compact:""},{content:s(()=>[r[37]||(r[37]=e("span",{class:"branch-label"},"当前分支:",-1)),t(Ve,{modelValue:a(u).currentBranch,"onUpdate:modelValue":r[6]||(r[6]=oe=>a(u).currentBranch=oe),size:"small",onChange:S,loading:a(u).isChangingBranch,class:"branch-select"},{default:s(()=>[(c(!0),w($e,null,Re(a(u).allBranches,oe=>(c(),N(Ue,{key:oe,label:oe,value:oe},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),actions:s(()=>[e("button",{class:"modern-btn create-branch-btn",onClick:M},[t(X,{class:"btn-icon"},{default:s(()=>[t(a(ys))]),_:1}),r[38]||(r[38]=e("span",{class:"btn-text"},"新建分支",-1))])]),_:1})])):I("",!0),a(u).remoteUrl?(c(),w("div",Bc,[t(Nt,{class:"footer-right",compact:""},{content:s(()=>[r[39]||(r[39]=e("span",{class:"repo-url-label"},"远程仓库:",-1)),e("span",zc,G(a(u).remoteUrl),1)]),actions:s(()=>[t(de,{content:"复制仓库地址",placement:"top",effect:"dark","open-delay":500},{default:s(()=>[e("button",{class:"modern-btn copy-url-btn",onClick:r[7]||(r[7]=oe=>a(u).copyRemoteUrl())},[t(X,{class:"btn-icon"},{default:s(()=>r[40]||(r[40]=[e("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[e("path",{fill:"currentColor",d:"M768 832a128 128 0 0 1-128 128H192A128 128 0 0 1 64 832V384a128 128 0 0 1 128-128v64a64 64 0 0 0-64 64v448a64 64 0 0 0 64 64h448a64 64 0 0 0 64-64h64z"}),e("path",{fill:"currentColor",d:"M384 128a64 64 0 0 0-64 64v448a64 64 0 0 0 64 64h448a64 64 0 0 0 64-64V192a64 64 0 0 0-64-64H384zm0-64h448a128 128 0 0 1 128 128v448a128 128 0 0 1-128 128H384a128 128 0 0 1-128-128V192A128 128 0 0 1 384 64z"})],-1)])),_:1})])]),_:1})]),_:1})])):I("",!0)]),t(Ke,{modelValue:Q.value,"onUpdate:modelValue":r[11]||(r[11]=oe=>Q.value=oe),title:"Git 用户设置",size:"small","destroy-on-close":!0,"custom-class":"user-settings-dialog"},{footer:s(()=>[e("div",Uc,[e("button",{type:"button",class:"footer-btn danger-btn",onClick:y},[t(X,null,{default:s(()=>[t(a(Bt))]),_:1}),r[44]||(r[44]=e("span",null,"清除配置",-1))]),e("div",Ec,[e("button",{type:"button",class:"footer-btn cancel-btn",onClick:r[10]||(r[10]=oe=>Q.value=!1)}," 取消 "),e("button",{type:"button",class:"footer-btn primary-btn",onClick:te},[t(X,null,{default:s(()=>[t(a(ft))]),_:1}),r[45]||(r[45]=e("span",null,"保存设置",-1))])])])]),default:s(()=>[e("div",Pc,[t(ye,{class:"user-form",model:{tempUserName:se.value,tempUserEmail:D.value},"label-position":"top"},{default:s(()=>[e("div",jc,[t(he,{class:"form-item"},{label:s(()=>[e("div",Dc,[t(X,{class:"label-icon"},{default:s(()=>[t(a(Ro))]),_:1}),r[41]||(r[41]=e("span",null,"用户名",-1))])]),default:s(()=>[t(be,{modelValue:se.value,"onUpdate:modelValue":r[8]||(r[8]=oe=>se.value=oe),placeholder:"请输入 Git 用户名",class:"modern-input",size:"large"},null,8,["modelValue"])]),_:1})]),e("div",Oc,[t(he,{class:"form-item"},{label:s(()=>[e("div",Mc,[t(X,{class:"label-icon"},{default:s(()=>[t(a(Go))]),_:1}),r[42]||(r[42]=e("span",null,"邮箱地址",-1))])]),default:s(()=>[t(be,{modelValue:D.value,"onUpdate:modelValue":r[9]||(r[9]=oe=>D.value=oe),placeholder:"请输入 Git 邮箱地址",class:"modern-input",size:"large"},null,8,["modelValue"])]),_:1})]),e("div",Rc,[e("div",Gc,[e("div",Ac,[t(X,null,{default:s(()=>[t(a(as))]),_:1})]),r[43]||(r[43]=e("div",{class:"info-content"},[e("p",{class:"info-title"},"全局配置"),e("p",{class:"info-desc"},"这些设置将影响全局 Git 配置，对所有 Git 仓库生效")],-1))])])]),_:1},8,["model"])])]),_:1},8,["modelValue"]),t(Ke,{modelValue:Oe.value,"onUpdate:modelValue":r[15]||(r[15]=oe=>Oe.value=oe),title:"切换工作目录",size:"medium","destroy-on-close":!0,"custom-class":"directory-dialog"},{footer:s(()=>[e("div",Yc,[e("div",Qc,[e("button",{type:"button",class:"footer-btn cancel-btn",onClick:r[13]||(r[13]=oe=>Oe.value=!1)}," 取消 "),e("button",{type:"button",class:"footer-btn primary-btn",onClick:r[14]||(r[14]=oe=>lt()),disabled:ne.value},[ne.value?(c(),N(X,{key:1,class:"is-loading"},{default:s(()=>r[49]||(r[49]=[e("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[e("path",{fill:"currentColor",d:"M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32zm0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32zm448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32zm-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32z"})],-1)])),_:1})):(c(),N(X,{key:0},{default:s(()=>[t(a(ft))]),_:1})),r[50]||(r[50]=e("span",null,"切换",-1))],8,Xc)])])]),default:s(()=>[e("div",Ic,[t(ye,{"label-position":"top"},{default:s(()=>[t(he,null,{label:s(()=>[e("div",Nc,[t(X,{class:"label-icon"},{default:s(()=>[t(a(Et))]),_:1}),r[46]||(r[46]=e("span",null,"目录路径",-1))])]),default:s(()=>[e("div",Hc,[t(be,{modelValue:we.value,"onUpdate:modelValue":r[12]||(r[12]=oe=>we.value=oe),placeholder:"请输入目录路径",class:"modern-input",size:"large"},null,8,["modelValue"]),e("button",{type:"button",class:"browse-btn",onClick:nt},[t(X,null,{default:s(()=>[t(a(Et))]),_:1}),r[47]||(r[47]=e("span",null,"浏览",-1))])])]),_:1}),Le.value.length>0?(c(),N(he,{key:0},{label:s(()=>[e("div",Jc,[t(X,{class:"label-icon"},{default:s(()=>[t(a(Ds))]),_:1}),r[48]||(r[48]=e("span",null,"常用目录",-1))])]),default:s(()=>[e("div",Wc,[(c(!0),w($e,null,Re(Le.value,(oe,Je)=>(c(),w("div",{key:Je,class:"recent-dir-item",onClick:mt=>we.value=oe},[t(X,{class:"dir-icon"},{default:s(()=>[t(a(Et))]),_:1}),e("span",{class:"dir-path",title:oe},G(oe),9,Kc)],8,qc))),128))])]),_:1})):I("",!0)]),_:1})])]),_:1},8,["modelValue"])],64)}}}),eu=ze(Zc,[["__scopeId","data-v-2aa56eca"]]),As=Ao(eu);As.use(Uo());As.mount("#app");
